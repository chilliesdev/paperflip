import{U as qe,a2 as qr,al as Ec,R as Bi,Z as zi,Y as Sc,a as kn,$ as sh,a0 as uh,a1 as cu,a3 as xn,V as pr,aj as ch,b1 as lh,aJ as lu,M as fh,T as xo,X as hh,b6 as kc,k as dh,an as ph,a$ as rs,b7 as mh,n as fu,b8 as vh,b9 as yh,a7 as gh,ba as It,N as xc,Q as Oc,bb as io,q as Ic,bc as bh,bd as wh,a_ as _h,O as Eh,ak as Sh,c as Cc,_ as Pc,be as kh,aT as xh,e as Oh,u as Oo,bf as Ih,v as Ch,a6 as gn,aP as Dc,bg as Ph,bh as Dh,bi as Rh,bj as Ah,a4 as Th,E as Mh,I as Nh,K as Lh,J as Bh,H as $h,B as Br,F as jh,af as Kh,bk as Fh}from"./BJ8RSJk3.js";import{j as qh,k as Ai,l as Wh,o as Uh,a as hu,p as Hh,c as zh}from"./DJicu8LF.js";import{b as Qh,r as Vh}from"./BrC9JOSP.js";import"./DM3EJLr3.js";import{B as Gh}from"./D5PPrnWW.js";import{d as du}from"./CIHOeZZ2.js";import{i as Yh}from"./n83IdW0N.js";import{l as pu,p as $r}from"./CgiX73Oo.js";function Jh(e,t){return t}function Xh(e,t,r){for(var n=[],a=t.length,s,c=t.length,f=0;f<a;f++){let g=t[f];Oc(g,()=>{if(s){if(s.pending.delete(g),s.done.add(g),s.pending.size===0){var S=e.outrogroups;Io(rs(s.done)),S.delete(s),S.size===0&&(e.outrogroups=null)}}else c-=1},!1)}if(c===0){var d=n.length===0&&r!==null;if(d){var v=r,m=v.parentNode;_h(m),m.append(v),e.items.clear()}Io(t,!d)}else s={pending:new Set(t),done:new Set},(e.outrogroups??=new Set).add(s)}function Io(e,t=!0){for(var r=0;r<e.length;r++)Eh(e[r],t)}var mu;function Zh(e,t,r,n,a,s=null){var c=e,f=new Map,d=(t&kc)!==0;if(d){var v=e;c=qe?qr(Ec(v)):v.appendChild(Bi())}qe&&zi();var m=null,g=dh(()=>{var B=r();return ph(B)?B:B==null?[]:rs(B)}),S,w=!0;function E(){P.fallback=m,ed(P,S,c,t,n),m!==null&&(S.length===0?(m.f&It)===0?xc(m):(m.f^=It,_n(m,null,c)):Oc(m,()=>{m=null}))}var O=Sc(()=>{S=kn(g);var B=S.length;let j=!1;if(qe){var H=sh(c)===uh;H!==(B===0)&&(c=cu(),qr(c),xn(!1),j=!0)}for(var ee=new Set,X=fh,Y=hh(),V=0;V<B;V+=1){qe&&pr.nodeType===ch&&pr.data===lh&&(c=pr,j=!0,xn(!1));var re=S[V],se=n(re,V),fe=w?null:f.get(se);fe?(fe.v&&lu(fe.v,re),fe.i&&lu(fe.i,V),Y&&X.unskip_effect(fe.e)):(fe=td(f,w?c:mu??=Bi(),re,se,V,a,t,r),w||(fe.e.f|=It),f.set(se,fe)),ee.add(se)}if(B===0&&s&&!m&&(w?m=xo(()=>s(c)):(m=xo(()=>s(mu??=Bi())),m.f|=It)),qe&&B>0&&qr(cu()),!w)if(Y){for(const[Ee,ue]of f)ee.has(Ee)||X.skip_effect(ue.e);X.oncommit(E),X.ondiscard(()=>{})}else E();j&&xn(!0),kn(g)}),P={effect:O,items:f,outrogroups:null,fallback:m};w=!1,qe&&(c=pr)}function bn(e){for(;e!==null&&(e.f&bh)===0;)e=e.next;return e}function ed(e,t,r,n,a){var s=(n&wh)!==0,c=t.length,f=e.items,d=bn(e.effect.first),v,m=null,g,S=[],w=[],E,O,P,B;if(s)for(B=0;B<c;B+=1)E=t[B],O=a(E,B),P=f.get(O).e,(P.f&It)===0&&(P.nodes?.a?.measure(),(g??=new Set).add(P));for(B=0;B<c;B+=1){if(E=t[B],O=a(E,B),P=f.get(O).e,e.outrogroups!==null)for(const fe of e.outrogroups)fe.pending.delete(P),fe.done.delete(P);if((P.f&It)!==0)if(P.f^=It,P===d)_n(P,null,r);else{var j=m?m.next:d;P===e.effect.last&&(e.effect.last=P.prev),P.prev&&(P.prev.next=P.next),P.next&&(P.next.prev=P.prev),zt(e,m,P),zt(e,P,j),_n(P,j,r),m=P,S=[],w=[],d=bn(m.next);continue}if((P.f&io)!==0&&(xc(P),s&&(P.nodes?.a?.unfix(),(g??=new Set).delete(P))),P!==d){if(v!==void 0&&v.has(P)){if(S.length<w.length){var H=w[0],ee;m=H.prev;var X=S[0],Y=S[S.length-1];for(ee=0;ee<S.length;ee+=1)_n(S[ee],H,r);for(ee=0;ee<w.length;ee+=1)v.delete(w[ee]);zt(e,X.prev,Y.next),zt(e,m,X),zt(e,Y,H),d=H,m=Y,B-=1,S=[],w=[]}else v.delete(P),_n(P,d,r),zt(e,P.prev,P.next),zt(e,P,m===null?e.effect.first:m.next),zt(e,m,P),m=P;continue}for(S=[],w=[];d!==null&&d!==P;)(v??=new Set).add(d),w.push(d),d=bn(d.next);if(d===null)continue}(P.f&It)===0&&S.push(P),m=P,d=bn(P.next)}if(e.outrogroups!==null){for(const fe of e.outrogroups)fe.pending.size===0&&(Io(rs(fe.done)),e.outrogroups?.delete(fe));e.outrogroups.size===0&&(e.outrogroups=null)}if(d!==null||v!==void 0){var V=[];if(v!==void 0)for(P of v)(P.f&io)===0&&V.push(P);for(;d!==null;)(d.f&io)===0&&d!==e.fallback&&V.push(d),d=bn(d.next);var re=V.length;if(re>0){var se=(n&kc)!==0&&c===0?r:null;if(s){for(B=0;B<re;B+=1)V[B].nodes?.a?.measure();for(B=0;B<re;B+=1)V[B].nodes?.a?.fix()}Xh(e,V,se)}}s&&Ic(()=>{if(g!==void 0)for(P of g)P.nodes?.a?.apply()})}function td(e,t,r,n,a,s,c,f){var d=(c&vh)!==0?(c&yh)===0?gh(r,!1,!1):fu(r):null,v=(c&mh)!==0?fu(a):null;return{v:d,i:v,e:xo(()=>(s(t,d??r,v??a,f),()=>{e.delete(n)}))}}function _n(e,t,r){if(e.nodes)for(var n=e.nodes.start,a=e.nodes.end,s=t&&(t.f&It)===0?t.nodes.start:r;n!==null;){var c=Sh(n);if(s.before(n),n===a)return;n=c}}function zt(e,t,r){t===null?e.effect.first=r:t.next=r,r===null?e.effect.last=t:r.prev=t}function rd(e,t,r,n,a){qe&&zi();var s=t.$$slots?.[r],c=!1;s===!0&&(s=t.children,c=!0),s===void 0||s(e,c?()=>n:n)}const nd=()=>performance.now(),Ot={tick:e=>requestAnimationFrame(e),now:()=>nd(),tasks:new Set};function Rc(){const e=Ot.now();Ot.tasks.forEach(t=>{t.c(e)||(Ot.tasks.delete(t),t.f())}),Ot.tasks.size!==0&&Ot.tick(Rc)}function id(e){let t;return Ot.tasks.size===0&&Ot.tick(Rc),{promise:new Promise(r=>{Ot.tasks.add(t={c:e,f:r})}),abort(){Ot.tasks.delete(t)}}}function Qi(e,t){Dc(()=>{e.dispatchEvent(new CustomEvent(t))})}function ad(e){if(e==="float")return"cssFloat";if(e==="offset")return"cssOffset";if(e.startsWith("--"))return e;const t=e.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function vu(e){const t={},r=e.split(";");for(const n of r){const[a,s]=n.split(":");if(!a||s===void 0)break;const c=ad(a.trim());t[c]=s.trim()}return t}const od=e=>e;function _w(e,t,r,n){var a=(e&Ph)!==0,s=(e&Dh)!==0,c=a&&s,f=(e&Ih)!==0,d=c?"both":a?"in":"out",v,m=t.inert,g=t.style.overflow,S,w;function E(){return Dc(()=>v??=r()(t,n?.()??{},{direction:d}))}var O={is_global:f,in(){if(t.inert=m,!a){w?.abort(),w?.reset?.();return}s||S?.abort(),S=Co(t,E(),w,1,()=>{Qi(t,"introend"),S?.abort(),S=v=void 0,t.style.overflow=g})},out(H){if(!s){H?.(),v=void 0;return}t.inert=!0,w=Co(t,E(),S,0,()=>{Qi(t,"outroend"),H?.()})},stop:()=>{S?.abort(),w?.abort()}},P=Cc;if((P.nodes.t??=[]).push(O),a&&qh){var B=f;if(!B){for(var j=P.parent;j&&(j.f&Pc)!==0;)for(;(j=j.parent)&&(j.f&kh)===0;);B=!j||(j.f&xh)!==0}B&&Oh(()=>{Oo(()=>O.in())})}}function Co(e,t,r,n,a){var s=n===1;if(Ch(t)){var c,f=!1;return Ic(()=>{if(!f){var P=t({direction:s?"in":"out"});c=Co(e,P,r,n,a)}}),{abort:()=>{f=!0,c?.abort()},deactivate:()=>c.deactivate(),reset:()=>c.reset(),t:()=>c.t()}}if(r?.deactivate(),!t?.duration&&!t?.delay)return Qi(e,s?"introstart":"outrostart"),a(),{abort:gn,deactivate:gn,reset:gn,t:()=>n};const{delay:d=0,css:v,tick:m,easing:g=od}=t;var S=[];if(s&&r===void 0&&(m&&m(0,1),v)){var w=vu(v(0,1));S.push(w,w)}var E=()=>1-n,O=e.animate(S,{duration:d,fill:"forwards"});return O.onfinish=()=>{O.cancel(),Qi(e,s?"introstart":"outrostart");var P=r?.t()??1-n;r?.abort();var B=n-P,j=t.duration*Math.abs(B),H=[];if(j>0){var ee=!1;if(v)for(var X=Math.ceil(j/16.666666666666668),Y=0;Y<=X;Y+=1){var V=P+B*g(Y/X),re=vu(v(V,1-V));H.push(re),ee||=re.overflow==="hidden"}ee&&(e.style.overflow="hidden"),E=()=>{var se=O.currentTime;return P+B*g(se/j)},m&&id(()=>{if(O.playState!=="running")return!1;var se=E();return m(se,1-se),!0})}O=e.animate(H,{duration:j,fill:"forwards"}),O.onfinish=()=>{E=()=>n,m?.(n,1-n),a()}},{abort:()=>{O&&(O.cancel(),O.effect=null,O.onfinish=gn)},deactivate:()=>{a=gn},reset:()=>{n===0&&m?.(1,0)},t:()=>E()}}function sd(e,t,r,n,a,s){let c=qe;qe&&zi();var f=null;qe&&pr.nodeType===Rh&&(f=pr,zi());var d=qe?pr:e,v=new Gh(d,!1);Sc(()=>{const m=t()||null;var g=Ah;if(m===null){v.ensure(null,null),Ai(!0);return}return v.ensure(m,S=>{if(m){if(f=qe?f:document.createElementNS(g,m),Wh(f,f),n){qe&&Uh(m)&&f.append(document.createComment(""));var w=qe?Ec(f):f.appendChild(Bi());qe&&(w===null?xn(!1):qr(w)),n(f,w)}Cc.nodes.end=f,S.before(f)}qe&&qr(S)}),Ai(!0),()=>{m&&Ai(!1)}},Pc),Th(()=>{Ai(!0)}),c&&(xn(!0),qr(d))}const ud="";function Ew(...e){return Qh+ud+Vh(e[0],e[1])}function Rn(e){"@babel/helpers - typeof";return Rn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rn(e)}function cd(e,t){if(Rn(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Rn(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function ld(e){var t=cd(e,"string");return Rn(t)=="symbol"?t:t+""}function fd(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ld(n.key),n)}}function tr(e,t,r){return t&&fd(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function hd(e){return e[e.length-1]}function ns(e){return Array.isArray(e)?e.slice(0):[e]}function dd(e,t){e=e.slice(0);for(var r=[];e.length;){var n=e.splice(0,t);r.push(n)}return r}function Vi(e){return Array.isArray(e)}function ao(e,t){var r=0,n=-1;for(var a of e){n=n+1;var s=t(a,n);if(s)r=r+1;else break}return r}function Er(e,t){var r=t.length;if(r!==0){var n=e.length;e.length=n+t.length;for(var a=0;a<r;++a)e[n+a]=t[a]}}function pd(e){return e.filter(function(t,r,n){return n.indexOf(t)===r})}function Xt(e){for(var t="",r=0;r<e.length;r++){var n=e[r];if(n==="-")return parseInt(t,10);t+=n}throw new Error("malformatted revision: "+e)}function Rt(e,t){var r=t?Xt(t._rev)+1:1;return r+"-"+e}function md(e){var t=e.split("."),r=t.length;return r===1?n=>n[e]:n=>{for(var a=n,s=0;s<r;++s){var c=t[s];if(a=a[c],typeof a>"u")return a}return a}}function xe(e){return Object.assign({},e)}function vd(e){return Object.keys(e)[0]}function Gi(e,t=!1){if(!e)return e;if(!t&&Array.isArray(e))return e.sort((n,a)=>typeof n=="string"&&typeof a=="string"?n.localeCompare(a):typeof n=="object"?1:-1).map(n=>Gi(n,t));if(typeof e=="object"&&!Array.isArray(e)){var r={};return Object.keys(e).sort((n,a)=>n.localeCompare(a)).forEach(n=>{r[n]=Gi(e[n],t)}),r}return e}function Po(e){if(!e||e===null||typeof e!="object")return e;if(Array.isArray(e)){for(var t=new Array(e.length),r=t.length;r--;)t[r]=Po(e[r]);return t}var n={};for(var a in e)n[a]=Po(e[a]);return n}var ze=Po;function Pt(e,t,r){return Object.defineProperty(e,t,{get:function(){return r}}),r}var is=1;function tn(){return{lwt:is}}function ft(){return""}function yd(e){return Object.assign({},e,{_meta:void 0,_deleted:void 0,_rev:void 0})}function gd(e,t,r){if(t.length!==r.length)return!1;for(var n=0,a=t.length;n<a;){var s=t[n],c=r[n];if(n++,s[e]!==c[e]||s._rev!==c._rev||s._meta.lwt!==c._meta.lwt)return!1}return!0}function An(e,t){return An=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},An(e,t)}function as(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,An(e,t)}function Do(e){return Do=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Do(e)}function bd(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch{return typeof e=="function"}}function Ac(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ac=function(){return!!e})()}function wd(e,t,r){if(Ac())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var a=new(e.bind.apply(e,n));return r&&An(a,r.prototype),a}function Yi(e){var t=typeof Map=="function"?new Map:void 0;return Yi=function(n){if(n===null||!bd(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(n))return t.get(n);t.set(n,a)}function a(){return wd(n,arguments,Do(this).constructor)}return a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),An(a,n)},Yi(e)}var ge={isDevMode(){return!1},deepFreezeWhenDevMode(e){return e},tunnelErrorMessage(e){return`
        RxDB Error-Code: `+e+`.
        Hint: Error messages are not included in RxDB core to reduce build size.
        To show the full error messages and to ensure that you do not make any mistakes when using RxDB,
        use the dev-mode plugin when you are in development mode: https://rxdb.info/dev-mode.html?console=error
        `}};function _d(e){var t="";return Object.keys(e).length===0||(t+="-".repeat(20)+`
`,t+=`Parameters:
`,t+=Object.keys(e).map(r=>{var n="[object Object]";try{r==="errors"?n=e[r].map(a=>JSON.stringify(a,Object.getOwnPropertyNames(a))):n=JSON.stringify(e[r],function(a,s){return s===void 0?null:s},2)}catch{}return r+": "+n}).join(`
`),t+=`
`),t}function Tc(e,t,r){return`
`+e+`
`+_d(r)}var Ed=(function(e){function t(n,a,s={}){var c,f=Tc(a,n,s);return c=e.call(this,f)||this,c.code=n,c.message=f,c.url=os(n),c.parameters=s,c.rxdb=!0,c}as(t,e);var r=t.prototype;return r.toString=function(){return this.message},tr(t,[{key:"name",get:function(){return"RxError ("+this.code+")"}},{key:"typeError",get:function(){return!1}}])})(Yi(Error)),Sd=(function(e){function t(n,a,s={}){var c,f=Tc(a,n,s);return c=e.call(this,f)||this,c.code=n,c.message=f,c.url=os(n),c.parameters=s,c.rxdb=!0,c}as(t,e);var r=t.prototype;return r.toString=function(){return this.message},tr(t,[{key:"name",get:function(){return"RxTypeError ("+this.code+")"}},{key:"typeError",get:function(){return!0}}])})(Yi(TypeError));function os(e){return"https://rxdb.info/errors.html?console=errors#"+e}function Mc(e){return`
Find out more about this error here: `+os(e)+`
`}function J(e,t){return new Ed(e,ge.tunnelErrorMessage(e)+Mc(e),t)}function st(e,t){return new Sd(e,ge.tunnelErrorMessage(e)+Mc(e),t)}function Tn(e){return e&&e.status===409?e:!1}var kd={409:"document write conflict",422:"schema validation error",510:"attachment data missing"};function Nc(e){return J("COL20",{name:kd[e.status],document:e.documentId,writeError:e})}var Ti;function xd(){if(Ti)return Ti;if(typeof crypto>"u"||typeof crypto.subtle>"u"||typeof crypto.subtle.digest!="function")throw J("UT8",{args:{typeof_crypto:typeof crypto,typeof_crypto_subtle:typeof crypto?.subtle,typeof_crypto_subtle_digest:typeof crypto?.subtle?.digest}});return Ti=crypto.subtle.digest.bind(crypto.subtle),Ti}async function Od(e){var t=new TextEncoder().encode(e),r=await xd()("SHA-256",t),n=Array.prototype.map.call(new Uint8Array(r),a=>("00"+a.toString(16)).slice(-2)).join("");return n}var Lc=Od;function Id(){return new Promise(e=>setTimeout(e,0))}function Cd(e=0){return new Promise(t=>setTimeout(t,e))}function Pd(e){return e&&typeof e.then=="function"?e:Promise.resolve(e)}var Dd=Promise.resolve(!0),At=Promise.resolve(!1),ss=Promise.resolve(null),lt=Promise.resolve();function ca(e=1e4){return typeof requestIdleCallback=="function"?new Promise(t=>{requestIdleCallback(()=>t(),{timeout:e})}):Cd(0)}var oo=lt;function Rd(e=void 0){return oo=oo.then(()=>ca(e)),oo}function Ad(e,t){return e.reduce((r,n)=>r.then(n),Promise.resolve(t))}var Td=/\./g,yu="abcdefghijklmnopqrstuvwxyz";function Hn(e=10){for(var t="",r=0;r<e;r++)t+=yu.charAt(Math.floor(Math.random()*yu.length));return t}function Bc(e){e+="";var t=e.charAt(0).toUpperCase();return t+e.substr(1)}function En(e){for(;e.charAt(0)===".";)e=e.substr(1);for(;e.slice(-1)===".";)e=e.slice(0,-1);return e}function Mn(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,n;if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;n--!==0;)if(!Mn(e[n],t[n]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();var a=Object.keys(e);if(r=a.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!Object.prototype.hasOwnProperty.call(t,a[n]))return!1;for(n=r;n--!==0;){var s=a[n];if(!Mn(e[s],t[s]))return!1}return!0}return e!==e&&t!==t}var Ro=e=>{var t=typeof e;return e!==null&&(t==="object"||t==="function")},so=new Set(["__proto__","prototype","constructor"]),Md=new Set("0123456789");function $c(e){var t=[],r="",n="start",a=!1;for(var s of e)switch(s){case"\\":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd")throw new Error("Invalid character after an index");a&&(r+=s),n="property",a=!a;break}case".":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd"){n="property";break}if(a){a=!1,r+=s;break}if(so.has(r))return[];t.push(r),r="",n="property";break}case"[":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd"){n="index";break}if(a){a=!1,r+=s;break}if(n==="property"){if(so.has(r))return[];t.push(r),r=""}n="index";break}case"]":{if(n==="index"){t.push(Number.parseInt(r,10)),r="",n="indexEnd";break}if(n==="indexEnd")throw new Error("Invalid character after an index")}default:{if(n==="index"&&!Md.has(s))throw new Error("Invalid character in an index");if(n==="indexEnd")throw new Error("Invalid character after an index");n==="start"&&(n="property"),a&&(a=!1,r+="\\"),r+=s}}switch(a&&(r+="\\"),n){case"property":{if(so.has(r))return[];t.push(r);break}case"index":throw new Error("Index was not closed");case"start":{t.push("");break}}return t}function jc(e,t){if(typeof t!="number"&&Array.isArray(e)){var r=Number.parseInt(t,10);return Number.isInteger(r)&&e[r]===e[t]}return!1}function Nd(e,t){if(jc(e,t))throw new Error("Cannot use string index")}function Zt(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!t.includes(".")&&!t.includes("["))return e[t];if(!Ro(e)||typeof t!="string")return r===void 0?e:r;var n=$c(t);if(n.length===0)return r;for(var a=0;a<n.length;a++){var s=n[a];if(jc(e,s)?e=a===n.length-1?void 0:null:e=e[s],e==null){if(a!==n.length-1)return r;break}}return e===void 0?r:e}function Kc(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!Ro(e)||typeof t!="string")return e;for(var n=e,a=$c(t),s=0;s<a.length;s++){var c=a[s];Nd(e,c),s===a.length-1?e[c]=r:Ro(e[c])||(e[c]=typeof a[s+1]=="number"?[]:{}),e=e[c]}return n}function Gr(e,t){var r=e.get(t);if(typeof r>"u")throw new Error("missing value from map "+t);return r}function ht(e,t,r,n){var a=e.get(t);return typeof a>"u"&&(a=r(),e.set(t,a)),a}function ye(e){var t=e.split("-"),r="RxDB";return t.forEach(n=>{r+=Bc(n)}),r+="Plugin",new Error(`You are using a function which must be overwritten by a plugin.
        You should either prevent the usage of this function or add the plugin via:
            import { `+r+" } from 'rxdb/plugins/"+e+`';
            addRxPlugin(`+r+`);
        `)}function Ld(e){var t={name:e.name,message:e.message,rxdb:e.rxdb,parameters:e.parameters,extensions:e.extensions,code:e.code,url:e.url,stack:e.stack?e.stack.replace(/\n/g,`
 `):void 0};return t}var uo=0;function et(){var e=Date.now();e=e+.01,e<=uo&&(e=uo+.01);var t=parseFloat(e.toFixed(2));return uo=t,t}function oe(e,t){if(!e)throw t||(t=""),new Error("ensureNotFalsy() is falsy: "+t);return e}var zn={bufferSize:1,refCount:!0},Fc="16.21.1",co={},Bd="6da4936d1425ff3a5c44c02342c6daf791d266be3ae8479b8ec59e261df41b93",gu=16,lo=At,bu=!1;async function qc(){return bu||(bu=!0,lo=(async()=>!!(co.premium&&typeof co.premium=="string"&&await Lc(co.premium)===Bd))()),lo}var Nn={preAddRxPlugin:[],preCreateRxDatabase:[],createRxDatabase:[],preCreateRxCollection:[],createRxCollection:[],createRxState:[],postCloseRxCollection:[],postRemoveRxCollection:[],preCreateRxSchema:[],createRxSchema:[],prePrepareRxQuery:[],preCreateRxQuery:[],prePrepareQuery:[],createRxDocument:[],postCreateRxDocument:[],preCreateRxStorageInstance:[],preStorageWrite:[],preMigrateDocument:[],postMigrateDocument:[],preCloseRxDatabase:[],postRemoveRxDatabase:[],postCleanup:[],preReplicationMasterWrite:[],preReplicationMasterWriteDocumentsHandle:[]};function Qe(e,t){Nn[e].length>0&&Nn[e].forEach(r=>r(t))}async function Qn(e,t){for(var r of Nn[e])await r(t)}function Yr(e,t){var r=t;r=r.replace(Td,".properties."),r="properties."+r,r=En(r);var n=Zt(e,r);return n}function $d(e,t,r){if(typeof t.primaryKey=="string")return r;var n=Ir(t,r),a=r[e];if(a&&a!==n)throw J("DOC19",{args:{documentData:r,existingPrimary:a,newPrimary:n},schema:t});return r[e]=n,r}function tt(e){return typeof e=="string"?e:e.key}function jd(e){var t=tt(e.primaryKey),r=Yr(e,t);return oe(r.maxLength)}function Ir(e,t){if(typeof e.primaryKey=="string")return t[e.primaryKey];var r=e.primaryKey;return r.fields.map(n=>{var a=Zt(t,n);if(typeof a>"u")throw J("DOC18",{args:{field:n,documentData:t}});return a}).join(r.separator)}function Kd(e){var t=Gi(e,!0);return t}function Fd(e){return["_deleted",e]}function la(e){e=xe(e);var t=tt(e.primaryKey);e.properties=xe(e.properties),e.additionalProperties=!1,Object.prototype.hasOwnProperty.call(e,"keyCompression")||(e.keyCompression=!1),e.indexes=e.indexes?e.indexes.slice(0):[],e.required=e.required?e.required.slice(0):[],e.encrypted=e.encrypted?e.encrypted.slice(0):[],e.properties._rev={type:"string",minLength:1},e.properties._attachments={type:"object"},e.properties._deleted={type:"boolean"},e.properties._meta=Wd,e.required=e.required?e.required.slice(0):[],e.required.push("_deleted"),e.required.push("_rev"),e.required.push("_meta"),e.required.push("_attachments");var r=Wc(e);Er(e.required,r),e.required=e.required.filter(s=>!s.includes(".")).filter((s,c,f)=>f.indexOf(s)===c),e.version=e.version||0;var n=e.indexes.map(s=>{var c=Vi(s)?s.slice(0):[s];return c.includes(t)||c.push(t),c[0]!=="_deleted"&&c.unshift("_deleted"),c});n.length===0&&n.push(Fd(t)),n.push(["_meta.lwt",t]),e.internalIndexes&&e.internalIndexes.map(s=>{n.push(s)});var a=new Set;return n.filter(s=>{var c=s.join(",");return a.has(c)?!1:(a.add(c),!0)}),e.indexes=n,e}var qd=1e15,Wd={type:"object",properties:{lwt:{type:"number",minimum:is,maximum:qd,multipleOf:.01}},additionalProperties:!0,required:["lwt"]};function Wc(e){var t=Object.keys(e.properties).filter(n=>e.properties[n].final),r=tt(e.primaryKey);return t.push(r),typeof e.primaryKey!="string"&&e.primaryKey.fields.forEach(n=>t.push(n)),t}function Ud(e,t){for(var r=Object.keys(e.defaultValues),n=0;n<r.length;++n){var a=r[n];(!Object.prototype.hasOwnProperty.call(t,a)||typeof t[a]>"u")&&(t[a]=e.defaultValues[a])}return t}var Uc=(function(){function e(r,n){if(this.jsonSchema=r,this.hashFunction=n,this.indexes=Hd(this.jsonSchema),this.primaryPath=tt(this.jsonSchema.primaryKey),!r.properties[this.primaryPath].maxLength)throw J("SC39",{schema:r});this.finalFields=Wc(this.jsonSchema)}var t=e.prototype;return t.validateChange=function(n,a){this.finalFields.forEach(s=>{if(!Mn(n[s],a[s]))throw J("DOC9",{dataBefore:n,dataAfter:a,fieldName:s,schema:this.jsonSchema})})},t.getDocumentPrototype=function(){var n={},a=Yr(this.jsonSchema,"");return Object.keys(a).forEach(s=>{var c=s;n.__defineGetter__(s,function(){if(!(!this.get||typeof this.get!="function")){var f=this.get(c);return f}}),Object.defineProperty(n,s+"$",{get:function(){return this.get$(c)},enumerable:!1,configurable:!1}),Object.defineProperty(n,s+"$$",{get:function(){return this.get$$(c)},enumerable:!1,configurable:!1}),Object.defineProperty(n,s+"_",{get:function(){return this.populate(c)},enumerable:!1,configurable:!1})}),Pt(this,"getDocumentPrototype",()=>n),n},t.getPrimaryOfDocumentData=function(n){return Ir(this.jsonSchema,n)},tr(e,[{key:"version",get:function(){return this.jsonSchema.version}},{key:"defaultValues",get:function(){var r={};return Object.entries(this.jsonSchema.properties).filter(([,n])=>Object.prototype.hasOwnProperty.call(n,"default")).forEach(([n,a])=>r[n]=a.default),Pt(this,"defaultValues",r)}},{key:"hash",get:function(){return Pt(this,"hash",this.hashFunction(JSON.stringify(this.jsonSchema)))}}])})();function Hd(e){return(e.indexes||[]).map(t=>Vi(t)?t:[t])}function zd(e){var t=e.version?e.version:0,r=0;return new Array(t).fill(0).map(()=>r++)}function Qd(e,t,r=!0){r&&Qe("preCreateRxSchema",e);var n=la(e);n=Kd(n),ge.deepFreezeWhenDevMode(n);var a=new Uc(n,t);return Qe("createRxSchema",a),a}function Te(e){return typeof e=="function"}function Vd(e){return Te(e?.lift)}function wt(e){return function(t){if(Vd(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}var Ao=function(e,t){return Ao=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},Ao(e,t)};function Cr(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Ao(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function Gd(e,t,r,n){function a(s){return s instanceof r?s:new r(function(c){c(s)})}return new(r||(r=Promise))(function(s,c){function f(m){try{v(n.next(m))}catch(g){c(g)}}function d(m){try{v(n.throw(m))}catch(g){c(g)}}function v(m){m.done?s(m.value):a(m.value).then(f,d)}v((n=n.apply(e,t||[])).next())})}function Hc(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,a,s,c=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return c.next=f(0),c.throw=f(1),c.return=f(2),typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function f(v){return function(m){return d([v,m])}}function d(v){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,v[0]&&(r=0)),r;)try{if(n=1,a&&(s=v[0]&2?a.return:v[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,v[1])).done)return s;switch(a=0,s&&(v=[v[0]&2,s.value]),v[0]){case 0:case 1:s=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,a=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!s||v[1]>s[0]&&v[1]<s[3])){r.label=v[1];break}if(v[0]===6&&r.label<s[1]){r.label=s[1],s=v;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(v);break}s[2]&&r.ops.pop(),r.trys.pop();continue}v=t.call(e,r)}catch(m){v=[6,m],a=0}finally{n=s=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function Jr(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Sr(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],c;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)s.push(a.value)}catch(f){c={error:f}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(c)throw c.error}}return s}function kr(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,s;n<a;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))}function Wr(e){return this instanceof Wr?(this.v=e,this):new Wr(e)}function Yd(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),a,s=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),f("next"),f("throw"),f("return",c),a[Symbol.asyncIterator]=function(){return this},a;function c(w){return function(E){return Promise.resolve(E).then(w,g)}}function f(w,E){n[w]&&(a[w]=function(O){return new Promise(function(P,B){s.push([w,O,P,B])>1||d(w,O)})},E&&(a[w]=E(a[w])))}function d(w,E){try{v(n[w](E))}catch(O){S(s[0][3],O)}}function v(w){w.value instanceof Wr?Promise.resolve(w.value.v).then(m,g):S(s[0][2],w)}function m(w){d("next",w)}function g(w){d("throw",w)}function S(w,E){w(E),s.shift(),s.length&&d(s[0][0],s[0][1])}}function Jd(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof Jr=="function"?Jr(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=e[s]&&function(c){return new Promise(function(f,d){c=e[s](c),a(f,d,c.done,c.value)})}}function a(s,c,f,d){Promise.resolve(d).then(function(v){s({value:v,done:f})},c)}}var zc=(function(e){return e&&typeof e.length=="number"&&typeof e!="function"});function Qc(e){return Te(e?.then)}function us(e){var t=function(n){Error.call(n),n.stack=new Error().stack},r=e(t);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var fo=us(function(e){return function(r){e(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,a){return a+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function To(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var fa=(function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,r,n,a,s;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var f=Jr(c),d=f.next();!d.done;d=f.next()){var v=d.value;v.remove(this)}}catch(O){t={error:O}}finally{try{d&&!d.done&&(r=f.return)&&r.call(f)}finally{if(t)throw t.error}}else c.remove(this);var m=this.initialTeardown;if(Te(m))try{m()}catch(O){s=O instanceof fo?O.errors:[O]}var g=this._finalizers;if(g){this._finalizers=null;try{for(var S=Jr(g),w=S.next();!w.done;w=S.next()){var E=w.value;try{wu(E)}catch(O){s=s??[],O instanceof fo?s=kr(kr([],Sr(s)),Sr(O.errors)):s.push(O)}}}catch(O){n={error:O}}finally{try{w&&!w.done&&(a=S.return)&&a.call(S)}finally{if(n)throw n.error}}}if(s)throw new fo(s)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)wu(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(t)}},e.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},e.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},e.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&To(r,t)},e.prototype.remove=function(t){var r=this._finalizers;r&&To(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=(function(){var t=new e;return t.closed=!0,t})(),e})(),Vc=fa.EMPTY;function Gc(e){return e instanceof fa||e&&"closed"in e&&Te(e.remove)&&Te(e.add)&&Te(e.unsubscribe)}function wu(e){Te(e)?e():e.unsubscribe()}var Xd={Promise:void 0},Zd={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return setTimeout.apply(void 0,kr([e,t],Sr(r)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function Yc(e){Zd.setTimeout(function(){throw e})}function _u(){}function $i(e){e()}var cs=(function(e){Cr(t,e);function t(r){var n=e.call(this)||this;return n.isStopped=!1,r?(n.destination=r,Gc(r)&&r.add(n)):n.destination=rp,n}return t.create=function(r,n,a){return new Xr(r,n,a)},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t})(fa),ep=(function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var r=this.partialObserver;if(r.next)try{r.next(t)}catch(n){Mi(n)}},e.prototype.error=function(t){var r=this.partialObserver;if(r.error)try{r.error(t)}catch(n){Mi(n)}else Mi(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(r){Mi(r)}},e})(),Xr=(function(e){Cr(t,e);function t(r,n,a){var s=e.call(this)||this,c;return Te(r)||!r?c={next:r??void 0,error:n??void 0,complete:a??void 0}:c=r,s.destination=new ep(c),s}return t})(cs);function Mi(e){Yc(e)}function tp(e){throw e}var rp={closed:!0,next:_u,error:tp,complete:_u},ls=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function Vn(e){return e}function np(e){return e.length===0?Vn:e.length===1?e[0]:function(r){return e.reduce(function(n,a){return a(n)},r)}}var Xe=(function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var a=this,s=ap(t)?t:new Xr(t,r,n);return $i(function(){var c=a,f=c.operator,d=c.source;s.add(f?f.call(s,d):d?a._subscribe(s):a._trySubscribe(s))}),s},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.error(r)}},e.prototype.forEach=function(t,r){var n=this;return r=Eu(r),new r(function(a,s){var c=new Xr({next:function(f){try{t(f)}catch(d){s(d),c.unsubscribe()}},error:s,complete:a});n.subscribe(c)})},e.prototype._subscribe=function(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)},e.prototype[ls]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return np(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=Eu(t),new t(function(n,a){var s;r.subscribe(function(c){return s=c},function(c){return a(c)},function(){return n(s)})})},e.create=function(t){return new e(t)},e})();function Eu(e){var t;return(t=e??Xd.Promise)!==null&&t!==void 0?t:Promise}function ip(e){return e&&Te(e.next)&&Te(e.error)&&Te(e.complete)}function ap(e){return e&&e instanceof cs||ip(e)&&Gc(e)}function Jc(e){return Te(e[ls])}function Xc(e){return Symbol.asyncIterator&&Te(e?.[Symbol.asyncIterator])}function Zc(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function op(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var el=op();function tl(e){return Te(e?.[el])}function rl(e){return Yd(this,arguments,function(){var r,n,a,s;return Hc(this,function(c){switch(c.label){case 0:r=e.getReader(),c.label=1;case 1:c.trys.push([1,,9,10]),c.label=2;case 2:return[4,Wr(r.read())];case 3:return n=c.sent(),a=n.value,s=n.done,s?[4,Wr(void 0)]:[3,5];case 4:return[2,c.sent()];case 5:return[4,Wr(a)];case 6:return[4,c.sent()];case 7:return c.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function nl(e){return Te(e?.getReader)}function Lt(e){if(e instanceof Xe)return e;if(e!=null){if(Jc(e))return sp(e);if(zc(e))return up(e);if(Qc(e))return cp(e);if(Xc(e))return il(e);if(tl(e))return lp(e);if(nl(e))return fp(e)}throw Zc(e)}function sp(e){return new Xe(function(t){var r=e[ls]();if(Te(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function up(e){return new Xe(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}function cp(e){return new Xe(function(t){e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,Yc)})}function lp(e){return new Xe(function(t){var r,n;try{for(var a=Jr(e),s=a.next();!s.done;s=a.next()){var c=s.value;if(t.next(c),t.closed)return}}catch(f){r={error:f}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}t.complete()})}function il(e){return new Xe(function(t){hp(e,t).catch(function(r){return t.error(r)})})}function fp(e){return il(rl(e))}function hp(e,t){var r,n,a,s;return Gd(this,void 0,void 0,function(){var c,f;return Hc(this,function(d){switch(d.label){case 0:d.trys.push([0,5,6,11]),r=Jd(e),d.label=1;case 1:return[4,r.next()];case 2:if(n=d.sent(),!!n.done)return[3,4];if(c=n.value,t.next(c),t.closed)return[2];d.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return f=d.sent(),a={error:f},[3,11];case 6:return d.trys.push([6,,9,10]),n&&!n.done&&(s=r.return)?[4,s.call(r)]:[3,8];case 7:d.sent(),d.label=8;case 8:return[3,10];case 9:if(a)throw a.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function Tt(e,t,r,n,a){return new dp(e,t,r,n,a)}var dp=(function(e){Cr(t,e);function t(r,n,a,s,c,f){var d=e.call(this,r)||this;return d.onFinalize=c,d.shouldUnsubscribe=f,d._next=n?function(v){try{n(v)}catch(m){r.error(m)}}:e.prototype._next,d._error=s?function(v){try{s(v)}catch(m){r.error(m)}finally{this.unsubscribe()}}:e.prototype._error,d._complete=a?function(){try{a()}catch(v){r.error(v)}finally{this.unsubscribe()}}:e.prototype._complete,d}return t.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},t})(cs),al={now:function(){return(al.delegate||Date).now()},delegate:void 0};function pp(e){return e&&Te(e.schedule)}function fs(e){return e[e.length-1]}function mp(e){return Te(fs(e))?e.pop():void 0}function Gn(e){return pp(fs(e))?e.pop():void 0}function ol(e,t){return typeof fs(e)=="number"?e.pop():t}function Yt(e,t,r,n,a){n===void 0&&(n=0),a===void 0&&(a=!1);var s=t.schedule(function(){r(),a?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(s),!a)return s}var vp=Array.isArray,yp=Object.getPrototypeOf,gp=Object.prototype,bp=Object.keys;function wp(e){if(e.length===1){var t=e[0];if(vp(t))return{args:t,keys:null};if(_p(t)){var r=bp(t);return{args:r.map(function(n){return t[n]}),keys:r}}}return{args:e,keys:null}}function _p(e){return e&&typeof e=="object"&&yp(e)===gp}function sl(e,t){return t===void 0&&(t=0),wt(function(r,n){r.subscribe(Tt(n,function(a){return Yt(n,e,function(){return n.next(a)},t)},function(){return Yt(n,e,function(){return n.complete()},t)},function(a){return Yt(n,e,function(){return n.error(a)},t)}))})}function ul(e,t){return t===void 0&&(t=0),wt(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}function Ep(e,t){return Lt(e).pipe(ul(t),sl(t))}function Sp(e,t){return Lt(e).pipe(ul(t),sl(t))}function kp(e,t){return new Xe(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}function xp(e,t){return new Xe(function(r){var n;return Yt(r,t,function(){n=e[el](),Yt(r,t,function(){var a,s,c;try{a=n.next(),s=a.value,c=a.done}catch(f){r.error(f);return}c?r.complete():r.next(s)},0,!0)}),function(){return Te(n?.return)&&n.return()}})}function cl(e,t){if(!e)throw new Error("Iterable cannot be null");return new Xe(function(r){Yt(r,t,function(){var n=e[Symbol.asyncIterator]();Yt(r,t,function(){n.next().then(function(a){a.done?r.complete():r.next(a.value)})},0,!0)})})}function Op(e,t){return cl(rl(e),t)}function Ip(e,t){if(e!=null){if(Jc(e))return Ep(e,t);if(zc(e))return kp(e,t);if(Qc(e))return Sp(e,t);if(Xc(e))return cl(e,t);if(tl(e))return xp(e,t);if(nl(e))return Op(e,t)}throw Zc(e)}function Yn(e,t){return t?Ip(e,t):Lt(e)}function De(e,t){return wt(function(r,n){var a=0;r.subscribe(Tt(n,function(s){n.next(e.call(t,s,a++))}))})}var Cp=Array.isArray;function Pp(e,t){return Cp(t)?e.apply(void 0,kr([],Sr(t))):e(t)}function Dp(e){return De(function(t){return Pp(e,t)})}function Rp(e,t){return e.reduce(function(r,n,a){return r[n]=t[a],r},{})}function Ap(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Gn(e),n=mp(e),a=wp(e),s=a.args,c=a.keys;if(s.length===0)return Yn([],r);var f=new Xe(Tp(s,r,c?function(d){return Rp(c,d)}:Vn));return n?f.pipe(Dp(n)):f}function Tp(e,t,r){return r===void 0&&(r=Vn),function(n){Su(t,function(){for(var a=e.length,s=new Array(a),c=a,f=a,d=function(m){Su(t,function(){var g=Yn(e[m],t),S=!1;g.subscribe(Tt(n,function(w){s[m]=w,S||(S=!0,f--),f||n.next(r(s.slice()))},function(){--c||n.complete()}))},n)},v=0;v<a;v++)d(v)},n)}}function Su(e,t,r){e?Yt(r,e,t):t()}function Mp(e,t,r,n,a,s,c,f){var d=[],v=0,m=0,g=!1,S=function(){g&&!d.length&&!v&&t.complete()},w=function(O){return v<n?E(O):d.push(O)},E=function(O){v++;var P=!1;Lt(r(O,m++)).subscribe(Tt(t,function(B){t.next(B)},function(){P=!0},void 0,function(){if(P)try{v--;for(var B=function(){var j=d.shift();c||E(j)};d.length&&v<n;)B();S()}catch(j){t.error(j)}}))};return e.subscribe(Tt(t,w,function(){g=!0,S()})),function(){}}function Mt(e,t,r){return r===void 0&&(r=1/0),Te(t)?Mt(function(n,a){return De(function(s,c){return t(n,s,a,c)})(Lt(e(n,a)))},r):(typeof t=="number"&&(r=t),wt(function(n,a){return Mp(n,a,e,r)}))}function hs(e){return e===void 0&&(e=1/0),Mt(Vn,e)}function Np(){return hs(1)}var Lp=us(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),ut=(function(e){Cr(t,e);function t(){var r=e.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype.lift=function(r){var n=new ku(this,this);return n.operator=r,n},t.prototype._throwIfClosed=function(){if(this.closed)throw new Lp},t.prototype.next=function(r){var n=this;$i(function(){var a,s;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var c=Jr(n.currentObservers),f=c.next();!f.done;f=c.next()){var d=f.value;d.next(r)}}catch(v){a={error:v}}finally{try{f&&!f.done&&(s=c.return)&&s.call(c)}finally{if(a)throw a.error}}}})},t.prototype.error=function(r){var n=this;$i(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var a=n.observers;a.length;)a.shift().error(r)}})},t.prototype.complete=function(){var r=this;$i(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(r){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},t.prototype._innerSubscribe=function(r){var n=this,a=this,s=a.hasError,c=a.isStopped,f=a.observers;return s||c?Vc:(this.currentObservers=null,f.push(r),new fa(function(){n.currentObservers=null,To(f,r)}))},t.prototype._checkFinalizedStatuses=function(r){var n=this,a=n.hasError,s=n.thrownError,c=n.isStopped;a?r.error(s):c&&r.complete()},t.prototype.asObservable=function(){var r=new Xe;return r.source=this,r},t.create=function(r,n){return new ku(r,n)},t})(Xe),ku=(function(e){Cr(t,e);function t(r,n){var a=e.call(this)||this;return a.destination=r,a.source=n,a}return t.prototype.next=function(r){var n,a;(a=(n=this.destination)===null||n===void 0?void 0:n.next)===null||a===void 0||a.call(n,r)},t.prototype.error=function(r){var n,a;(a=(n=this.destination)===null||n===void 0?void 0:n.error)===null||a===void 0||a.call(n,r)},t.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},t.prototype._subscribe=function(r){var n,a;return(a=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&a!==void 0?a:Vc},t})(ut);function xu(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Np()(Yn(e,Gn(e)))}var Bp=new Xe(function(e){return e.complete()});function Ln(e,t){return t===void 0&&(t=Vn),e=e??$p,wt(function(r,n){var a,s=!0;r.subscribe(Tt(n,function(c){var f=t(c);(s||!e(a,f))&&(s=!1,a=f,n.next(c))}))})}function $p(e,t){return e===t}function be(e,t){return wt(function(r,n){var a=0;r.subscribe(Tt(n,function(s){return e.call(t,s,a++)&&n.next(s)}))})}var jp=us(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function Kp(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Gn(e),n=ol(e,1/0);return wt(function(a,s){hs(n)(Yn(kr([a],Sr(e)),r)).subscribe(s)})}function Fp(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Kp.apply(void 0,kr([],Sr(e)))}var Qt=(function(e){Cr(t,e);function t(r){var n=e.call(this)||this;return n._value=r,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(r){var n=e.prototype._subscribe.call(this,r);return!n.closed&&r.next(this._value),n},t.prototype.getValue=function(){var r=this,n=r.hasError,a=r.thrownError,s=r._value;if(n)throw a;return this._throwIfClosed(),s},t.prototype.next=function(r){e.prototype.next.call(this,this._value=r)},t})(ut),qp=(function(e){Cr(t,e);function t(r,n,a){r===void 0&&(r=1/0),n===void 0&&(n=1/0),a===void 0&&(a=al);var s=e.call(this)||this;return s._bufferSize=r,s._windowTime=n,s._timestampProvider=a,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=n===1/0,s._bufferSize=Math.max(1,r),s._windowTime=Math.max(1,n),s}return t.prototype.next=function(r){var n=this,a=n.isStopped,s=n._buffer,c=n._infiniteTimeWindow,f=n._timestampProvider,d=n._windowTime;a||(s.push(r),!c&&s.push(f.now()+d)),this._trimBuffer(),e.prototype.next.call(this,r)},t.prototype._subscribe=function(r){this._throwIfClosed(),this._trimBuffer();for(var n=this._innerSubscribe(r),a=this,s=a._infiniteTimeWindow,c=a._buffer,f=c.slice(),d=0;d<f.length&&!r.closed;d+=s?1:2)r.next(f[d]);return this._checkFinalizedStatuses(r),n},t.prototype._trimBuffer=function(){var r=this,n=r._bufferSize,a=r._timestampProvider,s=r._buffer,c=r._infiniteTimeWindow,f=(c?1:2)*n;if(n<1/0&&f<s.length&&s.splice(0,s.length-f),!c){for(var d=a.now(),v=0,m=1;m<s.length&&s[m]<=d;m+=2)v=m;v&&s.splice(0,v+1)}},t})(ut);function Wp(e){e===void 0&&(e={});var t=e.connector,r=t===void 0?function(){return new ut}:t,n=e.resetOnError,a=n===void 0?!0:n,s=e.resetOnComplete,c=s===void 0?!0:s,f=e.resetOnRefCountZero,d=f===void 0?!0:f;return function(v){var m,g,S,w=0,E=!1,O=!1,P=function(){g?.unsubscribe(),g=void 0},B=function(){P(),m=S=void 0,E=O=!1},j=function(){var H=m;B(),H?.unsubscribe()};return wt(function(H,ee){w++,!O&&!E&&P();var X=S=S??r();ee.add(function(){w--,w===0&&!O&&!E&&(g=ho(j,d))}),X.subscribe(ee),!m&&w>0&&(m=new Xr({next:function(Y){return X.next(Y)},error:function(Y){O=!0,P(),g=ho(B,a,Y),X.error(Y)},complete:function(){E=!0,P(),g=ho(B,c),X.complete()}}),Lt(H).subscribe(m))})(v)}}function ho(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];if(t===!0){e();return}if(t!==!1){var a=new Xr({next:function(){a.unsubscribe(),e()}});return Lt(t.apply(void 0,kr([],Sr(r)))).subscribe(a)}}function Jn(e,t,r){var n,a,s,c,f=!1;return e&&typeof e=="object"?(n=e.bufferSize,c=n===void 0?1/0:n,a=e.windowTime,t=a===void 0?1/0:a,s=e.refCount,f=s===void 0?!1:s,r=e.scheduler):c=e??1/0,Wp({connector:function(){return new qp(c,t,r)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:f})}function Xn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Gn(e);return wt(function(n,a){(r?xu(e,n,r):xu(e,n)).subscribe(a)})}function Up(e,t){return wt(function(r,n){var a=null,s=0,c=!1,f=function(){return c&&!a&&n.complete()};r.subscribe(Tt(n,function(d){a?.unsubscribe();var v=0,m=s++;Lt(e(d,m)).subscribe(a=Tt(n,function(g){return n.next(t?t(d,g,m,v++):g)},function(){a=null,f()}))},function(){c=!0,f()}))})}function ll(e){return e.documentData?e.documentData:e.previousDocumentData}function Hp(e){switch(e.operation){case"INSERT":return{operation:e.operation,id:e.documentId,doc:e.documentData,previous:null};case"UPDATE":return{operation:e.operation,id:e.documentId,doc:ge.deepFreezeWhenDevMode(e.documentData),previous:e.previousDocumentData?e.previousDocumentData:"UNKNOWN"};case"DELETE":return{operation:e.operation,id:e.documentId,doc:null,previous:e.previousDocumentData}}}var zp=new Map;function fl(e){return ht(zp,e,()=>{for(var t=new Array(e.events.length),r=e.events,n=e.collectionName,a=e.isLocal,s=ge.deepFreezeWhenDevMode,c=0;c<r.length;c++){var f=r[c];t[c]={documentId:f.documentId,collectionName:n,isLocal:a,operation:f.operation,documentData:s(f.documentData),previousDocumentData:s(f.previousDocumentData)}}return t})}function yr(e,t){return new Promise(function(r,n){var a=new Xr({next:function(s){r(s),a.unsubscribe()},error:n,complete:function(){n(new jp)}});e.subscribe(a)})}function Qp(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Gn(e),n=ol(e,1/0),a=e;return a.length?a.length===1?Lt(a[0]):hs(n)(Yn(a,r)):Bp}var Ur="ï¿¿",Hr=Number.MIN_SAFE_INTEGER;function Vp(e,t){var r=t.selector,n=e.indexes?e.indexes.slice(0):[];t.index&&(n=[t.index]);var a=!!t.sort.find(m=>Object.values(m)[0]==="desc"),s=new Set;Object.keys(r).forEach(m=>{var g=Yr(e,m);g&&g.type==="boolean"&&Object.prototype.hasOwnProperty.call(r[m],"$eq")&&s.add(m)});var c=t.sort.map(m=>Object.keys(m)[0]),f=c.filter(m=>!s.has(m)).join(","),d=-1,v;if(n.forEach(m=>{var g=!0,S=!0,w=m.map(j=>{var H=r[j],ee=H?Object.keys(H):[],X={};if(!H||!ee.length){var Y=S?Hr:Ur;X={startKey:Y,endKey:g?Ur:Hr,inclusiveStart:!0,inclusiveEnd:!0}}else ee.forEach(V=>{if(ds.has(V)){var re=H[V],se=Xp(V,re);X=Object.assign(X,se)}});return typeof X.startKey>"u"&&(X.startKey=Hr),typeof X.endKey>"u"&&(X.endKey=Ur),typeof X.inclusiveStart>"u"&&(X.inclusiveStart=!0),typeof X.inclusiveEnd>"u"&&(X.inclusiveEnd=!0),S&&!X.inclusiveStart&&(S=!1),g&&!X.inclusiveEnd&&(g=!1),X}),E=w.map(j=>j.startKey),O=w.map(j=>j.endKey),P={index:m,startKeys:E,endKeys:O,inclusiveEnd:g,inclusiveStart:S,sortSatisfiedByIndex:!a&&f===m.filter(j=>!s.has(j)).join(","),selectorSatisfiedByIndex:Jp(m,t.selector,E,O)},B=Zp(e,t,P);(B>=d||t.index)&&(d=B,v=P)}),!v)throw J("SNH",{query:t});return v}var ds=new Set(["$eq","$gt","$gte","$lt","$lte"]),Gp=new Set(["$eq","$gt","$gte"]),Yp=new Set(["$eq","$lt","$lte"]);function Jp(e,t,r,n){var a=Object.entries(t),s=a.find(([V,re])=>{if(!e.includes(V))return!0;var se=Object.entries(re).find(([fe,Ee])=>!ds.has(fe));return se});if(s||t.$and||t.$or)return!1;var c=[],f=new Set;for(var[d,v]of Object.entries(t)){if(!e.includes(d))return!1;var m=Object.keys(v).filter(V=>Gp.has(V));if(m.length>1)return!1;var g=m[0];if(g&&f.add(d),g!=="$eq"){if(c.length>0)return!1;c.push(g)}}var S=[],w=new Set;for(var[E,O]of Object.entries(t)){if(!e.includes(E))return!1;var P=Object.keys(O).filter(V=>Yp.has(V));if(P.length>1)return!1;var B=P[0];if(B&&w.add(E),B!=="$eq"){if(S.length>0)return!1;S.push(B)}}var j=0;for(var H of e){for(var ee of[f,w]){if(!ee.has(H)&&ee.size>0)return!1;ee.delete(H)}var X=r[j],Y=n[j];if(X!==Y&&f.size>0&&w.size>0)return!1;j++}return!0}function Xp(e,t){switch(e){case"$eq":return{startKey:t,endKey:t,inclusiveEnd:!0,inclusiveStart:!0};case"$lte":return{endKey:t,inclusiveEnd:!0};case"$gte":return{startKey:t,inclusiveStart:!0};case"$lt":return{endKey:t,inclusiveEnd:!1};case"$gt":return{startKey:t,inclusiveStart:!1};default:throw new Error("SNH")}}function Zp(e,t,r){var n=0,a=m=>{m>0&&(n=n+m)},s=10,c=ao(r.startKeys,m=>m!==Hr&&m!==Ur);a(c*s);var f=ao(r.startKeys,m=>m!==Ur&&m!==Hr);a(f*s);var d=ao(r.startKeys,(m,g)=>m===r.endKeys[g]);a(d*s*1.5);var v=r.sortSatisfiedByIndex?5:0;return a(v),n}class ha extends Error{}const Bn=Symbol("missing"),hl=Object.freeze(new Error("mingo: cycle detected while processing object/array")),da=e=>{const t=ji(e);let r=0,n=t.length;for(;n;)r=(r<<5)-r^t.charCodeAt(--n);return r>>>0},Gt=e=>typeof e!="object"&&typeof e!="function"||e===null,dl=e=>Gt(e)||jn(e)||gr(e),pl={undefined:1,null:2,number:3,string:4,symbol:5,object:6,array:7,arraybuffer:8,boolean:9,date:10,regexp:11,function:12},er=(e,t)=>{e===Bn&&(e=void 0),t===Bn&&(t=void 0);const[r,n]=[e,t].map(a=>pl[$n(a)]||0);return r!==n?r-n:Jt(e,t)?0:e<t?-1:e>t?1:0};class Ji extends Map{#e=da;#r=new Map;#t=t=>{const r=this.#e(t);return[(this.#r.get(r)||[]).find(n=>Jt(n,t)),r]};constructor(){super()}static init(t){const r=new Ji;return t&&(r.#e=t),r}clear(){super.clear(),this.#r.clear()}delete(t){if(Gt(t))return super.delete(t);const[r,n]=this.#t(t);return super.delete(r)?(this.#r.set(n,this.#r.get(n).filter(a=>!Jt(a,r))),!0):!1}get(t){if(Gt(t))return super.get(t);const[r,n]=this.#t(t);return super.get(r)}has(t){if(Gt(t))return super.has(t);const[r,n]=this.#t(t);return super.has(r)}set(t,r){if(Gt(t))return super.set(t,r);const[n,a]=this.#t(t);if(super.has(n))super.set(n,r);else{super.set(t,r);const s=this.#r.get(a)||[];s.push(t),this.#r.set(a,s)}return this}get size(){return super.size}}function Be(e,t){if(!e)throw new ha(t)}const em=Object.keys(pl).reduce((e,t)=>(e["[object "+t[0].toUpperCase()+t.substring(1)+"]"]=t,e),{});function $n(e){const t=Object.prototype.toString.call(e);return t==="[object Object]"?e?.constructor?.name?.toLowerCase()||"object":em[t]||t.substring(8,t.length-1).toLowerCase()}const zr=e=>typeof e=="boolean",dt=e=>typeof e=="string",tm=e=>typeof e=="symbol",Je=e=>!isNaN(e)&&typeof e=="number",me=Array.isArray;function He(e){if(!e)return!1;const t=Object.getPrototypeOf(e);return(t===Object.prototype||t===null)&&$n(e)==="object"}const ml=e=>!Gt(e),jn=e=>e instanceof Date,gr=e=>e instanceof RegExp,ps=e=>typeof e=="function",Ze=e=>e==null,rm=(e,t=!0)=>!!e||t&&e==="",ms=e=>Ze(e)||dt(e)&&!e||me(e)&&e.length===0||He(e)&&Object.keys(e).length===0,Zn=e=>me(e)?e:[e],Zr=(e,t)=>!!e&&Object.prototype.hasOwnProperty.call(e,t),nm=e=>typeof ArrayBuffer<"u"&&ArrayBuffer.isView(e),Kn=(e,t)=>{if(Ze(e)||zr(e)||Je(e)||dt(e))return e;if(jn(e))return new Date(e);if(gr(e))return new RegExp(e);if(nm(e)){const r=e.constructor;return new r(e)}if(t instanceof Set||(t=new Set),t.has(e))throw hl;t.add(e);try{if(me(e)){const r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=Kn(e[n],t);return r}if(He(e)){const r={};for(const n of Object.keys(e))r[n]=Kn(e[n],t);return r}}finally{t.delete(e)}return e},Ou=e=>e===Bn;function Mo(e,t){if(Ou(e)||Ze(e))return t;if(Ou(t)||Ze(t))return e;if(Gt(e)||Gt(t))return t;me(e)&&me(t)&&Be(e.length===t.length,"arrays must be of equal length to merge.");for(const r of Object.keys(t))e[r]=Mo(e[r],t[r]);return e}function im(e,t=da){const r=[Ji.init(t),Ji.init(t)];if(e.length===0)return[];if(e.some(n=>n.length===0))return[];if(e.length===1)return[...e];e[e.length-1].forEach(n=>r[0].set(n,!0));for(let n=e.length-2;n>-1;n--){if(e[n].forEach(a=>{r[0].has(a)&&r[1].set(a,!0)}),r[1].size===0)return[];r.reverse(),r[1].clear()}return Array.from(r[0].keys())}function vl(e,t=1){const r=new Array;function n(a,s){for(let c=0,f=a.length;c<f;c++)me(a[c])&&(s>0||s<0)?n(a[c],Math.max(-1,s-1)):r.push(a[c])}return n(e,t),r}function am(e){const t={};for(;e;){for(const r of Object.getOwnPropertyNames(e))r in t||(t[r]=e[r]);e=Object.getPrototypeOf(e)}return t}function yl(e){for(;e;){if(Object.getOwnPropertyNames(e).includes("toString"))return e.toString!==Object.prototype.toString;e=Object.getPrototypeOf(e)}return!1}function Jt(e,t){if(e===t||Object.is(e,t))return!0;if(e===null||t===null||typeof e!=typeof t||typeof e!="object"||e.constructor!==t.constructor)return!1;if(e instanceof Date)return+e==+t;if(e instanceof RegExp)return e.toString()===t.toString();const r=e.constructor;if(r===Array||r===Object){const n=Object.keys(e).sort(),a=Object.keys(t).sort();if(n.length!==a.length)return!1;for(let s=0,c=n[s];s<n.length;c=n[++s])if(c!==a[s]||!Jt(e[c],t[c]))return!1;return!0}return yl(e)&&e.toString()===t.toString()}const ji=(e,t)=>{if(e===null)return"null";if(e===void 0)return"undefined";if(dt(e)||Je(e)||zr(e))return JSON.stringify(e);if(jn(e))return e.toISOString();if(gr(e)||tm(e)||ps(e))return e.toString();if(t instanceof Set||(t=new Set),t.has(e))throw hl;try{if(t.add(e),me(e))return"["+e.map(n=>ji(n,t)).join(",")+"]";if(He(e))return"{"+Object.keys(e).sort().map(a=>`${a}:${ji(e[a],t)}`).join()+"}";const r=yl(e)?e.toString():ji(am(e),t);return $n(e)+"("+r+")"}finally{t.delete(e)}};function om(e,t){return Ze(e)?null:(t=t||da,t(e))}function sm(e,t,r=da){if(e.length<1)return new Map;const n=new Map,a=new Map;for(let s=0;s<e.length;s++){const c=e[s],f=t(c,s),d=om(f,r);if(d===null)a.has(null)?a.get(null).push(c):a.set(null,[c]);else{const v=n.has(d)?n.get(d).find(m=>Jt(m,f)):null;Ze(v)?(a.set(f,[c]),n.has(d)?n.get(d).push(f):n.set(d,[f])):a.get(v).push(c)}}return a}function No(e,t){return ml(e)?e[t]:void 0}function um(e,t){if(t<1)return e;for(;t--&&e.length===1;)e=e[0];return e}function xr(e,t,r){let n=0;function a(c,f){let d=c;for(let v=0;v<f.length;v++){const m=f[v];if(/^\d+$/.exec(m)===null&&me(d)){if(v===0&&n>0)break;n+=1;const S=f.slice(v);d=d.reduce((w,E)=>{const O=a(E,S);return O!==void 0&&w.push(O),w},[]);break}else d=No(d,m);if(d===void 0)break}return d}const s=dl(e)?e:a(e,t.split("."));return me(s)&&r?.unwrapArray?um(s,n):s}function On(e,t,r){const n=t.indexOf("."),a=n==-1?t:t.substring(0,n),s=t.substring(n+1),c=n!=-1;if(me(e)){const v=/^\d+$/.test(a),m=v&&r?.preserveIndex?[...e]:[];if(v){const g=parseInt(a);let S=No(e,g);c&&(S=On(S,s,r)),r?.preserveIndex?m[g]=S:m.push(S)}else for(const g of e){const S=On(g,t,r);r?.preserveMissing?m.push(S??Bn):(S!=null||r?.preserveIndex)&&m.push(S)}return m}const f=r?.preserveKeys?{...e}:{};let d=No(e,a);if(c&&(d=On(d,s,r)),d!==void 0)return f[a]=d,f}function Lo(e){if(me(e))for(let t=e.length-1;t>=0;t--)e[t]===Bn?e.splice(t,1):Lo(e[t]);else if(He(e))for(const t in e)Zr(e,t)&&Lo(e[t])}const Iu=/^\d+$/;function Xi(e,t,r,n){const a=t.split("."),s=a[0],c=a.slice(1).join(".");if(a.length===1)(He(e)||me(e)&&Iu.test(s))&&r(e,s);else{n?.buildGraph&&Ze(e[s])&&(e[s]={});const f=e[s];if(!f)return;const d=!!(a.length>1&&Iu.test(a[1]));me(f)&&n?.descendArray&&!d?f.forEach(v=>Xi(v,c,r,n)):Xi(f,c,r,n)}}function cm(e,t,r){Xi(e,t,(n,a)=>{n[a]=ps(r)?r(n[a]):r},{buildGraph:!0})}function Cu(e,t,r){Xi(e,t,(n,a)=>{if(me(n)){if(/^\d+$/.test(a))n.splice(parseInt(a),1);else if(r&&r.descendArray)for(const s of n)He(s)&&delete s[a]}else He(n)&&delete n[a]},r)}const lm=/^\$[a-zA-Z0-9_]+$/;function Pr(e){return lm.test(e)}function gl(e){if(dl(e))return gr(e)?{$regex:e}:{$eq:e};if(ml(e)){if(!Object.keys(e).some(Pr))return{$eq:e};if(Zr(e,"$regex")){const t={...e};return t.$regex=new RegExp(e.$regex,e.$options),delete t.$options,t}}return e}var Bo=(e=>(e[e.CLONE_OFF=0]="CLONE_OFF",e[e.CLONE_INPUT=1]="CLONE_INPUT",e[e.CLONE_OUTPUT=2]="CLONE_OUTPUT",e[e.CLONE_ALL=3]="CLONE_ALL",e))(Bo||{});class br{#e;#r;#t;constructor(t,r,n){this.#e=t,this.update(r,n)}static init(t,r,n){return t instanceof br?new br(t.#e,t.root??r,{...t.#t,...n,variables:Object.assign({},t.#t?.variables,n?.variables)}):new br(t,r,n)}update(t,r){this.#r=t;const n=Object.assign({},this.#t?.variables,r?.variables);return Object.keys(n).length?this.#t={...r,variables:n}:this.#t=r??{},this}getOptions(){return Object.freeze({...this.#e,context:Or.from(this.#e.context)})}get root(){return this.#r}get local(){return this.#t}get idKey(){return this.#e.idKey}get collation(){return this.#e?.collation}get processingMode(){return this.#e?.processingMode||0}get useStrictMode(){return this.#e?.useStrictMode}get scriptEnabled(){return this.#e?.scriptEnabled}get useGlobalContext(){return this.#e?.useGlobalContext}get hashFunction(){return this.#e?.hashFunction}get collectionResolver(){return this.#e?.collectionResolver}get jsonSchemaValidator(){return this.#e?.jsonSchemaValidator}get variables(){return this.#e?.variables}get context(){return this.#e?.context}}function fm(e){return e instanceof br?e.getOptions():Object.freeze({idKey:"_id",scriptEnabled:!0,useStrictMode:!0,useGlobalContext:!0,processingMode:0,...e,context:e?.context?Or.from(e?.context):Or.init()})}class Or{#e=new Map;constructor(){}static init(){return new Or}static from(t){const r=Or.init();return Ze(t)||t.#e.forEach((n,a)=>r.addOperators(a,n)),r}addOperators(t,r){this.#e.has(t)||this.#e.set(t,{});for(const[n,a]of Object.entries(r))this.getOperator(t,n)||(this.#e.get(t)[n]=a);return this}getOperator(t,r){return(this.#e.get(t)??{})[r]??null}addAccumulatorOps(t){return this.addOperators("accumulator",t)}addExpressionOps(t){return this.addOperators("expression",t)}addQueryOps(t){return this.addOperators("query",t)}addPipelineOps(t){return this.addOperators("pipeline",t)}addProjectionOps(t){return this.addOperators("projection",t)}addWindowOps(t){return this.addOperators("window",t)}}const dr=Or.init();function Pu(e,t){for(const[r,n]of Object.entries(t)){Be(ps(n)&&Pr(r),`'${r}' is not a valid operator`);const a=Fn(e,r,null);Be(!a||n===a,`${r} already exists for '${e}' operators. Cannot change operator function once registered.`)}switch(e){case"accumulator":dr.addAccumulatorOps(t);break;case"expression":dr.addExpressionOps(t);break;case"pipeline":dr.addPipelineOps(t);break;case"projection":dr.addProjectionOps(t);break;case"query":dr.addQueryOps(t);break;case"window":dr.addWindowOps(t);break}}function Fn(e,t,r){const{context:n,useGlobalContext:a}=r||{},s=n?n.getOperator(e,t):null;return!s&&a?dr.getOperator(e,t):s}function jr(e,t,r,n){const a=br.init(n,e);return r&&Pr(r)?bl(e,t,r,a):Zi(e,t,a)}const hm=["$$ROOT","$$CURRENT","$$REMOVE","$$NOW"];function Zi(e,t,r){if(dt(t)&&t.length>0&&t[0]==="$"){if(dm.includes(t))return t;let n=r.root;const a=t.split(".");if(hm.includes(a[0])){switch(a[0]){case"$$ROOT":break;case"$$CURRENT":n=e;break;case"$$REMOVE":n=void 0;break;case"$$NOW":n=new Date;break}t=t.slice(a[0].length+1)}else if(a[0].slice(0,2)==="$$"){n=Object.assign({},r.variables,{this:e},r?.local?.variables);const s=a[0].slice(2);Be(Zr(n,s),`Use of undefined variable: ${s}`),t=t.slice(2)}else t=t.slice(1);return t===""?n:xr(n,t)}if(me(t))return t.map(n=>Zi(e,n,r));if(He(t)){const n={},a=Object.entries(t);for(const[s,c]of a){if(Pr(s))return Be(a.length==1,"expression must have single operator."),bl(e,c,s,r);n[s]=Zi(e,c,r)}return n}return t}function bl(e,t,r,n){const a=Fn("expression",r,n);if(a)return a(e,t,n);const s=Fn("accumulator",r,n);return Be(!!s,`accumulator '${r}' is not registered.`),me(e)||(e=Zi(e,t,n),t=null),Be(me(e),`arguments must resolve to array for ${r}.`),s(e,t,n)}const dm=["$$KEEP","$$PRUNE","$$DESCEND"];function qn(e){return e instanceof Du?e:new Du(e)}function pm(...e){let t=0;return qn(()=>{for(;t<e.length;){const r=e[t].next();if(!r.done)return r;t++}return{done:!0}})}function mm(e){return!!e&&typeof e=="object"&&e?.next instanceof Function}function vm(e,t){const r=e.slice(t+1);e.splice(t),Array.prototype.push.apply(e,r)}const $o=new Error;function ym(e,t,r){let n=!1,a=-1,s=0;return function(c){try{e:for(;!n;){let f=e();a++;let d=-1;const v=t.length;let m=!1;for(;++d<v;){const g=t[d];switch(g.action){case 0:f=g.func(f,a);break;case 1:if(!g.func(f,a))continue e;break;case 2:--g.count,g.count||(m=!0);break;case 3:--g.count,g.count||vm(t,d);continue e;default:break e}}if(n=m,c)r[s++]=f;else return{value:f,done:!1}}}catch(f){if(f!==$o)throw f}return n=!0,{done:n}}}let Du=class{constructor(t){this.#e=[],this.#r=[],this.isDone=!1;let r;if(t instanceof Function&&(t={next:t}),mm(t)){const n=t;r=()=>{const a=n.next();if(a.done)throw $o;return a.value}}else if(me(t)){const n=t,a=n.length;let s=0;r=()=>{if(s<a)return n[s++];throw $o}}else if(!(t instanceof Function))throw new ha("Lazy must be initialized with an array, generator, or function.");this.#t=ym(r,this.#e,this.#r)}#e;#r;#t;push(t,r){return typeof r=="function"?this.#e.push({action:t,func:r}):typeof r=="number"&&this.#e.push({action:t,count:r}),this}next(){return this.#t()}map(t){return this.push(0,t)}filter(t){return this.push(1,t)}take(t){return t>0?this.push(2,t):this}drop(t){return t>0?this.push(3,t):this}transform(t){const r=this;let n;return qn(()=>(n||(n=qn(t(r.value()))),n.next()))}value(){return this.isDone||(this.isDone=this.#t(!0).done),this.#r}each(t){for(;;){const r=this.next();if(r.done)break;if(t(r.value)===!1)return!1}return!0}reduce(t,r){let n=this.next();for(r===void 0&&!n.done&&(r=n.value,n=this.next());!n.done;)r=t(r,n.value),n=this.next();return r}size(){return this.reduce((t,r)=>++t,0)}[Symbol.iterator](){return this}};const gm=(e,t,r)=>e.take(t),wl=(e,t,r)=>ms(t)?e:(El(t,r),e.map(_l(t,br.init(r))));function _l(e,t,r=!0){const n=t.idKey,a=Object.keys(e),s=new Array,c=new Array,f={};for(const w of a){const E=e[w];if(Je(E)||zr(E))E?c.push(w):s.push(w);else if(me(E))f[w]=O=>E.map(P=>jr(O,P,null,t.update(O))??null);else if(He(E)){const O=Object.keys(E),P=O.length==1?O[0]:"",B=Fn("projection",P,t);B?P==="$slice"&&!Zn(E[P]).every(Je)?f[w]=H=>jr(H,E,w,t.update(H)):f[w]=H=>B(H,E[P],w,t.update(H)):Pr(P)?f[w]=j=>jr(j,E[P],P,t):(El(E,t),f[w]=j=>{if(!Zr(j,w))return jr(j,E,null,t);r&&t.update(j);const H=xr(j,w),ee=_l(E,t,!1);return me(H)?H.map(ee):He(H)?ee(H):ee(j)})}else f[w]=dt(E)&&E[0]==="$"?O=>jr(O,E,w,t):O=>E}const d=Object.keys(f),v=s.includes(n);if(r&&v&&s.length===1&&!c.length&&!d.length)return w=>{const E={...w};return delete E[n],E};const g=r&&!v&&!c.includes(n),S={preserveMissing:!0};return w=>{const E={};if(s.length&&!c.length){Mo(E,w);for(const O of s)Cu(E,O,{descendArray:!0})}for(const O of c){const P=On(w,O,S)??{};Mo(E,P)}c.length&&Lo(E);for(const O of d){const P=f[O](w);P===void 0?Cu(E,O,{descendArray:!0}):cm(E,O,P)}return g&&Zr(w,n)&&(E[n]=xr(w,n)),E}}function El(e,t){let r=!1,n=!1;for(const[a,s]of Object.entries(e))Be(!a.startsWith("$"),"Field names may not start with '$'."),Be(!a.endsWith(".$"),"Positional projection operator '$' is not supported."),a!==t?.idKey&&(s===0||s===!1?r=!0:(s===1||s===!0)&&(n=!0),Be(!(r&&n),"Projection cannot have a mix of inclusion and exclusion."))}const bm=(e,t,r)=>e.drop(t),Sl=(e,t,r)=>{if(ms(t)||!He(t))return e;let n=er;const a=r.collation;return He(a)&&dt(a.locale)&&(n=_m(a)),e.transform(s=>{const c=Object.keys(t);for(const f of c.reverse()){const d=sm(s,g=>xr(g,f),r.hashFunction),v=Array.from(d.keys()).sort(n);t[f]===-1&&v.reverse();let m=0;for(const g of v)for(const S of d.get(g))s[m++]=S;Be(m==s.length,"bug: counter must match collection size.")}return s})},wm={1:"base",2:"accent",3:"variant"};function _m(e){const t={sensitivity:wm[e.strength||3],caseFirst:e.caseFirst==="off"?"false":e.caseFirst||"false",numeric:e.numericOrdering||!1,ignorePunctuation:e.alternate==="shifted"};(e.caseLevel||!1)===!0&&(t.sensitivity==="base"&&(t.sensitivity="case"),t.sensitivity==="accent"&&(t.sensitivity="variant"));const r=new Intl.Collator(e.locale,t);return(n,a)=>{if(!dt(n)||!dt(a))return er(n,a);const s=r.compare(n,a);return s<0?-1:s>0?1:0}}const Em={$sort:Sl,$skip:bm,$limit:gm};class Sm{#e;#r;#t;#i;#o={};#n=null;#a=[];constructor(t,r,n,a){this.#e=t,this.#r=r,this.#t=n,this.#i=a}fetch(){if(this.#n)return this.#n;this.#n=qn(this.#e).filter(this.#r);const t=this.#i.processingMode;t&Bo.CLONE_INPUT&&this.#n.map(Kn);for(const r of["$sort","$skip","$limit"])Zr(this.#o,r)&&(this.#n=Em[r](this.#n,this.#o[r],this.#i));return Object.keys(this.#t).length&&(this.#n=wl(this.#n,this.#t,this.#i)),t&Bo.CLONE_OUTPUT&&this.#n.map(Kn),this.#n}fetchAll(){const t=qn([...this.#a]);return this.#a=[],pm(t,this.fetch())}all(){return this.fetchAll().value()}count(){return this.all().length}skip(t){return this.#o.$skip=t,this}limit(t){return this.#o.$limit=t,this}sort(t){return this.#o.$sort=t,this}collation(t){return this.#i={...this.#i,collation:t},this}next(){if(this.#a.length>0)return this.#a.pop();const t=this.fetch().next();if(!t.done)return t.value}hasNext(){if(this.#a.length>0)return!0;const t=this.fetch().next();return t.done?!1:(this.#a.push(t.value),!0)}map(t){return this.all().map(t)}forEach(t){this.all().forEach(t)}[Symbol.iterator](){return this.fetchAll()}}const km=new Set(Array.from(["$and","$or","$nor","$expr","$jsonSchema"]));class ei{#e;#r;#t;constructor(t,r){this.#t=Kn(t),this.#r=fm(r),this.#e=[],this.compile()}compile(){Be(He(this.#t),`query criteria must be an object: ${JSON.stringify(this.#t)}`);const t={};for(const[r,n]of Object.entries(this.#t)){if(r==="$where")Be(this.#r.scriptEnabled,"$where operator requires 'scriptEnabled' option to be true."),Object.assign(t,{field:r,expr:n});else if(km.has(r))this.processOperator(r,r,n);else{Be(!Pr(r),`unknown top level operator: ${r}`);for(const[a,s]of Object.entries(gl(n)))this.processOperator(r,a,s)}t.field&&this.processOperator(t.field,t.field,t.expr)}}processOperator(t,r,n){const a=Fn("query",r,this.#r);Be(!!a,`unknown query operator ${r}`),this.#e.push(a(t,n,this.#r))}test(t){return this.#e.every(r=>r(t))}find(t,r){return new Sm(t,n=>this.test(n),r||{},this.#r)}remove(t){return t.reduce((r,n)=>(this.test(n)||r.push(n),r),[])}}const xm=["monday","mon","tuesday","tue","wednesday","wed","thursday","thu","friday","fri","saturday","sat","sunday","sun"];new Set(xm);function rt(e){return(r,n,a)=>{const s={unwrapArray:!0},c=Math.max(1,r.split(".").length-1);return f=>{const d=xr(f,r,s);return e(d,n,{...a,depth:c})}}}function kl(e,t,r){return Jt(e,t)||Ze(e)&&Ze(t)?!0:me(e)?e.some(n=>Jt(n,t))||vl(e,r?.depth).some(n=>Jt(n,t)):!1}function Om(e,t,r){return!kl(e,t,r)}function xl(e,t,r){return Ze(e)?t.some(n=>n===null):im([Zn(e),t],r?.hashFunction).length>0}function Im(e,t,r){return!xl(e,t,r)}function Cm(e,t,r){return pa(e,t,(n,a)=>er(n,a)<0)}function Pm(e,t,r){return pa(e,t,(n,a)=>er(n,a)<=0)}function Dm(e,t,r){return pa(e,t,(n,a)=>er(n,a)>0)}function Rm(e,t,r){return pa(e,t,(n,a)=>er(n,a)>=0)}function Am(e,t,r){return Zn(e).some(n=>t.length===2&&n%t[0]===t[1])}function Tm(e,t,r){const n=Zn(e),a=s=>dt(s)&&rm(t.exec(s),r?.useStrictMode);return n.some(a)||vl(n,1).some(a)}function Mm(e,t,r){return Array.isArray(e)&&e.length===t}function Nm(e){return Pr(e)&&["$and","$or","$nor"].indexOf(e)===-1}function Lm(e,t,r){if(me(e)&&!ms(e)){let n=c=>c,a=t;Object.keys(t).every(Nm)&&(a={temp:t},n=c=>({temp:c}));const s=new ei(a,r);for(let c=0,f=e.length;c<f;c++)if(s.test(n(e[c])))return!0}return!1}const Ru=e=>e===null,Bm={array:me,boolean:zr,bool:zr,date:jn,number:Je,int:Je,long:Je,double:Je,decimal:Je,null:Ru,object:He,regexp:gr,regex:gr,string:dt,undefined:Ze,function:e=>{throw new ha("unsupported type key `function`.")},1:Je,2:dt,3:He,4:me,6:Ze,8:zr,9:jn,10:Ru,11:gr,16:Je,18:Je,19:Je};function Au(e,t,r){const n=Bm[t];return n?n(e):!1}function $m(e,t,r){return me(t)?t.findIndex(n=>Au(e,n))>=0:Au(e,t)}function pa(e,t,r){return Zn(e).some(n=>$n(n)===$n(t)&&r(n,t))}const Tu=(e,t)=>{const r={};return e.split("").forEach((n,a)=>r[n]=t*(a+1)),r};({...Tu("ABCDEFGHIKLM",1),...Tu("NOPQRSTUVWXY",-1)});const Mu={undefined:null,null:null,NaN:NaN,Infinity:new Error,"-Infinity":new Error};function nt(e,t=Mu){const r=Object.assign({},Mu,t),n=new Set(Object.keys(r));return(a,s,c)=>{const f=jr(a,s,null,c);if(n.has(`${f}`)){const d=r[`${f}`];if(d instanceof Error)throw new ha(`cannot apply $${e.name} to -inf, value must in (-inf,inf)`);return d}return e(f)}}nt(Math.acos,{Infinity:1/0,0:new Error});nt(Math.acosh,{Infinity:1/0,0:new Error});nt(Math.asin);nt(Math.asinh,{Infinity:1/0,"-Infinity":-1/0});nt(Math.atan);nt(Math.atanh,{1:1/0,"-1":-1/0});nt(Math.cos);nt(Math.cosh,{"-Infinity":1/0,Infinity:1/0});const jm=Math.PI/180;nt(e=>e*jm,{Infinity:1/0,"-Infinity":1/0});const Km=180/Math.PI;nt(e=>e*Km,{Infinity:1/0,"-Infinity":-1/0});nt(Math.sin);nt(Math.sinh,{"-Infinity":-1/0,Infinity:1/0});nt(Math.tan);const Fm=(e,t,r)=>{Be(me(t),"Invalid expression: $and expects value to be an Array.");const n=t.map(a=>new ei(a,r));return a=>n.every(s=>s.test(a))},Ol=(e,t,r)=>{Be(me(t),"Invalid expression. $or expects value to be an Array");const n=t.map(a=>new ei(a,r));return a=>n.some(s=>s.test(a))},qm=(e,t,r)=>{Be(me(t),"Invalid expression. $nor expects value to be an array.");const n=Ol("$or",t,r);return a=>!n(a)},Wm=(e,t,r)=>{const n={};n[e]=gl(t);const a=new ei(n,r);return s=>!a.test(s)},Um=rt(kl),Hm=rt(Dm),zm=rt(Rm),Qm=rt(xl),Vm=rt(Cm),Gm=rt(Pm),Ym=rt(Om),Jm=rt(Im),Xm=rt(Am),Zm=rt(Tm),ev=rt(Lm),tv=rt(Mm),rv=(e,t,r)=>{const n=e.includes("."),a=!!t;return!n||e.match(/\.\d+$/)?s=>xr(s,e)!==void 0===a:s=>{const c=On(s,e,{preserveIndex:!0}),f=xr(c,e.substring(0,e.lastIndexOf(".")));return me(f)?f.some(d=>d!==void 0)===a:f!==void 0===a}},nv=rt($m);var Nu=!1;function iv(e){return Nu||(Pu("pipeline",{$sort:Sl,$project:wl}),Pu("query",{$and:Fm,$eq:Um,$elemMatch:ev,$exists:rv,$gt:Hm,$gte:zm,$in:Qm,$lt:Vm,$lte:Gm,$ne:Ym,$nin:Jm,$mod:Xm,$nor:qm,$not:Wm,$or:Ol,$regex:Zm,$size:tv,$type:nv}),Nu=!0),new ei(e)}function Qr(e,t){var r=tt(e.primaryKey);t=xe(t);var n=ze(t);if(typeof n.skip!="number"&&(n.skip=0),n.selector?(n.selector=n.selector,Object.entries(n.selector).forEach(([g,S])=>{(typeof S!="object"||S===null)&&(n.selector[g]={$eq:S})})):n.selector={},n.index){var a=ns(n.index);a.includes(r)||a.push(r),n.index=a}if(n.sort){var m=n.sort.find(g=>vd(g)===r);m||(n.sort=n.sort.slice(0),n.sort.push({[r]:"asc"}))}else if(n.index)n.sort=n.index.map(g=>({[g]:"asc"}));else{if(e.indexes){var s=new Set;Object.entries(n.selector).forEach(([g,S])=>{var w=!1;typeof S=="object"&&S!==null?w=!!Object.keys(S).find(E=>ds.has(E)):w=!0,w&&s.add(g)});var c=-1,f;e.indexes.forEach(g=>{var S=Vi(g)?g:[g],w=S.findIndex(E=>!s.has(E));w>0&&w>c&&(c=w,f=S)}),f&&(n.sort=f.map(g=>({[g]:"asc"})))}if(!n.sort)if(e.indexes&&e.indexes.length>0){var d=e.indexes[0],v=Vi(d)?d:[d];n.sort=v.map(g=>({[g]:"asc"}))}else n.sort=[{[r]:"asc"}]}return n}function Il(e,t){if(!t.sort)throw J("SNH",{query:t});var r=[];t.sort.forEach(a=>{var s=Object.keys(a)[0],c=Object.values(a)[0];r.push({key:s,direction:c,getValueFn:md(s)})});var n=(a,s)=>{for(var c=0;c<r.length;++c){var f=r[c],d=f.getValueFn(a),v=f.getValueFn(s);if(d!==v){var m=f.direction==="asc"?er(d,v):er(v,d);return m}}};return n}function vs(e,t){if(!t.sort)throw J("SNH",{query:t});var r=iv(t.selector),n=a=>r.test(a);return n}async function wn(e,t){var r=await e.exec();if(!r)return null;if(Array.isArray(r))return Promise.all(r.map(a=>t(a)));if(r instanceof Map)return Promise.all([...r.values()].map(a=>t(a)));var n=await t(r);return n}function ma(e,t){if(!t.sort)throw J("SNH",{query:t});var r=Vp(e,t);return{query:t,queryPlan:r}}var av="_rxdb_internal";async function ti(e,t){var r=await e.findDocumentsById([t],!1),n=r[0];if(n)return n}async function Wn(e,t,r){var n=await e.bulkWrite([t],r);if(n.error.length>0){var a=n.error[0];throw a}else{var s=tt(e.schema.primaryKey),c=ct(s,[t],n),f=c[0];return f}}function ov(e,t){var r=ti(e,t),n=e.changeStream().pipe(De(a=>a.events.find(s=>s.documentId===t)),be(a=>!!a),De(a=>Promise.resolve(oe(a).documentData)),Xn(r),Up(a=>a),be(a=>!!a));return n}function Un(e){return Object.assign({},...e.filter(t=>!!t))}function ea(e,t,r,n){if(n)throw n.status===409?J("CONFLICT",{collection:e.name,id:t,writeError:n,data:r}):n.status===422?J("VD2",{collection:e.name,id:t,writeError:n,data:r}):n}function sv(e,t,r,n,a,s,c){for(var f=!!e.schema.attachments,d=[],v=[],m=[],g=Hn(10),S={id:g,events:[],checkpoint:null,context:a},w=S.events,E=[],O=[],P=[],B=r.size>0,j,H=n.length,ee=function(){var Y=n[X],V=Y.document,re=Y.previous,se=V[t],fe=V._deleted,Ee=re&&re._deleted,ue=void 0;B&&(ue=r.get(se));var we;if(ue){var Ve=ue._rev;if(!re||re&&Ve!==re._rev){var _t={isError:!0,status:409,documentId:se,writeRow:Y,documentInDb:ue};return m.push(_t),1}var Ie=f?po(Y):Y;f&&(fe?re&&Object.keys(re._attachments).forEach(he=>{O.push({documentId:se,attachmentId:he,digest:oe(re)._attachments[he].digest})}):(Object.entries(V._attachments).find(([he,Me])=>{var it=re?re._attachments[he]:void 0;return!it&&!Me.data&&(we={documentId:se,documentInDb:ue,isError:!0,status:510,writeRow:Y,attachmentId:he}),!0}),we||Object.entries(V._attachments).forEach(([he,Me])=>{var it=re?re._attachments[he]:void 0;if(!it)E.push({documentId:se,attachmentId:he,attachmentData:Me,digest:Me.digest});else{var $t=Ie.document._attachments[he].digest;Me.data&&it.digest!==$t&&P.push({documentId:se,attachmentId:he,attachmentData:Me,digest:Me.digest})}}))),we?m.push(we):(f?v.push(po(Ie)):v.push(Ie),j=Ie);var We=null,ne=null,Se=null;if(Ee&&!fe)Se="INSERT",We=f?bt(V):V;else if(re&&!Ee&&!fe)Se="UPDATE",We=f?bt(V):V,ne=re;else if(fe)Se="DELETE",We=oe(V),ne=re;else throw J("SNH",{args:{writeRow:Y}});var $e={documentId:se,documentData:We,previousDocumentData:ne,operation:Se};w.push($e)}else{var Ae=!!fe;if(f&&Object.entries(V._attachments).forEach(([he,Me])=>{Me.data?E.push({documentId:se,attachmentId:he,attachmentData:Me,digest:Me.digest}):(we={documentId:se,isError:!0,status:510,writeRow:Y,attachmentId:he},m.push(we))}),we||(f?d.push(po(Y)):d.push(Y),j=Y),!Ae){var Oe={documentId:se,operation:"INSERT",documentData:f?bt(V):V,previousDocumentData:f&&re?bt(re):re};w.push(Oe)}}},X=0;X<H;X++)ee();return{bulkInsertDocs:d,bulkUpdateDocs:v,newestRow:j,errors:m,eventBulk:S,attachmentsAdd:E,attachmentsRemove:O,attachmentsUpdate:P}}function po(e){return{previous:e.previous,document:bt(e.document)}}function uv(e){return atob(e).length}function cv(e){var t=e.data;if(!t)return e;var r={length:uv(t),digest:e.digest,type:e.type};return r}function bt(e){if(!e._attachments||Object.keys(e._attachments).length===0)return e;var t=xe(e);return t._attachments={},Object.entries(e._attachments).forEach(([r,n])=>{t._attachments[r]=cv(n)}),t}function ri(e){return Object.assign({},e,{_meta:xe(e._meta)})}function ys(e,t,r){ge.deepFreezeWhenDevMode(r);var n=tt(t.schema.primaryKey),a={originalStorageInstance:t,schema:t.schema,internals:t.internals,collectionName:t.collectionName,databaseName:t.databaseName,options:t.options,async bulkWrite(s,c){for(var f=e.token,d=new Array(s.length),v=et(),m=0;m<s.length;m++){var g=s[m],S=ri(g.document);S._meta.lwt=v;var w=g.previous;S._rev=Rt(f,w),d[m]={document:S,previous:w}}Qe("preStorageWrite",{storageInstance:this.originalStorageInstance,rows:d});var E=await e.lockedRun(()=>t.bulkWrite(d,c)),O={error:[]};Pl.set(O,d);var P=E.error.length===0?[]:E.error.filter(Y=>Y.status===409&&!Y.writeRow.previous&&!Y.writeRow.document._deleted&&oe(Y.documentInDb)._deleted?!0:(O.error.push(Y),!1));if(P.length>0){var B=new Set,j=P.map(Y=>(B.add(Y.documentId),{previous:Y.documentInDb,document:Object.assign({},Y.writeRow.document,{_rev:Rt(e.token,Y.documentInDb)})})),H=await e.lockedRun(()=>t.bulkWrite(j,c));Er(O.error,H.error);var ee=ct(n,d,O,B),X=ct(n,j,H);return Er(ee,X),O}return O},query(s){return e.lockedRun(()=>t.query(s))},count(s){return e.lockedRun(()=>t.count(s))},findDocumentsById(s,c){return e.lockedRun(()=>t.findDocumentsById(s,c))},getAttachmentData(s,c,f){return e.lockedRun(()=>t.getAttachmentData(s,c,f))},getChangedDocumentsSince:t.getChangedDocumentsSince?(s,c)=>e.lockedRun(()=>t.getChangedDocumentsSince(oe(s),c)):void 0,cleanup(s){return e.lockedRun(()=>t.cleanup(s))},remove(){return e.storageInstances.delete(a),e.lockedRun(()=>t.remove())},close(){return e.storageInstances.delete(a),e.lockedRun(()=>t.close())},changeStream(){return t.changeStream()}};return e.storageInstances.add(a),a}function lv(e){if(e.schema.keyCompression)throw J("UT5",{args:{params:e}});if(jo(e.schema))throw J("UT6",{args:{params:e}});if(e.schema.attachments&&e.schema.attachments.compression)throw J("UT7",{args:{params:e}})}function jo(e){return!!(e.encrypted&&e.encrypted.length>0||e.attachments&&e.attachments.encrypted)}function fv(e,t,r){var n=tt(e.schema.primaryKey),a=r?r.lwt:is,s=r?r.id:"";return Qr(e.schema,{selector:{$or:[{"_meta.lwt":{$gt:a}},{"_meta.lwt":{$eq:a},[n]:{$gt:r?s:""}}],"_meta.lwt":{$gte:a}},sort:[{"_meta.lwt":"asc"},{[n]:"asc"}],skip:0,limit:t})}async function Cl(e,t,r){if(e.getChangedDocumentsSince)return e.getChangedDocumentsSince(t,r);var n=tt(e.schema.primaryKey),a=ma(e.schema,fv(e,t,r)),s=await e.query(a),c=s.documents,f=hd(c);return{documents:c,checkpoint:f?{id:f[n],lwt:f._meta.lwt}:r||{id:"",lwt:0}}}var Pl=new WeakMap,hv=new WeakMap;function ct(e,t,r,n){return ht(hv,r,()=>{var a=[],s=Pl.get(r);if(s||(s=t),r.error.length>0||n){for(var c=n||new Set,f=0;f<r.error.length;f++){var d=r.error[f];c.add(d.documentId)}for(var v=0;v<s.length;v++){var m=s[v].document;c.has(m[e])||a.push(bt(m))}}else{a.length=t.length-r.error.length;for(var g=0;g<s.length;g++){var S=s[g].document;a[g]=bt(S)}}return a})}var Dl=(function(){function e(r,n,a,s){this.queueByDocId=new Map,this.isRunning=!1,this.storageInstance=r,this.primaryPath=n,this.preWrite=a,this.postWrite=s}var t=e.prototype;return t.addWrite=function(n,a){var s=n[this.primaryPath],c=ht(this.queueByDocId,s,()=>[]),f=new Promise((d,v)=>{var m={lastKnownDocumentState:n,modifier:a,resolve:d,reject:v};oe(c).push(m),this.triggerRun()});return f},t.triggerRun=async function(){if(!(this.isRunning===!0||this.queueByDocId.size===0)){this.isRunning=!0;var n=[],a=this.queueByDocId;this.queueByDocId=new Map,await Promise.all(Array.from(a.entries()).map(async([c,f])=>{var d=dv(f.map(g=>g.lastKnownDocumentState)),v=d;for(var m of f)try{v=await m.modifier(ze(v))}catch(g){m.reject(g),m.reject=()=>{},m.resolve=()=>{}}try{await this.preWrite(v,d)}catch(g){f.forEach(S=>S.reject(g));return}n.push({previous:d,document:v})}));var s=n.length>0?await this.storageInstance.bulkWrite(n,"incremental-write"):{error:[]};return await Promise.all(ct(this.primaryPath,n,s).map(c=>{var f=c[this.primaryPath];this.postWrite(c);var d=Gr(a,f);d.forEach(v=>v.resolve(c))})),s.error.forEach(c=>{var f=c.documentId,d=Gr(a,f),v=Tn(c);if(v){var m=ht(this.queueByDocId,f,()=>[]);d.reverse().forEach(S=>{S.lastKnownDocumentState=oe(v.documentInDb),oe(m).unshift(S)})}else{var g=Nc(c);d.forEach(S=>S.reject(g))}}),this.isRunning=!1,this.triggerRun()}},e})();function Lu(e){var t=async r=>{var n=yd(r);n._deleted=r._deleted;var a=await e(n),s=Object.assign({},a,{_meta:r._meta,_attachments:r._attachments,_rev:r._rev,_deleted:typeof a._deleted<"u"?a._deleted:r._deleted});return typeof s._deleted>"u"&&(s._deleted=!1),s};return t}function dv(e){var t=e[0],r=Xt(t._rev);return e.forEach(n=>{var a=Xt(n._rev);a>r&&(t=n,r=a)}),t}var va={get primaryPath(){var e=this;if(e.isInstanceOfRxDocument)return e.collection.schema.primaryPath},get primary(){var e=this;if(e.isInstanceOfRxDocument)return e._data[e.primaryPath]},get revision(){var e=this;if(e.isInstanceOfRxDocument)return e._data._rev},get deleted$(){var e=this;if(e.isInstanceOfRxDocument)return e.$.pipe(De(t=>t._data._deleted))},get deleted$$(){var e=this,t=e.collection.database.getReactivityFactory();return t.fromObservable(e.deleted$,e.getLatest().deleted,e.collection.database)},get deleted(){var e=this;if(e.isInstanceOfRxDocument)return e._data._deleted},getLatest(){var e=this.collection._docCache.getLatestDocumentData(this.primary);return this.collection._docCache.getCachedRxDocument(e)},get $(){var e=this,t=this.primary;return e.collection.eventBulks$.pipe(be(r=>!r.isLocal),De(r=>r.events.find(n=>n.documentId===t)),be(r=>!!r),De(r=>ll(oe(r))),Xn(e.collection._docCache.getLatestDocumentData(t)),Ln((r,n)=>r._rev===n._rev),De(r=>this.collection._docCache.getCachedRxDocument(r)),Jn(zn))},get $$(){var e=this,t=e.collection.database.getReactivityFactory();return t.fromObservable(e.$,e.getLatest()._data,e.collection.database)},get$(e){if(ge.isDevMode()){if(e.includes(".item."))throw J("DOC1",{path:e});if(e===this.primaryPath)throw J("DOC2");if(this.collection.schema.finalFields.includes(e))throw J("DOC3",{path:e});var t=Yr(this.collection.schema.jsonSchema,e);if(!t)throw J("DOC4",{path:e})}return this.$.pipe(De(r=>Zt(r,e)),Ln())},get$$(e){var t=this.get$(e),r=this.collection.database.getReactivityFactory();return r.fromObservable(t,this.getLatest().get(e),this.collection.database)},populate(e){var t=Yr(this.collection.schema.jsonSchema,e),r=this.get(e);if(!r)return ss;if(!t)throw J("DOC5",{path:e});if(!t.ref)throw J("DOC6",{path:e,schemaObj:t});var n=this.collection.database.collections[t.ref];if(!n)throw J("DOC7",{ref:t.ref,path:e,schemaObj:t});return t.type==="array"?n.findByIds(r).exec().then(a=>{var s=a.values();return Array.from(s)}):n.findOne(r).exec()},get(e){return Tl(this,e)},toJSON(e=!1){if(e)return ge.deepFreezeWhenDevMode(this._data);var t=xe(this._data);return delete t._rev,delete t._attachments,delete t._deleted,delete t._meta,ge.deepFreezeWhenDevMode(t)},toMutableJSON(e=!1){return ze(this.toJSON(e))},update(e){throw ye("update")},incrementalUpdate(e){throw ye("update")},updateCRDT(e){throw ye("crdt")},putAttachment(){throw ye("attachments")},putAttachmentBase64(){throw ye("attachments")},getAttachment(){throw ye("attachments")},allAttachments(){throw ye("attachments")},get allAttachments$(){throw ye("attachments")},async modify(e,t){var r=this._data,n=await Lu(e)(r);return this._saveData(n,r)},incrementalModify(e,t){return this.collection.incrementalWriteQueue.addWrite(this._data,Lu(e)).then(r=>this.collection._docCache.getCachedRxDocument(r))},patch(e){var t=this._data,r=ze(t);return Object.entries(e).forEach(([n,a])=>{r[n]=a}),this._saveData(r,t)},incrementalPatch(e){return this.incrementalModify(t=>(Object.entries(e).forEach(([r,n])=>{t[r]=n}),t))},async _saveData(e,t){if(e=xe(e),this._data._deleted)throw J("DOC11",{id:this.primary,document:this});await Al(this.collection,e,t);var r=[{previous:t,document:e}],n=await this.collection.storageInstance.bulkWrite(r,"rx-document-save-data"),a=n.error[0];return ea(this.collection,this.primary,e,a),await this.collection._runHooks("post","save",e,this),this.collection._docCache.getCachedRxDocument(ct(this.collection.schema.primaryPath,r,n)[0])},async remove(){if(this.deleted)return Promise.reject(J("DOC13",{document:this,id:this.primary}));var e=await this.collection.bulkRemove([this]);if(e.error.length>0){var t=e.error[0];ea(this.collection,this.primary,this._data,t)}return e.success[0]},incrementalRemove(){return this.incrementalModify(async e=>(await this.collection._runHooks("pre","remove",e,this),e._deleted=!0,e)).then(async e=>(await this.collection._runHooks("post","remove",e._data,e),e))},close(){throw J("DOC14")}};function Rl(e=va){var t=function(n,a){this.collection=n,this._data=a,this._propertyCache=new Map,this.isInstanceOfRxDocument=!0};return t.prototype=e,t}function pv(e,t,r){var n=new e(t,r);return Qe("createRxDocument",n),n}function Al(e,t,r){return t._meta=Object.assign({},r._meta,t._meta),ge.isDevMode()&&e.schema.validateChange(r,t),e._runHooks("pre","save",t,r)}function Tl(e,t){return ht(e._propertyCache,t,()=>{var r=Zt(e._data,t);if(typeof r!="object"||r===null||Array.isArray(r))return ge.deepFreezeWhenDevMode(r);var n=new Proxy(xe(r),{get(a,s){if(typeof s!="string")return a[s];var c=s.charAt(s.length-1);if(c==="$")if(s.endsWith("$$")){var f=s.slice(0,-2);return e.get$$(En(t+"."+f))}else{var d=s.slice(0,-1);return e.get$(En(t+"."+d))}else if(c==="_"){var v=s.slice(0,-1);return e.populate(En(t+"."+v))}else{var m=a[s];return typeof m=="number"||typeof m=="string"||typeof m=="boolean"?m:Tl(e,En(t+"."+s))}}});return n})}function gs(e){return e[e.length-1]}function mv(e){const t=typeof e;return e!==null&&(t==="object"||t==="function")}function Bu(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!mv(e)||typeof t!="string")return e;const n=t.split(".");if(n.length===0)return r;for(let a=0;a<n.length;a++){const s=n[a];if(vv(e,s)?e=a===n.length-1?void 0:null:e=e[s],e==null){if(a!==n.length-1)return r;break}}return e===void 0?r:e}function vv(e,t){if(typeof t!="number"&&Array.isArray(e)){const r=Number.parseInt(t,10);return Number.isInteger(r)&&e[r]===e[t]}return!1}const Ml=e=>!!e.queryParams.limit,yv=e=>e.queryParams.limit===1,gv=e=>!!(e.queryParams.skip&&e.queryParams.skip>0),bv=e=>e.changeEvent.operation==="DELETE",wv=e=>e.changeEvent.operation==="INSERT",_v=e=>e.changeEvent.operation==="UPDATE",Ev=e=>Ml(e)&&e.previousResults.length>=e.queryParams.limit,Sv=e=>{const t=e.queryParams.sortFields,r=e.changeEvent.previous,n=e.changeEvent.doc;if(!n)return!1;if(!r)return!0;for(let a=0;a<t.length;a++){const s=t[a],c=Bu(r,s),f=Bu(n,s);if(c!==f)return!0}return!1},kv=e=>{const t=e.changeEvent.id;if(e.keyDocumentMap)return e.keyDocumentMap.has(t);{const r=e.queryParams.primaryKey,n=e.previousResults;for(let a=0;a<n.length;a++)if(n[a][r]===t)return!0;return!1}},xv=e=>{const t=e.previousResults[0];return!!(t&&t[e.queryParams.primaryKey]===e.changeEvent.id)},Ov=e=>{const t=gs(e.previousResults);return!!(t&&t[e.queryParams.primaryKey]===e.changeEvent.id)},Iv=e=>{const t=e.changeEvent.previous;if(!t)return!1;const r=e.previousResults[0];return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)<0:!1},Cv=e=>{const t=e.changeEvent.previous;if(!t)return!1;const r=gs(e.previousResults);return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)>0:!1},Pv=e=>{const t=e.changeEvent.doc;if(!t)return!1;const r=e.previousResults[0];return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)<0:!1},Dv=e=>{const t=e.changeEvent.doc;if(!t)return!1;const r=gs(e.previousResults);return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)>0:!1},Rv=e=>{const t=e.changeEvent.previous;return t?e.queryParams.queryMatcher(t):!1},Av=e=>{const t=e.changeEvent.doc;return t?e.queryParams.queryMatcher(t):!1},Tv=e=>e.previousResults.length===0,Mv={0:wv,1:_v,2:bv,3:Ml,4:yv,5:gv,6:Tv,7:Ev,8:xv,9:Ov,10:Sv,11:kv,12:Iv,13:Cv,14:Pv,15:Dv,16:Rv,17:Av};function Nv(e,t,r,n){var a=e.length,s=a-1,c=0;if(a===0)return e.push(t),0;for(var f;n<=s;)c=n+(s-n>>1),f=e[c],r(f,t)<=0?n=c+1:s=c-1;return r(f,t)<=0&&c++,e.splice(c,0,t),c}const Lv=e=>{},bs=e=>{e.previousResults.unshift(e.changeEvent.doc),e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,e.changeEvent.doc)},ws=e=>{e.previousResults.push(e.changeEvent.doc),e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,e.changeEvent.doc)},_s=e=>{const t=e.previousResults.shift();e.keyDocumentMap&&t&&e.keyDocumentMap.delete(t[e.queryParams.primaryKey])},Es=e=>{const t=e.previousResults.pop();e.keyDocumentMap&&t&&e.keyDocumentMap.delete(t[e.queryParams.primaryKey])},Bv=e=>{_s(e),ws(e)},$v=e=>{Es(e),bs(e)},jv=e=>{_s(e),bs(e)},Kv=e=>{Es(e),ws(e)},Nl=e=>{e.keyDocumentMap&&e.keyDocumentMap.delete(e.changeEvent.id);const t=e.queryParams.primaryKey,r=e.previousResults;for(let n=0;n<r.length;n++)if(r[n][t]===e.changeEvent.id){r.splice(n,1);break}},Fv=e=>{const t=e.changeEvent.doc,r=e.queryParams.primaryKey,n=e.previousResults;for(let a=0;a<n.length;a++)if(n[a][r]===e.changeEvent.id){n[a]=t,e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,t);break}},qv=e=>{const t={_id:"wrongHuman"+new Date().getTime()};e.previousResults.length=0,e.previousResults.push(t),e.keyDocumentMap&&(e.keyDocumentMap.clear(),e.keyDocumentMap.set(t._id,t))},Ll=e=>{const t=e.changeEvent.id,r=e.changeEvent.doc;if(e.keyDocumentMap){if(e.keyDocumentMap.has(t))return;e.keyDocumentMap.set(t,r)}else if(e.previousResults.find(a=>a[e.queryParams.primaryKey]===t))return;Nv(e.previousResults,r,e.queryParams.sortComparator,0)},Wv=e=>{Nl(e),Ll(e)},Uv=e=>{throw new Error("Action runFullQueryAgain must be implemented by yourself")},Hv=e=>{throw new Error("Action unknownAction should never be called")},zv=["doNothing","insertFirst","insertLast","removeFirstItem","removeLastItem","removeFirstInsertLast","removeLastInsertFirst","removeFirstInsertFirst","removeLastInsertLast","removeExisting","replaceExisting","alwaysWrong","insertAtSortPosition","removeExistingAndInsertAtSortPosition","runFullQueryAgain","unknownAction"],Qv={doNothing:Lv,insertFirst:bs,insertLast:ws,removeFirstItem:_s,removeLastItem:Es,removeFirstInsertLast:Bv,removeLastInsertFirst:$v,removeFirstInsertFirst:jv,removeLastInsertLast:Kv,removeExisting:Nl,replaceExisting:Fv,alwaysWrong:qv,insertAtSortPosition:Ll,removeExistingAndInsertAtSortPosition:Wv,runFullQueryAgain:Uv,unknownAction:Hv},Vv=40;function mo(e){return e.charCodeAt(0)-Vv}function Gv(e){return e?"1":"0"}function $u(e,t){const r=[];for(let n=0,a=e.length;n<a;n+=t)r.push(e.substring(n,n+t));return r}function Yv(e){const t=new Map,n=2+parseInt(e.charAt(0)+e.charAt(1),10)*2,a=e.substring(2,n),s=$u(a,2);for(let O=0;O<s.length;O++){const P=s[O],B=P.charAt(0),j=mo(P.charAt(1));t.set(B,j)}const c=e.substring(n,e.length-3),f=$u(c,4);for(let O=0;O<f.length;O++){const P=f[O],B=P.charAt(0),j=P.charAt(1),H=P.charAt(2),ee=mo(P.charAt(3));if(!t.has(j))throw new Error("missing node with id "+j);if(!t.has(H))throw new Error("missing node with id "+H);const X=t.get(j),Y=t.get(H),V={l:ee,0:X,1:Y};t.set(B,V)}const d=e.slice(-3),v=d.charAt(0),m=d.charAt(1),g=mo(d.charAt(2)),S=t.get(v),w=t.get(m);return{l:g,0:S,1:w}}function Jv(e,t,r){let n=e,a=e.l;for(;;){const s=t[a](r),c=Gv(s);if(n=n[c],typeof n=="number"||typeof n=="string")return n;a=n.l}}const Xv="14a1b,c+d2e5f0g/h.i4j*k-l)m(n6oeh6pnm6qen6ril6snh6tin6ubo9vce9wmh9xns9yne9zmi9{cm9|ad9}cp9~aq9ae9Â¡bf9Â¢bq9Â£cg9Â¤ck9Â¥cn9Â¦nd9Â§np9Â¨nq9Â©nf9Âªng9Â«nm9Â¬nk9Â­mr9Â®ms9Â¯mt9Â°mj9Â±mk9Â²ml9Â³mn9Â´mc8ÂµÂ³{8Â¶Â¯}8Â·Â°Â¤8Â¸Â³Â§8Â¹mn8ÂºÂ³Â«8Â»Â³m8Â¼mÂ´4Â½zÂ²4Â¾Â³w4Â¿zÂµ4ÃÂ¯Â¶4ÃÂ°Â·4ÃÂ³Âº4ÃÂ³Â¸4ÃmÂ¹4ÃvÂ¤7Ãyn7ÃÃÃ7Ã~7ÃÂ¥Â¤7ÃÃÃ7ÃÂ¨n7ÃÂºÂ¹7ÃÂ­Â°7ÃÂ®m7ÃÂ¯Â°7ÃÂ±m7ÃÂ³m7ÃÂ¼m5ÃÃm5ÃÂ¹m5ÃÂ½Â°5ÃÂ¾m5ÃÂ¿Â°5ÃÃÃ5ÃÃm5ÃÃÃ5ÃÂ±m5ÃÂºm5ÃÃÃ5ÃÃÃ2Ã|2Ã Â¡u2Ã¡Â£Ã2Ã¢ÃÃ2Ã£Â¦Ã2Ã¤Â©x2Ã¥ÂªÃ2Ã¦ÃÃ2Ã§|Ã2Ã¨Â¡Â¢2Ã©Â£Ã2ÃªÂ¤Â¥2Ã«ÃÃ2Ã¬Â¦Ã2Ã­Â©n2Ã®Âªn2Ã¯ÃÃ2Ã°ÃÃ2Ã±Â¬n2Ã²ÃÃ/Ã³an/Ã´bn/Ãµcn/Ã¶ÃÃ¢/Ã·ÃÃ£/Ã¸Ã Ã¤/Ã¹Ã¡Ã¥/ÃºÃ¦Ã«/Ã»Ã§Ã¬/Ã¼Ã¨Ã­/Ã½Ã©Ã®/Ã¾ÃÃ/Ã¿ÃÃ/ÄÃ²Ã,Äcn,ÄÃ¶Ã¯,ÄÂ¤Ã±,ÄÃºÃ°,ÄÃªÃ±,ÄÃ¾Ã,ÄÃ¿Ã,Äac0Äbc0ÄÃ³Ãµ0ÄÃ´Ä0ÄÃÃ¡0ÄÃ Â¤0ÄÃ§Ã©0ÄÃ¨Ãª0ÄÃ·Ã¹0ÄÃ¸Ä0ÄÃ»Ã½0ÄÃ¼Ä0ÄmÃ-ÄmÄ-ÄÃÃ¦-ÄÄÄ-ÄÄÄ-ÄÄÄ-ÄÄÄ-ÄÄÄ-ÄÂ²Â»-ÄÃÃ-ÄÄÄ-ÄÂ²Â³-Ä ÄÄ3Ä¡ÄÄ3Ä¢ÄÄ3Ä£ÄÄ3Ä¤Ä¢Ä(Ä¥ÄÄ(Ä¦Ä£Ä(Ä§Ä Ä¡+Ä¨ÄÄ+Ä©Ä¤Ä¦+ÄªÄÄ+Ä«Ä§Ä¨1Ä¬Ä©Äª1Ä­Ä¬Ä«*Ä®Ä¥m*Ä­Ä®.";let vo;function Zv(){return vo||(vo=Yv(Xv)),vo}const ey=e=>Jv(Zv(),Mv,e);function ty(e){const t=ey(e);return zv[t]}function ry(e,t,r,n,a){const s=Qv[e];return s({queryParams:t,changeEvent:r,previousResults:n,keyDocumentMap:a}),n}function ny(e,t){return!t.sort||t.sort.length===0?[e]:t.sort.map(r=>Object.keys(r)[0])}var iy=new WeakMap;function ay(e){return ht(iy,e,()=>{var t=e.collection,r=Qr(t.storageInstance.schema,ze(e.mangoQuery)),n=t.schema.primaryPath,a=Il(t.schema.jsonSchema,r),s=(v,m)=>{var g={docA:v,docB:m};return a(g.docA,g.docB)},c=vs(t.schema.jsonSchema,r),f=v=>{var m={doc:v};return c(m.doc)},d={primaryKey:e.collection.schema.primaryPath,skip:r.skip,limit:r.limit,sortFields:ny(n,r),sortComparator:s,queryMatcher:f};return d})}function oy(e,t){if(!e.collection.database.eventReduce)return{runFullQueryAgain:!0};for(var r=ay(e),n=oe(e._result).docsData.slice(0),a=oe(e._result).docsDataMap,s=!1,c=[],f=0;f<t.length;f++){var d=t[f],v=Hp(d);v&&c.push(v)}var m=c.find(g=>{var S={queryParams:r,changeEvent:g,previousResults:n,keyDocumentMap:a},w=ty(S);if(w==="runFullQueryAgain")return!0;if(w!=="doNothing")return s=!0,ry(w,r,g,n,a),!1});return m?{runFullQueryAgain:!0}:{runFullQueryAgain:!1,changed:s,newResults:n}}var sy=(function(){function e(){this._map=new Map}var t=e.prototype;return t.getByQuery=function(n){var a=n.toString(),s=ht(this._map,a,()=>n);return s},e})();function uy(){return new sy}function ju(e,t){t.uncached=!0;var r=t.toString();e._map.delete(r)}function cy(e){return e.refCount$.observers.length}var ly=100,fy=30*1e3,hy=(e,t)=>(r,n)=>{if(!(n._map.size<e)){var a=et()-t,s=[],c=Array.from(n._map.values());for(var f of c)if(!(cy(f)>0)){if(f._lastEnsureEqual===0&&f._creationTime<a){ju(n,f);continue}s.push(f)}var d=s.length-e;if(!(d<=0)){var v=s.sort((g,S)=>g._lastEnsureEqual-S._lastEnsureEqual),m=v.slice(0,d);m.forEach(g=>ju(n,g))}}},Bl=hy(ly,fy),yo=new WeakSet;function dy(e){yo.has(e)||(yo.add(e),Id().then(()=>Rd(200)).then(()=>{e.closed||e.cacheReplacementPolicy(e,e._queryCache),yo.delete(e)}))}var $l=(function(){function e(r,n,a){this.cacheItemByDocId=new Map,this.tasks=new Set,this.registry=typeof FinalizationRegistry=="function"?new FinalizationRegistry(s=>{var c=s.docId,f=this.cacheItemByDocId.get(c);f&&(f[0].delete(s.revisionHeight+s.lwt+""),f[0].size===0&&this.cacheItemByDocId.delete(c))}):void 0,this.primaryPath=r,this.changes$=n,this.documentCreator=a,n.subscribe(s=>{this.tasks.add(()=>{for(var c=this.cacheItemByDocId,f=0;f<s.length;f++){var d=s[f],v=c.get(d.documentId);if(v){var m=d.documentData;m||(m=d.previousDocumentData),v[1]=m}}}),this.tasks.size<=1&&ca().then(()=>{this.processTasks()})})}var t=e.prototype;return t.processTasks=function(){if(this.tasks.size!==0){var n=Array.from(this.tasks);n.forEach(a=>a()),this.tasks.clear()}},t.getLatestDocumentData=function(n){this.processTasks();var a=Gr(this.cacheItemByDocId,n);return a[1]},t.getLatestDocumentDataIfExists=function(n){this.processTasks();var a=this.cacheItemByDocId.get(n);if(a)return a[1]},tr(e,[{key:"getCachedRxDocuments",get:function(){var r=Ku(this);return Pt(this,"getCachedRxDocuments",r)}},{key:"getCachedRxDocument",get:function(){var r=Ku(this);return Pt(this,"getCachedRxDocument",n=>r([n])[0])}}])})();function Ku(e){var t=e.primaryPath,r=e.cacheItemByDocId,n=e.registry,a=ge.deepFreezeWhenDevMode,s=e.documentCreator,c=f=>{for(var d=new Array(f.length),v=[],m=0;m<f.length;m++){var g=f[m],S=g[t],w=Xt(g._rev),E=void 0,O=void 0,P=r.get(S);P?(E=P[0],O=E.get(w+g._meta.lwt+"")):(E=new Map,P=[E,g],r.set(S,P));var B=O?O.deref():void 0;B||(g=a(g),B=s(g),E.set(w+g._meta.lwt+"",my(B)),n&&v.push(B)),d[m]=B}return v.length>0&&n&&(e.tasks.add(()=>{for(var j=0;j<v.length;j++){var H=v[j];n.register(H,{docId:H.primary,revisionHeight:Xt(H.revision),lwt:H._data._meta.lwt})}}),e.tasks.size<=1&&ca().then(()=>{e.processTasks()})),d};return c}function Ko(e,t){var r=e.getCachedRxDocuments;return r(t)}var py=typeof WeakRef=="function",my=py?vy:yy;function vy(e){return new WeakRef(e)}function yy(e){return{deref(){return e}}}var Fu=(function(){function e(r,n,a){this.time=et(),this.query=r,this.count=a,this.documents=Ko(this.query.collection._docCache,n)}var t=e.prototype;return t.getValue=function(n){var a=this.query.op;if(a==="count")return this.count;if(a==="findOne"){var s=this.documents.length===0?null:this.documents[0];if(!s&&n)throw J("QU10",{collection:this.query.collection.name,query:this.query.mangoQuery,op:a});return s}else return a==="findByIds"?this.docsMap:this.documents.slice(0)},tr(e,[{key:"docsData",get:function(){return Pt(this,"docsData",this.documents.map(r=>r._data))}},{key:"docsDataMap",get:function(){var r=new Map;return this.documents.forEach(n=>{r.set(n.primary,n._data)}),Pt(this,"docsDataMap",r)}},{key:"docsMap",get:function(){for(var r=new Map,n=this.documents,a=0;a<n.length;a++){var s=n[a];r.set(s.primary,s)}return Pt(this,"docsMap",r)}}])})(),gy=0,by=function(){return++gy},jl=(function(){function e(r,n,a,s={}){this.id=by(),this._execOverDatabaseCount=0,this._creationTime=et(),this._lastEnsureEqual=0,this.uncached=!1,this.refCount$=new Qt(null),this._result=null,this._latestChangeEvent=-1,this._ensureEqualQueue=At,this.op=r,this.mangoQuery=n,this.collection=a,this.other=s,n||(this.mangoQuery=Ki()),this.isFindOneByIdQuery=ky(this.collection.schema.primaryPath,n)}var t=e.prototype;return t._setResultData=function(n){if(typeof n>"u")throw J("QU18",{database:this.collection.database.name,collection:this.collection.name});if(typeof n=="number"){this._result=new Fu(this,[],n);return}else n instanceof Map&&(n=Array.from(n.values()));var a=new Fu(this,n,n.length);this._result=a},t._execOverDatabase=async function(){if(this._execOverDatabaseCount=this._execOverDatabaseCount+1,this.op==="count"){var n=this.getPreparedQuery(),a=await this.collection.storageInstance.count(n);if(a.mode==="slow"&&!this.collection.database.allowSlowCount)throw J("QU14",{collection:this.collection,queryObj:this.mangoQuery});return{result:a.count,counter:this.collection._changeEventBuffer.getCounter()}}if(this.op==="findByIds"){var s=oe(this.mangoQuery.selector)[this.collection.schema.primaryPath].$in,c=new Map,f=[];if(s.forEach(m=>{var g=this.collection._docCache.getLatestDocumentDataIfExists(m);if(g){if(!g._deleted){var S=this.collection._docCache.getCachedRxDocument(g);c.set(m,S)}}else f.push(m)}),f.length>0){var d=await this.collection.storageInstance.findDocumentsById(f,!1);d.forEach(m=>{var g=this.collection._docCache.getCachedRxDocument(m);c.set(g.primary,g)})}return{result:c,counter:this.collection._changeEventBuffer.getCounter()}}var v=await Sy(this);return{result:v.docs,counter:v.counter}},t.exec=async function(n){if(n&&this.op!=="findOne")throw J("QU9",{collection:this.collection.name,query:this.mangoQuery,op:this.op});await qu(this);var a=oe(this._result);return a.getValue(n)},t.toString=function(){var n=Gi({op:this.op,query:Qr(this.collection.schema.jsonSchema,this.mangoQuery),other:this.other},!0),a=JSON.stringify(n);return this.toString=()=>a,a},t.getPreparedQuery=function(){var n={rxQuery:this,mangoQuery:Qr(this.collection.schema.jsonSchema,this.mangoQuery)};n.mangoQuery.selector._deleted={$eq:!1},n.mangoQuery.index&&n.mangoQuery.index.unshift("_deleted"),Qe("prePrepareQuery",n);var a=ma(this.collection.schema.jsonSchema,n.mangoQuery);return this.getPreparedQuery=()=>a,a},t.doesDocumentDataMatch=function(n){return n._deleted?!1:this.queryMatcher(n)},t.remove=async function(){var n=await this.exec();if(Array.isArray(n)){var a=await this.collection.bulkRemove(n);if(a.error.length>0)throw Nc(a.error[0]);return a.success}else return n.remove()},t.incrementalRemove=function(){return wn(this.asRxQuery,n=>n.incrementalRemove())},t.update=function(n){throw ye("update")},t.patch=function(n){return wn(this.asRxQuery,a=>a.patch(n))},t.incrementalPatch=function(n){return wn(this.asRxQuery,a=>a.incrementalPatch(n))},t.modify=function(n){return wn(this.asRxQuery,a=>a.modify(n))},t.incrementalModify=function(n){return wn(this.asRxQuery,a=>a.incrementalModify(n))},t.where=function(n){throw ye("query-builder")},t.sort=function(n){throw ye("query-builder")},t.skip=function(n){throw ye("query-builder")},t.limit=function(n){throw ye("query-builder")},tr(e,[{key:"$",get:function(){if(!this._$){var r=this.collection.eventBulks$.pipe(be(n=>!n.isLocal),Xn(null),Mt(()=>qu(this)),De(()=>this._result),Jn(zn),Ln((n,a)=>!!(n&&n.time===oe(a).time)),be(n=>!!n),De(n=>oe(n).getValue()));this._$=Qp(r,this.refCount$.pipe(be(()=>!1)))}return this._$}},{key:"$$",get:function(){var r=this.collection.database.getReactivityFactory();return r.fromObservable(this.$,void 0,this.collection.database)}},{key:"queryMatcher",get:function(){var r=this.collection.schema.jsonSchema,n=Qr(this.collection.schema.jsonSchema,this.mangoQuery);return Pt(this,"queryMatcher",vs(r,n))}},{key:"asRxQuery",get:function(){return this}}])})();function Ki(){return{selector:{}}}function wy(e){return e.collection._queryCache.getByQuery(e)}function Kr(e,t,r,n){Qe("preCreateRxQuery",{op:e,queryObj:t,collection:r,other:n});var a=new jl(e,t,r,n);return a=wy(a),dy(r),a}function _y(e){var t=e.asRxQuery.collection._changeEventBuffer.getCounter();return e._latestChangeEvent>=t}async function qu(e){return e.collection.awaitBeforeReads.size>0&&await Promise.all(Array.from(e.collection.awaitBeforeReads).map(t=>t())),e._ensureEqualQueue=e._ensureEqualQueue.then(()=>Ey(e)),e._ensureEqualQueue}function Ey(e){if(e._lastEnsureEqual=et(),e.collection.database.closed||_y(e))return At;var t=!1,r=!1;if(e._latestChangeEvent===-1&&(r=!0),!r){var n=e.asRxQuery.collection._changeEventBuffer.getFrom(e._latestChangeEvent+1);if(n===null)r=!0;else{e._latestChangeEvent=e.asRxQuery.collection._changeEventBuffer.getCounter();var a=e.asRxQuery.collection._changeEventBuffer.reduceByLastOfDoc(n);if(e.op==="count"){var s=oe(e._result).count,c=s;a.forEach(d=>{var v=d.previousDocumentData&&e.doesDocumentDataMatch(d.previousDocumentData),m=e.doesDocumentDataMatch(d.documentData);!v&&m&&c++,v&&!m&&c--}),c!==s&&(t=!0,e._setResultData(c))}else{var f=oy(e,a);f.runFullQueryAgain?r=!0:f.changed&&(t=!0,e._setResultData(f.newResults))}}}return r?e._execOverDatabase().then(d=>{var v=d.result;return e._latestChangeEvent=d.counter,typeof v=="number"?((!e._result||v!==e._result.count)&&(t=!0,e._setResultData(v)),t):((!e._result||!gd(e.collection.schema.primaryPath,v,e._result.docsData))&&(t=!0,e._setResultData(v)),t)}):Promise.resolve(t)}async function Sy(e){var t=[],r=e.collection;if(e.isFindOneByIdQuery)if(Array.isArray(e.isFindOneByIdQuery)){var n=e.isFindOneByIdQuery;if(n=n.filter(m=>{var g=e.collection._docCache.getLatestDocumentDataIfExists(m);return g?(g._deleted||t.push(g),!1):!0}),n.length>0){var a=await r.storageInstance.findDocumentsById(n,!1);Er(t,a)}}else{var s=e.isFindOneByIdQuery,c=e.collection._docCache.getLatestDocumentDataIfExists(s);if(!c){var f=await r.storageInstance.findDocumentsById([s],!1);f[0]&&(c=f[0])}c&&!c._deleted&&t.push(c)}else{var d=e.getPreparedQuery(),v=await r.storageInstance.query(d);t=v.documents}return{docs:t,counter:r._changeEventBuffer.getCounter()}}function ky(e,t){if(!t.skip&&t.selector&&Object.keys(t.selector).length===1&&t.selector[e]){var r=t.selector[e];if(typeof r=="string")return r;if(Object.keys(r).length===1&&typeof r.$eq=="string"||Object.keys(r).length===1&&Array.isArray(r.$eq)&&!r.$eq.find(n=>typeof n!="string"))return r.$eq}return!1}var wr="collection",Ss="storage-token",Fi="rx-migration-status",xy="rx-pipeline-checkpoint",Oy="RxInternalDocument",ks=la({version:0,title:Oy,primaryKey:{key:"id",fields:["context","key"],separator:"|"},type:"object",properties:{id:{type:"string",maxLength:200},key:{type:"string"},context:{type:"string",enum:[wr,Ss,Fi,xy,"OTHER"]},data:{type:"object",additionalProperties:!0}},indexes:[],required:["key","context","data"],additionalProperties:!1,sharding:{shards:1,mode:"collection"}});function en(e,t){return Ir(ks,{key:e,context:t})}async function Kl(e){var t=ma(e.schema,{selector:{context:wr,_deleted:{$eq:!1}},sort:[{id:"asc"}],skip:0}),r=await e.query(t),n=r.documents;return n}var Fl="storageToken",Iy=en(Fl,Ss);async function Cy(e){var t=Hn(10),r=e.password?await e.hashFunction(JSON.stringify(e.password)):void 0,n={id:Iy,context:Ss,key:Fl,data:{rxdbVersion:e.rxdbVersion,token:t,instanceToken:e.token,passwordHash:r},_deleted:!1,_meta:tn(),_rev:ft(),_attachments:{}},a=[{document:n}],s=await e.internalStore.bulkWrite(a,"internal-add-storage-token");if(!s.error[0])return ct("id",a,s)[0];var c=oe(s.error[0]);if(c.isError&&Tn(c)){var f=c;if(!Py(f.documentInDb.data.rxdbVersion,e.rxdbVersion))throw J("DM5",{args:{database:e.name,databaseStateVersion:f.documentInDb.data.rxdbVersion,codeVersion:e.rxdbVersion}});if(r&&r!==f.documentInDb.data.passwordHash)throw J("DB1",{passwordHash:r,existingPasswordHash:f.documentInDb.data.passwordHash});var d=f.documentInDb;return oe(d)}throw c}function Py(e,t){if(!e)return!1;var r=e.split(".")[0],n=t.split(".")[0];return r==="15"&&n==="16"?!0:r===n}async function Dy(e,t,r){if(e.schema.version!==r.version)throw J("SNH",{schema:r,version:e.schema.version,name:e.name,collection:e,args:{storageCollectionName:t}});for(var n=Fo(e.name,e.schema.jsonSchema),a=en(n,wr);;){var s=await ti(e.database.internalStore,a),c=ze(oe(s)),f=c.data.connectedStorages.find(d=>d.collectionName===t&&d.schema.version===r.version);if(f)return;c.data.connectedStorages.push({collectionName:t,schema:r});try{await Wn(e.database.internalStore,{previous:oe(s),document:c},"add-connected-storage-to-collection")}catch(d){if(!Tn(d))throw d}}}function Fo(e,t){return e+"-"+t.version}function Ni(e,t){return t=xe(t),t=Ud(e,t),typeof e.jsonSchema.primaryKey!="string"&&(t=$d(e.primaryPath,e.jsonSchema,t)),t._meta=tn(),Object.prototype.hasOwnProperty.call(t,"_deleted")||(t._deleted=!1),Object.prototype.hasOwnProperty.call(t,"_attachments")||(t._attachments={}),Object.prototype.hasOwnProperty.call(t,"_rev")||(t._rev=ft()),t}async function Ry(e,t){t.multiInstance=e.multiInstance;var r=await e.storage.createStorageInstance(t);return r}async function ql(e,t,r,n,a,s,c,f){var d=await Kl(t),v=d.filter(w=>w.data.name===a),m=[];v.forEach(w=>{m.push({collectionName:w.data.name,schema:w.data.schema,isCollection:!0}),w.data.connectedStorages.forEach(E=>m.push({collectionName:E.collectionName,isCollection:!1,schema:E.schema}))});var g=new Set;if(m=m.filter(w=>{var E=w.collectionName+"||"+w.schema.version;return g.has(E)?!1:(g.add(E),!0)}),await Promise.all(m.map(async w=>{var E=await e.createStorageInstance({collectionName:w.collectionName,databaseInstanceToken:r,databaseName:n,multiInstance:s,options:{},schema:w.schema,password:c,devMode:ge.isDevMode()});await E.remove(),w.isCollection&&await Qn("postRemoveRxCollection",{storage:e,databaseName:n,collectionName:a})})),f){var S=v.map(w=>{var E=ri(w);return E._deleted=!0,E._meta.lwt=et(),E._rev=Rt(r,w),{previous:w,document:E}});await t.bulkWrite(S,"rx-database-remove-collection-all")}}function ot(e){if(e.closed)throw J("COL21",{collection:e.name,version:e.schema.version})}var Ay=(function(){function e(r){this.subs=[],this.counter=0,this.eventCounterMap=new WeakMap,this.buffer=[],this.limit=100,this.tasks=new Set,this.collection=r,this.subs.push(this.collection.eventBulks$.pipe(be(n=>!n.isLocal)).subscribe(n=>{this.tasks.add(()=>this._handleChangeEvents(n.events)),this.tasks.size<=1&&ca().then(()=>{this.processTasks()})}))}var t=e.prototype;return t.processTasks=function(){if(this.tasks.size!==0){var n=Array.from(this.tasks);n.forEach(a=>a()),this.tasks.clear()}},t._handleChangeEvents=function(n){var a=this.counter;this.counter=this.counter+n.length,n.length>this.limit?this.buffer=n.slice(n.length*-1):(Er(this.buffer,n),this.buffer=this.buffer.slice(this.limit*-1));for(var s=a+1,c=this.eventCounterMap,f=0;f<n.length;f++){var d=n[f];c.set(d,s+f)}},t.getCounter=function(){return this.processTasks(),this.counter},t.getBuffer=function(){return this.processTasks(),this.buffer},t.getArrayIndexByPointer=function(n){this.processTasks();var a=this.buffer[0],s=this.eventCounterMap.get(a);if(n<s)return null;var c=n-s;return c},t.getFrom=function(n){this.processTasks();var a=[],s=this.getArrayIndexByPointer(n);if(s===null)return null;for(;;){var c=this.buffer[s];if(s++,c)a.push(c);else return a}},t.runFrom=function(n,a){this.processTasks();var s=this.getFrom(n);if(s===null)throw new Error("out of bounds");s.forEach(c=>a(c))},t.reduceByLastOfDoc=function(n){return this.processTasks(),n.slice(0)},t.close=function(){this.tasks.clear(),this.subs.forEach(n=>n.unsubscribe())},e})();function Ty(e){return new Ay(e)}var My=new WeakMap;function Ny(e){var t=e.schema.getDocumentPrototype(),r=$y(e),n=va,a={};return[t,r,n].forEach(s=>{var c=Object.getOwnPropertyNames(s);c.forEach(f=>{var d=Object.getOwnPropertyDescriptor(s,f),v=!0;(f.startsWith("_")||f.endsWith("_")||f.startsWith("$")||f.endsWith("$"))&&(v=!1),typeof d.value=="function"?Object.defineProperty(a,f,{get(){return d.value.bind(this)},enumerable:v,configurable:!1}):(d.enumerable=v,d.configurable=!1,d.writable&&(d.writable=!1),Object.defineProperty(a,f,d))})}),a}function Ly(e){return ht(My,e,()=>Rl(Ny(e)))}function By(e,t,r){var n=pv(t,e,ge.deepFreezeWhenDevMode(r));return e._runHooksSync("post","create",r,n),Qe("postCreateRxDocument",n),n}function $y(e){var t={};return Object.entries(e.methods).forEach(([r,n])=>{t[r]=n}),t}var ta={isEqual(e,t,r){e=Wu(e),t=Wu(t);var n=Mn(bt(e),bt(t));return n},resolve(e){return e.realMasterState}};function Wu(e){return e._attachments||(e=xe(e),e._attachments={}),e}var Wl=["pre","post"],Ul=["insert","save","remove","create"],Uu=!1,Fr=new Set,Hl=(function(){function e(r,n,a,s,c={},f={},d={},v={},m={},g=Bl,S={},w=ta){this.storageInstance={},this.timeouts=new Set,this.incrementalWriteQueue={},this.awaitBeforeReads=new Set,this._incrementalUpsertQueues=new Map,this.synced=!1,this.hooks={},this._subs=[],this._docCache={},this._queryCache=uy(),this.$={},this.checkpoint$={},this._changeEventBuffer={},this.eventBulks$={},this.onClose=[],this.closed=!1,this.onRemove=[],this.database=r,this.name=n,this.schema=a,this.internalStorageInstance=s,this.instanceCreationOptions=c,this.migrationStrategies=f,this.methods=d,this.attachments=v,this.options=m,this.cacheReplacementPolicy=g,this.statics=S,this.conflictHandler=w,jy(this.asRxCollection),r&&(this.eventBulks$=r.eventBulks$.pipe(be(E=>E.collectionName===this.name))),this.database&&Fr.add(this)}var t=e.prototype;return t.prepare=async function(){if(!await qc()){for(var n=0;n<10&&Fr.size>gu;)n++,await this.promiseWait(30);if(Fr.size>gu)throw J("COL23",{database:this.database.name,collection:this.name,args:{existing:Array.from(Fr.values()).map(d=>({db:d.database?d.database.name:"",c:d.name}))}})}this.storageInstance=ys(this.database,this.internalStorageInstance,this.schema.jsonSchema),this.incrementalWriteQueue=new Dl(this.storageInstance,this.schema.primaryPath,(d,v)=>Al(this,d,v),d=>this._runHooks("post","save",d)),this.$=this.eventBulks$.pipe(Mt(d=>fl(d))),this.checkpoint$=this.eventBulks$.pipe(De(d=>d.checkpoint)),this._changeEventBuffer=Ty(this.asRxCollection);var a;this._docCache=new $l(this.schema.primaryPath,this.eventBulks$.pipe(be(d=>!d.isLocal),De(d=>d.events)),d=>(a||(a=Ly(this.asRxCollection)),By(this.asRxCollection,a,d)));var s=this.database.internalStore.changeStream().pipe(be(d=>{var v=this.name+"-"+this.schema.version,m=d.events.find(g=>g.documentData.context==="collection"&&g.documentData.key===v&&g.operation==="DELETE");return!!m})).subscribe(async()=>{await this.close(),await Promise.all(this.onRemove.map(d=>d()))});this._subs.push(s);var c=await this.database.storageToken,f=this.storageInstance.changeStream().subscribe(d=>{var v={id:d.id,isLocal:!1,internal:!1,collectionName:this.name,storageToken:c,events:d.events,databaseToken:this.database.token,checkpoint:d.checkpoint,context:d.context};this.database.$emit(v)});return this._subs.push(f),lt},t.cleanup=function(n){throw ot(this),ye("cleanup")},t.migrationNeeded=function(){throw ye("migration-schema")},t.getMigrationState=function(){throw ye("migration-schema")},t.startMigration=function(n=10){return ot(this),this.getMigrationState().startMigration(n)},t.migratePromise=function(n=10){return this.getMigrationState().migratePromise(n)},t.insert=async function(n){ot(this);var a=await this.bulkInsert([n]),s=a.error[0];ea(this,n[this.schema.primaryPath],n,s);var c=oe(a.success[0]);return c},t.insertIfNotExists=async function(n){var a=await this.bulkInsert([n]);if(a.error.length>0){var s=a.error[0];if(s.status===409){var c=s.documentInDb;return Ko(this._docCache,[c])[0]}else throw s}return a.success[0]},t.bulkInsert=async function(n){if(ot(this),n.length===0)return{success:[],error:[]};var a=this.schema.primaryPath,s=new Set,c;if(this.hasHooks("pre","insert"))c=await Promise.all(n.map(P=>{var B=Ni(this.schema,P);return this._runHooks("pre","insert",B).then(()=>(s.add(B[a]),{document:B}))}));else{c=new Array(n.length);for(var f=this.schema,d=0;d<n.length;d++){var v=n[d],m=Ni(f,v);s.add(m[a]),c[d]={document:m}}}if(s.size!==n.length)throw J("COL22",{collection:this.name,args:{documents:n}});var g=await this.storageInstance.bulkWrite(c,"rx-collection-bulk-insert"),S,w=this,E={get success(){if(!S){var P=ct(w.schema.primaryPath,c,g);S=Ko(w._docCache,P)}return S},error:g.error};if(this.hasHooks("post","insert")){var O=new Map;c.forEach(P=>{var B=P.document;O.set(B[a],B)}),await Promise.all(E.success.map(P=>this._runHooks("post","insert",O.get(P.primary),P)))}return E},t.bulkRemove=async function(n){ot(this);var a=this.schema.primaryPath;if(n.length===0)return{success:[],error:[]};var s;typeof n[0]=="string"?s=await this.findByIds(n).exec():(s=new Map,n.forEach(w=>s.set(w.primary,w)));var c=[],f=new Map;Array.from(s.values()).forEach(w=>{var E=w.toMutableJSON(!0);c.push(E),f.set(w.primary,E)}),await Promise.all(c.map(w=>{var E=w[this.schema.primaryPath];return this._runHooks("pre","remove",w,s.get(E))}));var d=c.map(w=>{var E=xe(w);return E._deleted=!0,{previous:w,document:E}}),v=await this.storageInstance.bulkWrite(d,"rx-collection-bulk-remove"),m=ct(this.schema.primaryPath,d,v),g=[],S=m.map(w=>{var E=w[a],O=this._docCache.getCachedRxDocument(w);return g.push(O),E});return await Promise.all(S.map(w=>this._runHooks("post","remove",f.get(w),s.get(w)))),{success:g,error:v.error}},t.bulkUpsert=async function(n){ot(this);var a=[],s=new Map;n.forEach(v=>{var m=Ni(this.schema,v),g=m[this.schema.primaryPath];if(!g)throw J("COL3",{primaryPath:this.schema.primaryPath,data:m,schema:this.schema.jsonSchema});s.set(g,m),a.push(m)});var c=await this.bulkInsert(a),f=c.success.slice(0),d=[];return await Promise.all(c.error.map(async v=>{if(v.status!==409)d.push(v);else{var m=v.documentId,g=Gr(s,m),S=oe(v.documentInDb),w=this._docCache.getCachedRxDocuments([S])[0],E=await w.incrementalModify(()=>g);f.push(E)}})),{error:d,success:f}},t.upsert=async function(n){ot(this);var a=await this.bulkUpsert([n]);return ea(this.asRxCollection,n[this.schema.primaryPath],n,a.error[0]),a.success[0]},t.incrementalUpsert=function(n){ot(this);var a=Ni(this.schema,n),s=a[this.schema.primaryPath];if(!s)throw J("COL4",{data:n});var c=this._incrementalUpsertQueues.get(s);return c||(c=lt),c=c.then(()=>Fy(this,s,a)).then(f=>f.inserted?f.doc:Ky(f.doc,a)),this._incrementalUpsertQueues.set(s,c),c},t.find=function(n){ot(this),Qe("prePrepareRxQuery",{op:"find",queryObj:n,collection:this}),n||(n=Ki());var a=Kr("find",n,this);return a},t.findOne=function(n){ot(this),Qe("prePrepareRxQuery",{op:"findOne",queryObj:n,collection:this});var a;if(typeof n=="string")a=Kr("findOne",{selector:{[this.schema.primaryPath]:n},limit:1},this);else{if(n||(n=Ki()),n.limit)throw J("QU6");n=xe(n),n.limit=1,a=Kr("findOne",n,this)}return a},t.count=function(n){ot(this),n||(n=Ki());var a=Kr("count",n,this);return a},t.findByIds=function(n){ot(this);var a={selector:{[this.schema.primaryPath]:{$in:n.slice(0)}}},s=Kr("findByIds",a,this);return s},t.exportJSON=function(){throw ye("json-dump")},t.importJSON=function(n){throw ye("json-dump")},t.insertCRDT=function(n){throw ye("crdt")},t.addPipeline=function(n){throw ye("pipeline")},t.addHook=function(n,a,s,c=!1){if(typeof s!="function")throw st("COL7",{key:a,when:n});if(!Wl.includes(n))throw st("COL8",{key:a,when:n});if(!Ul.includes(a))throw J("COL9",{key:a});if(n==="post"&&a==="create"&&c===!0)throw J("COL10",{when:n,key:a,parallel:c});var f=s.bind(this),d=c?"parallel":"series";this.hooks[a]=this.hooks[a]||{},this.hooks[a][n]=this.hooks[a][n]||{series:[],parallel:[]},this.hooks[a][n][d].push(f)},t.getHooks=function(n,a){return!this.hooks[a]||!this.hooks[a][n]?{series:[],parallel:[]}:this.hooks[a][n]},t.hasHooks=function(n,a){if(!this.hooks[a]||!this.hooks[a][n])return!1;var s=this.getHooks(n,a);return s?s.series.length>0||s.parallel.length>0:!1},t._runHooks=function(n,a,s,c){var f=this.getHooks(n,a);if(!f)return lt;var d=f.series.map(v=>()=>v(s,c));return Ad(d).then(()=>Promise.all(f.parallel.map(v=>v(s,c))))},t._runHooksSync=function(n,a,s,c){if(this.hasHooks(n,a)){var f=this.getHooks(n,a);f&&f.series.forEach(d=>d(s,c))}},t.promiseWait=function(n){var a=new Promise(s=>{var c=setTimeout(()=>{this.timeouts.delete(c),s()},n);this.timeouts.add(c)});return a},t.close=async function(){return this.closed?At:(Fr.delete(this),await Promise.all(this.onClose.map(n=>n())),this.closed=!0,Array.from(this.timeouts).forEach(n=>clearTimeout(n)),this._changeEventBuffer&&this._changeEventBuffer.close(),this.database.requestIdlePromise().then(()=>this.storageInstance.close()).then(()=>(this._subs.forEach(n=>n.unsubscribe()),delete this.database.collections[this.name],Qn("postCloseRxCollection",this).then(()=>!0))))},t.remove=async function(){await this.close(),await Promise.all(this.onRemove.map(n=>n())),await ql(this.database.storage,this.database.internalStore,this.database.token,this.database.name,this.name,this.database.multiInstance,this.database.password,this.database.hashFunction)},tr(e,[{key:"insert$",get:function(){return this.$.pipe(be(r=>r.operation==="INSERT"))}},{key:"update$",get:function(){return this.$.pipe(be(r=>r.operation==="UPDATE"))}},{key:"remove$",get:function(){return this.$.pipe(be(r=>r.operation==="DELETE"))}},{key:"asRxCollection",get:function(){return this}}])})();function jy(e){if(!Uu){Uu=!0;var t=Object.getPrototypeOf(e);Ul.forEach(r=>{Wl.map(n=>{var a=n+Bc(r);t[a]=function(s,c){return this.addHook(n,r,s,c)}})})}}function Ky(e,t){return e.incrementalModify(r=>t)}function Fy(e,t,r){var n=e._docCache.getLatestDocumentDataIfExists(t);return n?Promise.resolve({doc:e._docCache.getCachedRxDocuments([n])[0],inserted:!1}):e.findOne(t).exec().then(a=>a?{doc:a,inserted:!1}:e.insert(r).then(s=>({doc:s,inserted:!0})))}async function qy({database:e,name:t,schema:r,instanceCreationOptions:n={},migrationStrategies:a={},autoMigrate:s=!0,statics:c={},methods:f={},attachments:d={},options:v={},localDocuments:m=!1,cacheReplacementPolicy:g=Bl,conflictHandler:S=ta}){var w={databaseInstanceToken:e.token,databaseName:e.name,collectionName:t,schema:r.jsonSchema,options:n,multiInstance:e.multiInstance,password:e.password,devMode:ge.isDevMode()};Qe("preCreateRxStorageInstance",w);var E=await Ry(e,w),O=new Hl(e,t,r,E,n,a,f,d,v,g,c,S);try{await O.prepare(),Object.entries(c).forEach(([P,B])=>{Object.defineProperty(O,P,{get:()=>B.bind(O)})}),Qe("createRxCollection",{collection:O,creator:{name:t,schema:r,storageInstance:E,instanceCreationOptions:n,migrationStrategies:a,methods:f,attachments:d,options:v,cacheReplacementPolicy:g,localDocuments:m,statics:c}}),s&&O.schema.version!==0&&await O.migratePromise()}catch(P){throw Fr.delete(O),await E.close(),P}return O}var zl=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;this._parallels=t||1,this._qC=0,this._iC=new Set,this._lHN=0,this._hPM=new Map,this._pHM=new Map};zl.prototype={isIdle:function(){return this._qC<this._parallels},lock:function(){this._qC++},unlock:function(){this._qC--,qo(this)},wrapCall:function(t){var r=this;this._qC++;var n;try{n=t()}catch(a){throw this.unlock(),a}return!n.then||typeof n.then!="function"?(this.unlock(),n):n.then(function(a){return r.unlock(),a}).catch(function(a){throw r.unlock(),a})},requestIdlePromise:function(t){var r=this;t=t||{};var n,a=new Promise(function(f){return n=f}),s=function(){go(r,a),n()};if(a._manRes=s,t.timeout){var c=setTimeout(function(){a._manRes()},t.timeout);a._timeoutObj=c}return this._iC.add(a),qo(this),a},cancelIdlePromise:function(t){go(this,t)},requestIdleCallback:function(t,r){var n=this._lHN++,a=this.requestIdlePromise(r);return this._hPM.set(n,a),this._pHM.set(a,n),a.then(function(){return t()}),n},cancelIdleCallback:function(t){var r=this._hPM.get(t);this.cancelIdlePromise(r)},clear:function(){var t=this;this._iC.forEach(function(r){return go(t,r)}),this._qC=0,this._iC.clear(),this._hPM=new Map,this._pHM=new Map}};function Wy(e){if(e._iC.size!==0){var t=e._iC.values(),r=t.next().value;r._manRes(),setTimeout(function(){return qo(e)},0)}}function go(e,t){if(t){if(t._timeoutObj&&clearTimeout(t._timeoutObj),e._pHM.has(t)){var r=e._pHM.get(t);e._hPM.delete(r),e._pHM.delete(t)}e._iC.delete(t)}}function qo(e){e._tryIR||e._iC.size===0||(e._tryIR=!0,setTimeout(function(){if(!e.isIdle()){e._tryIR=!1;return}setTimeout(function(){if(!e.isIdle()){e._tryIR=!1;return}Wy(e),e._tryIR=!1},0)},0))}let Uy=class{ttl;map=new Map;_to=!1;constructor(t){this.ttl=t}has(t){return this.map.has(t)}add(t){this.map.set(t,Ql()),this._to||(this._to=!0,setTimeout(()=>{this._to=!1,Hy(this)},0))}clear(){this.map.clear()}};function Hy(e){const t=Ql()-e.ttl,r=e.map[Symbol.iterator]();for(;;){const n=r.next().value;if(!n)return;const a=n[0];if(n[1]<t)e.map.delete(a);else return}}function Ql(){return Date.now()}var Wo=new Set,Hu=new Map,xs=(function(){function e(r,n,a,s,c,f,d=!1,v={},m,g,S,w,E,O){this.idleQueue=new zl,this.rxdbVersion=Fc,this.storageInstances=new Set,this._subs=[],this.startupErrors=[],this.onClose=[],this.closed=!1,this.collections={},this.states={},this.eventBulks$=new ut,this.closePromise=null,this.observable$=this.eventBulks$.pipe(Mt(P=>fl(P))),this.storageToken=At,this.storageTokenDocument=At,this.emittedEventBulkIds=new Uy(60*1e3),this.name=r,this.token=n,this.storage=a,this.instanceCreationOptions=s,this.password=c,this.multiInstance=f,this.eventReduce=d,this.options=v,this.internalStore=m,this.hashFunction=g,this.cleanupPolicy=S,this.allowSlowCount=w,this.reactivity=E,this.onClosed=O,this.name!=="pseudoInstance"&&(this.internalStore=ys(this.asRxDatabase,m,ks),this.storageTokenDocument=Cy(this.asRxDatabase).catch(P=>this.startupErrors.push(P)),this.storageToken=this.storageTokenDocument.then(P=>P.data.token).catch(P=>this.startupErrors.push(P)))}var t=e.prototype;return t.getReactivityFactory=function(){if(!this.reactivity)throw J("DB14",{database:this.name});return this.reactivity},t.$emit=function(n){this.emittedEventBulkIds.has(n.id)||(this.emittedEventBulkIds.add(n.id),this.eventBulks$.next(n))},t.removeCollectionDoc=async function(n,a){var s=await ti(this.internalStore,en(Fo(n,a),wr));if(!s)throw J("SNH",{name:n,schema:a});var c=ri(s);c._deleted=!0,await this.internalStore.bulkWrite([{document:c,previous:s}],"rx-database-remove-collection")},t.addCollections=async function(n){var a={},s={},c=[],f={};await Promise.all(Object.entries(n).map(async([m,g])=>{var S=m,w=g.schema;a[S]=w;var E=Qd(w,this.hashFunction);if(s[S]=E,this.collections[m])throw J("DB3",{name:m});var O=Fo(m,w),P={id:en(O,wr),key:O,context:wr,data:{name:S,schemaHash:await E.hash,schema:E.jsonSchema,version:E.version,connectedStorages:[]},_deleted:!1,_meta:tn(),_rev:ft(),_attachments:{}};c.push({document:P});var B=Object.assign({},g,{name:S,schema:E,database:this}),j=xe(g);j.database=this,j.name=m,Qe("preCreateRxCollection",j),B.conflictHandler=j.conflictHandler,f[S]=B}));var d=await this.internalStore.bulkWrite(c,"rx-database-add-collection");await Yy(this),await Promise.all(d.error.map(async m=>{if(m.status!==409)throw J("DB12",{database:this.name,writeError:m});var g=oe(m.documentInDb),S=g.data.name,w=s[S];if(g.data.schemaHash!==await w.hash)throw J("DB6",{database:this.name,collection:S,previousSchemaHash:g.data.schemaHash,schemaHash:await w.hash,previousSchema:g.data.schema,schema:oe(a[S])})}));var v={};return await Promise.all(Object.keys(n).map(async m=>{var g=f[m],S=await qy(g);v[m]=S,this.collections[m]=S,this[m]||Object.defineProperty(this,m,{get:()=>this.collections[m]})})),v},t.lockedRun=function(n){return this.idleQueue.wrapCall(n)},t.requestIdlePromise=function(){return this.idleQueue.requestIdlePromise()},t.exportJSON=function(n){throw ye("json-dump")},t.addState=function(n){throw ye("state")},t.importJSON=function(n){throw ye("json-dump")},t.backup=function(n){throw ye("backup")},t.leaderElector=function(){throw ye("leader-election")},t.isLeader=function(){throw ye("leader-election")},t.waitForLeadership=function(){throw ye("leader-election")},t.migrationStates=function(){throw ye("migration-schema")},t.close=function(){if(this.closePromise)return this.closePromise;var{promise:n,resolve:a}=Vl(),s=c=>{this.onClosed&&this.onClosed(),this.closed=!0,a(c)};return this.closePromise=n,(async()=>{if(await Qn("preCloseRxDatabase",this),this.eventBulks$.complete(),this._subs.map(c=>c.unsubscribe()),this.name==="pseudoInstance"){s(!1);return}return this.requestIdlePromise().then(()=>Promise.all(this.onClose.map(c=>c()))).then(()=>Promise.all(Object.keys(this.collections).map(c=>this.collections[c]).map(c=>c.close()))).then(()=>this.internalStore.close()).then(()=>s(!0))})(),n},t.remove=function(){return this.close().then(()=>Vy(this.name,this.storage,this.multiInstance,this.password))},tr(e,[{key:"$",get:function(){return this.observable$}},{key:"asRxDatabase",get:function(){return this}}])})();function zy(e,t){if(Wo.has(Gl(e,t)))throw J("DB8",{name:e,storage:t.name,link:"https://rxdb.info/rx-database.html#ignoreduplicate"})}function Vl(){var e,t,r=new Promise((n,a)=>{e=n,t=a});return{promise:r,resolve:e,reject:t}}function Gl(e,t){return t.name+"|"+e}async function Yl(e,t,r,n,a,s){var c=await t.createStorageInstance({databaseInstanceToken:e,databaseName:r,collectionName:av,schema:ks,options:n,multiInstance:a,password:s,devMode:ge.isDevMode()});return c}function Qy({storage:e,instanceCreationOptions:t,name:r,password:n,multiInstance:a=!0,eventReduce:s=!0,ignoreDuplicate:c=!1,options:f={},cleanupPolicy:d,closeDuplicates:v=!1,allowSlowCount:m=!1,localDocuments:g=!1,hashFunction:S=Lc,reactivity:w}){Qe("preCreateRxDatabase",{storage:e,instanceCreationOptions:t,name:r,password:n,multiInstance:a,eventReduce:s,ignoreDuplicate:c,options:f,localDocuments:g});var E=Gl(r,e),O=Hu.get(E)||new Set,P=Vl(),B=Array.from(O),j=()=>{O.delete(P.promise),Wo.delete(E)};return O.add(P.promise),Hu.set(E,O),(async()=>{if(v&&await Promise.all(B.map(Y=>Y.catch(()=>null).then(V=>V&&V.close()))),c){if(!ge.isDevMode())throw J("DB9",{database:r})}else zy(r,e);Wo.add(E);var H=Hn(10),ee=await Yl(H,e,r,t,a,n),X=new xs(r,H,e,t,n,a,s,f,ee,S,d,m,w,j);return await Qn("createRxDatabase",{database:X,creator:{storage:e,instanceCreationOptions:t,name:r,password:n,multiInstance:a,eventReduce:s,ignoreDuplicate:c,options:f,localDocuments:g}}),X})().then(H=>{P.resolve(H)}).catch(H=>{P.reject(H),j()}),P.promise}async function Vy(e,t,r=!0,n){var a=Hn(10),s=await Yl(a,t,e,{},r,n),c=await Kl(s),f=new Set;c.forEach(v=>f.add(v.data.name));var d=Array.from(f);return await Promise.all(d.map(v=>ql(t,s,a,e,v,r,n))),await Qn("postRemoveRxDatabase",{databaseName:e,storage:t}),await s.remove(),d}function Gy(e){return e instanceof xs}async function Yy(e){if(await e.storageToken,e.startupErrors[0])throw e.startupErrors[0]}var Jy={RxSchema:Uc.prototype,RxDocument:va,RxQuery:jl.prototype,RxCollection:Hl.prototype,RxDatabase:xs.prototype},bo=new Set,zu=new Set;function Uo(e){if(Qe("preAddRxPlugin",{plugin:e,plugins:bo}),!bo.has(e)){{if(zu.has(e.name))throw J("PL3",{name:e.name,plugin:e});bo.add(e),zu.add(e.name)}if(!e.rxdb)throw st("PL1",{plugin:e});e.init&&e.init(),e.prototypes&&Object.entries(e.prototypes).forEach(([t,r])=>r(Jy[t])),e.overwritable&&Object.assign(ge,e.overwritable),e.hooks&&Object.entries(e.hooks).forEach(([t,r])=>{r.after&&Nn[t].push(r.after),r.before&&Nn[t].unshift(r.before)})}}async function ra(e,t){var r=Ir(e.input.metaInstance.schema,{isCheckpoint:"1",itemId:t}),n=await e.input.metaInstance.findDocumentsById([r],!1),a=n[0];if(e.lastCheckpointDoc[t]=a,a)return a.checkpointData}async function na(e,t,r){e.checkpointQueue=e.checkpointQueue.then(async()=>{var n=e.lastCheckpointDoc[t];if(r&&!e.events.canceled.getValue()&&(!n||JSON.stringify(n.checkpointData)!==JSON.stringify(r))){var a={id:"",isCheckpoint:"1",itemId:t,_deleted:!1,_attachments:{},checkpointData:r,_meta:tn(),_rev:ft()};for(a.id=Ir(e.input.metaInstance.schema,a);!e.events.canceled.getValue();){if(n&&(a.checkpointData=Un([n.checkpointData,a.checkpointData])),a._meta.lwt=et(),a._rev=Rt(await e.checkpointKey,n),e.events.canceled.getValue())return;var s=[{previous:n,document:a}],c=await e.input.metaInstance.bulkWrite(s,"replication-set-checkpoint"),f=ct(e.primaryPath,s,c)[0];if(f){e.lastCheckpointDoc[t]=f;return}else{var d=c.error[0];if(d.status!==409)throw d;n=oe(d.documentInDb),a._rev=Rt(await e.checkpointKey,n)}}}}),await e.checkpointQueue}async function Xy(e){var t=await e.hashFunction([e.identifier,e.forkInstance.databaseName,e.forkInstance.collectionName].join("||"));return"rx_storage_replication_"+t}function Qu(e,t,r,n,a){var s=Object.assign({},n,{_attachments:t&&n._attachments?n._attachments:{},_meta:r?n._meta:Object.assign({},a?a._meta:{},{lwt:et()}),_rev:r?n._rev:ft()});return s._rev||(s._rev=Rt(e,a)),s}function Vt(e,t,r){var n=xe(e);return t||delete n._attachments,r||(delete n._meta,delete n._rev),n}function Ho(e,t){return e.hasAttachments?t.map(r=>{var n=ze(r.document);return n.docData=bt(n.docData),{document:n,previous:r.previous}}):t}function zo(e){for(;;)if(e.underlyingPersistentStorage)e=e.underlyingPersistentStorage;else return e}var qi="RxReplicationProtocolMetaData";function Vu(e,t){var r=jd(e),n={title:qi,primaryKey:{key:"id",fields:["itemId","isCheckpoint"],separator:"|"},type:"object",version:e.version,additionalProperties:!1,properties:{id:{type:"string",minLength:1,maxLength:r+2},isCheckpoint:{type:"string",enum:["0","1"],minLength:1,maxLength:1},itemId:{type:"string",maxLength:r>4?r:4},checkpointData:{type:"object",additionalProperties:!0},docData:{type:"object",properties:e.properties},isResolvedConflict:{type:"string"}},keyCompression:e.keyCompression,required:["id","isCheckpoint","itemId"]};t&&(n.encrypted=["docData"]);var a=la(n);return a}function Jl(e,t){return e.input.metaInstance.findDocumentsById(t.map(r=>{var n=Ir(e.input.metaInstance.schema,{itemId:r,isCheckpoint:"0"});return n}),!0).then(r=>{var n={};return Object.values(r).forEach(a=>{n[a.itemId]={docData:a.docData,metaDocument:a}}),n})}async function ia(e,t,r,n){var a=t[e.primaryPath],s=r?ri(r):{id:"",isCheckpoint:"0",itemId:a,docData:t,_attachments:{},_deleted:!1,_rev:ft(),_meta:{lwt:0}};s.docData=t,n&&(s.isResolvedConflict=n),s._meta.lwt=et(),s.id=Ir(e.input.metaInstance.schema,s),s._rev=Rt(await e.checkpointKey,r);var c={previous:r,document:s};return c}async function Zy(e){if(e.input.initialCheckpoint&&e.input.initialCheckpoint.downstream){var t=await ra(e,"down");t||await na(e,"down",e.input.initialCheckpoint.downstream)}var r=await e.input.hashFunction(e.input.identifier),n=e.input.replicationHandler,a=0,s=[];function c(E){e.stats.down.addNewTask=e.stats.down.addNewTask+1;var O={time:a++,task:E};s.push(O),e.streamQueue.down=e.streamQueue.down.then(()=>{for(var P=[];s.length>0;){e.events.active.down.next(!0);var B=oe(s.shift());if(!(B.time<d)){if(B.task==="RESYNC")if(P.length===0){P.push(B.task);break}else break;P.push(B.task)}}if(P.length!==0)return P[0]==="RESYNC"?v():m(P)}).then(()=>{e.events.active.down.next(!1),!e.firstSyncDone.down.getValue()&&!e.events.canceled.getValue()&&e.firstSyncDone.down.next(!0)})}if(c("RESYNC"),!e.events.canceled.getValue()){var f=n.masterChangeStream$.pipe(Mt(async E=>(await yr(e.events.active.up.pipe(be(O=>!O))),E))).subscribe(E=>{e.stats.down.masterChangeStreamEmit=e.stats.down.masterChangeStreamEmit+1,c(E)});yr(e.events.canceled.pipe(be(E=>!!E))).then(()=>f.unsubscribe())}var d=-1;async function v(){if(e.stats.down.downstreamResyncOnce=e.stats.down.downstreamResyncOnce+1,!e.events.canceled.getValue()){e.checkpointQueue=e.checkpointQueue.then(()=>ra(e,"down"));for(var E=await e.checkpointQueue,O=[];!e.events.canceled.getValue();){d=a++;var P=await n.masterChangesSince(E,e.input.pullBatchSize);if(P.documents.length===0||(E=Un([E,P.checkpoint]),O.push(w(P.documents,E)),P.documents.length<e.input.pullBatchSize))break}await Promise.all(O)}}function m(E){e.stats.down.downstreamProcessChanges=e.stats.down.downstreamProcessChanges+1;var O=[],P=null;return E.forEach(B=>{if(B==="RESYNC")throw new Error("SNH");Er(O,B.documents),P=Un([P,B.checkpoint])}),w(O,oe(P))}var g=lt,S={docs:{}};function w(E,O){var P=e.primaryPath;return e.stats.down.persistFromMaster=e.stats.down.persistFromMaster+1,E.forEach(B=>{var j=B[P];S.docs[j]=B}),S.checkpoint=O,g=g.then(()=>{var B=S.docs;S.docs={};var j=S.checkpoint,H=Object.keys(B);if(e.events.canceled.getValue()||H.length===0)return lt;var ee=[],X={},Y={},V=[];return Promise.all([e.input.forkInstance.findDocumentsById(H,!0),Jl(e,H)]).then(([re,se])=>{var fe=new Map;return re.forEach(Ee=>fe.set(Ee[P],Ee)),Promise.all(H.map(async Ee=>{var ue=fe.get(Ee),we=ue?Vt(ue,e.hasAttachments,!1):void 0,Ae=B[Ee],Oe=se[Ee];Oe&&ue&&Oe.metaDocument.isResolvedConflict===ue._rev&&await e.streamQueue.up;var Ve=!Oe||!we?!1:e.input.conflictHandler.isEqual(Oe.docData,we,"downstream-check-if-equal-0");if(!Ve&&Oe&&Oe.docData._rev&&ue&&ue._meta[e.input.identifier]&&Xt(ue._rev)===ue._meta[e.input.identifier]&&(Ve=!0),ue&&Oe&&Ve===!1||ue&&!Oe)return lt;var _t=we?e.input.conflictHandler.isEqual(Ae,we,"downstream-check-if-equal-1"):!1;if(we&&_t)return(!Oe||Ve===!1)&&V.push(await ia(e,we,Oe?Oe.metaDocument:void 0)),lt;var Ie=Object.assign({},Ae,ue?{_meta:xe(ue._meta),_attachments:e.hasAttachments&&Ae._attachments?Ae._attachments:{},_rev:ft()}:{_meta:{lwt:et()},_rev:ft(),_attachments:e.hasAttachments&&Ae._attachments?Ae._attachments:{}});if(Ae._rev){var We=ue?Xt(ue._rev)+1:1;Ie._meta[e.input.identifier]=We,e.input.keepMeta&&(Ie._rev=Ae._rev)}e.input.keepMeta&&Ae._meta&&(Ie._meta=Ae._meta);var ne={previous:ue,document:Ie};ne.document._rev=ne.document._rev?ne.document._rev:Rt(r,ne.previous),ee.push(ne),X[Ee]=ne,Y[Ee]=await ia(e,Ae,Oe?Oe.metaDocument:void 0)}))}).then(async()=>{if(ee.length>0)return e.input.forkInstance.bulkWrite(ee,await e.downstreamBulkWriteFlag).then(re=>{var se=ct(e.primaryPath,ee,re);se.forEach(Ee=>{var ue=Ee[P];e.events.processed.down.next(X[ue]),V.push(Y[ue])});var fe;if(re.error.forEach(Ee=>{if(Ee.status!==409){var ue=J("RC_PULL",{writeError:Ee});e.events.error.next(ue),fe=ue}}),fe)throw fe})}).then(()=>{if(V.length>0)return e.input.metaInstance.bulkWrite(Ho(e,V),"replication-down-write-meta").then(re=>{re.error.forEach(se=>{e.events.error.next(J("RC_PULL",{id:se.documentId,writeError:se}))})})}).then(()=>{na(e,"down",j)})}).catch(B=>e.events.error.next(B)),g}}async function eg(e,t,r){var n=e.input.conflictHandler,a=n.isEqual(t.realMasterState,t.newDocumentState,"replication-resolve-conflict");if(!a){var s=await n.resolve(t,"replication-resolve-conflict"),c=Object.assign({},s,{_meta:xe(r._meta),_rev:ft(),_attachments:xe(r._attachments)});return c._meta.lwt=et(),c._rev=Rt(await e.checkpointKey,r),c}}async function Qo(e,t,r,n){if(!r._attachments||n&&!n._attachments)throw new Error("_attachments missing");var a=r[e],s=new Set(n&&n._attachments?Object.keys(n._attachments):[]);return await Promise.all(Object.entries(r._attachments).map(async([c,f])=>{if((!s.has(c)||n&&oe(n._attachments)[c].digest!==f.digest)&&!f.data){var d=await t.getAttachmentData(a,c,f.digest);f.data=d}})),r}async function tg(e){if(e.input.initialCheckpoint&&e.input.initialCheckpoint.upstream){var t=await ra(e,"up");t||await na(e,"up",e.input.initialCheckpoint.upstream)}var r=e.input.replicationHandler;e.streamQueue.up=e.streamQueue.up.then(()=>m().then(()=>g()));var n=0,a=-1,s=[],c=At,f={docs:{}},d=e.input.forkInstance.changeStream().subscribe(w=>{if(!e.events.paused.getValue())return e.stats.up.forkChangeStreamEmit=e.stats.up.forkChangeStreamEmit+1,s.push({task:w,time:n++}),e.events.active.up.getValue()||e.events.active.up.next(!0),e.input.waitBeforePersist?e.input.waitBeforePersist().then(()=>g()):g()}),v=r.masterChangeStream$.pipe(be(w=>w==="RESYNC")).subscribe(()=>{s.push({task:"RESYNC",time:n++}),g()});yr(e.events.canceled.pipe(be(w=>!!w))).then(()=>{d.unsubscribe(),v.unsubscribe()});async function m(){if(e.stats.up.upstreamInitialSync=e.stats.up.upstreamInitialSync+1,!e.events.canceled.getValue()){e.checkpointQueue=e.checkpointQueue.then(()=>ra(e,"up"));for(var w=await e.checkpointQueue,E=new Set,O=async function(){a=n++,E.size>3&&await Promise.race(Array.from(E));var j=await Cl(e.input.forkInstance,e.input.pushBatchSize,w);if(j.documents.length===0)return 1;w=Un([w,j.checkpoint]);var H=S(j.documents,oe(w));E.add(H),H.catch().then(()=>E.delete(H))};!e.events.canceled.getValue()&&!await O(););var P=await Promise.all(E),B=P.find(j=>!!j);B?await m():!e.firstSyncDone.up.getValue()&&!e.events.canceled.getValue()&&e.firstSyncDone.up.next(!0)}}function g(){if(e.events.canceled.getValue()||s.length===0){e.events.active.up.next(!1);return}e.stats.up.processTasks=e.stats.up.processTasks+1,e.events.active.up.next(!0),e.streamQueue.up=e.streamQueue.up.then(async()=>{for(var w=[],E;s.length>0;){var O=oe(s.shift());if(!(O.time<a)){if(O.task==="RESYNC"){e.events.active.up.next(!1),await m();return}O.task.context!==await e.downstreamBulkWriteFlag&&Er(w,O.task.events.map(P=>P.documentData)),E=Un([E,O.task.checkpoint])}}if(await S(w,E),s.length===0)e.events.active.up.next(!1);else return g()})}function S(w,E){return e.stats.up.persistToMaster=e.stats.up.persistToMaster+1,w.forEach(O=>{var P=O[e.primaryPath];f.docs[P]=O}),f.checkpoint=E,c=c.then(async()=>{if(e.events.canceled.getValue())return!1;var O=f.docs;f.docs={};var P=f.checkpoint,B=Object.keys(O);function j(){return na(e,"up",P)}if(B.length===0)return j(),!1;var H=await Jl(e,B),ee={},X=[],Y={},V={};if(await Promise.all(B.map(async ne=>{var Se=O[ne];V[ne]=Se;var $e=Vt(Se,e.hasAttachments,!!e.input.keepMeta),he=H[ne];he&&he.metaDocument.isResolvedConflict!==Se._rev&&e.input.conflictHandler.isEqual(he.docData,$e,"upstream-check-if-equal")||he&&he.docData._rev&&Xt(Se._rev)===Se._meta[e.input.identifier]||(X.push(ne),ee[ne]={assumedMasterState:he?he.docData:void 0,newDocumentState:$e},Y[ne]=await ia(e,$e,he?he.metaDocument:void 0))})),X.length===0)return j(),!1;var re=Object.values(ee),se=new Set,fe={},Ee=dd(re,e.input.pushBatchSize);await Promise.all(Ee.map(async ne=>{e.hasAttachments&&await Promise.all(ne.map(async $e=>{$e.newDocumentState=await Qo(e.primaryPath,e.input.forkInstance,ze($e.newDocumentState),$e.assumedMasterState)}));var Se=await r.masterWrite(ne);Se.forEach($e=>{var he=$e[e.primaryPath];se.add(he),fe[he]=$e})}));var ue=[];if(X.forEach(ne=>{se.has(ne)||(e.events.processed.up.next(ee[ne]),ue.push(Y[ne]))}),e.events.canceled.getValue())return!1;ue.length>0&&await e.input.metaInstance.bulkWrite(Ho(e,ue),"replication-up-write-meta");var we=!1;if(se.size>0){e.stats.up.persistToMasterHadConflicts=e.stats.up.persistToMasterHadConflicts+1;var Ae=[],Oe={};if(await Promise.all(Object.entries(fe).map(([ne,Se])=>{var $e=ee[ne],he={newDocumentState:$e.newDocumentState,assumedMasterState:$e.assumedMasterState,realMasterState:Se};return eg(e,he,V[ne]).then(async Me=>{if(Me){e.events.resolvedConflicts.next({input:he,output:Me}),Ae.push({previous:V[ne],document:Me});var it=H[ne];Oe[ne]=await ia(e,oe(Se),it?it.metaDocument:void 0,Me._rev)}})})),Ae.length>0){we=!0,e.stats.up.persistToMasterConflictWrites=e.stats.up.persistToMasterConflictWrites+1;var Ve=await e.input.forkInstance.bulkWrite(Ae,"replication-up-write-conflict"),_t;if(Ve.error.forEach(ne=>{if(ne.status!==409){var Se=J("RC_PUSH",{writeError:ne});e.events.error.next(Se),_t=Se}}),_t)throw _t;var Ie=[],We=ct(e.primaryPath,Ae,Ve);We.forEach(ne=>{var Se=ne[e.primaryPath];Ie.push(Oe[Se])}),Ie.length>0&&await e.input.metaInstance.bulkWrite(Ho(e,Ie),"replication-up-write-conflict-meta")}}return j(),we}).catch(O=>(e.events.error.next(O),!1)),c}}function rg(e){e=xe(e),e.forkInstance=zo(e.forkInstance),e.metaInstance=zo(e.metaInstance);var t=Xy(e),r={primaryPath:tt(e.forkInstance.schema.primaryKey),hasAttachments:!!e.forkInstance.schema.attachments,input:e,checkpointKey:t,downstreamBulkWriteFlag:t.then(n=>"replication-downstream-"+n),events:{canceled:new Qt(!1),paused:new Qt(!1),active:{down:new Qt(!0),up:new Qt(!0)},processed:{down:new ut,up:new ut},resolvedConflicts:new ut,error:new ut},stats:{down:{addNewTask:0,downstreamProcessChanges:0,downstreamResyncOnce:0,masterChangeStreamEmit:0,persistFromMaster:0},up:{forkChangeStreamEmit:0,persistToMaster:0,persistToMasterConflictWrites:0,persistToMasterHadConflicts:0,processTasks:0,upstreamInitialSync:0}},firstSyncDone:{down:new Qt(!1),up:new Qt(!1)},streamQueue:{down:lt,up:lt},checkpointQueue:lt,lastCheckpointDoc:{}};return Zy(r),tg(r),r}function ng(e){return yr(Ap([e.firstSyncDone.down.pipe(be(t=>!!t)),e.firstSyncDone.up.pipe(be(t=>!!t))])).then(()=>{})}function ig(e){return Promise.all([e.streamQueue.up,e.streamQueue.down,e.checkpointQueue])}function ag(e,t,r,n=!1){e=zo(e);var a=!!e.schema.attachments,s=tt(e.schema.primaryKey),c={masterChangeStream$:e.changeStream().pipe(Mt(async f=>{var d={checkpoint:f.checkpoint,documents:await Promise.all(f.events.map(async v=>{var m=Vt(v.documentData,a,n);return a&&(m=await Qo(s,e,ze(m),void 0)),m}))};return d})),masterChangesSince(f,d){return Cl(e,d,f).then(async v=>({checkpoint:v.documents.length>0?v.checkpoint:f,documents:await Promise.all(v.documents.map(async m=>{var g=Vt(m,a,n);return a&&(g=await Qo(s,e,ze(g),void 0)),g}))}))},async masterWrite(f){var d={};f.forEach(O=>{var P=O.newDocumentState[s];d[P]=O});var v=Object.keys(d),m=await e.findDocumentsById(v,!0),g=new Map;m.forEach(O=>g.set(O[s],O));var S=[],w=[];if(await Promise.all(Object.entries(d).map(([O,P])=>{var B=g.get(O);B?B&&!P.assumedMasterState?S.push(Vt(B,a,n)):t.isEqual(Vt(B,a,n),oe(P.assumedMasterState),"rxStorageInstanceToReplicationHandler-masterWrite")===!0?w.push({previous:B,document:Qu(r,a,n,P.newDocumentState,B)}):S.push(Vt(B,a,n)):w.push({document:Qu(r,a,n,P.newDocumentState)})})),w.length>0){var E=await e.bulkWrite(w,"replication-master-write");E.error.forEach(O=>{if(O.status!==409)throw J("SNH",{name:"non conflict error",error:O});S.push(Vt(oe(O.documentInDb),a,n))})}return S}};return c}async function og(e){e.events.canceled.next(!0),e.events.active.up.complete(),e.events.active.down.complete(),e.events.processed.up.complete(),e.events.processed.down.complete(),e.events.resolvedConflicts.complete(),e.events.canceled.complete(),await e.checkpointQueue}function sg(e){return e&&typeof e.then=="function"}Promise.resolve(!1);var ug=Promise.resolve(!0),Dt=Promise.resolve();function mr(e,t){return e||(e=0),new Promise(function(r){return setTimeout(function(){return r(t)},e)})}function cg(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function ni(){return Math.random().toString(36).substring(2)}var wo=0;function ii(){var e=Date.now()*1e3;return e<=wo&&(e=wo+1),wo=e,e}function lg(){return typeof navigator<"u"&&typeof navigator.locks<"u"&&typeof navigator.locks.request=="function"}var fg=ii,hg="native";function dg(e){var t={time:ii(),messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(r){t.messagesCallback&&t.messagesCallback(r.data)},t}function pg(e){e.bc.close(),e.subFns=[]}function mg(e,t){try{return e.bc.postMessage(t,!1),Dt}catch(r){return Promise.reject(r)}}function vg(e,t){e.messagesCallback=t}function yg(){if(typeof globalThis<"u"&&globalThis.Deno&&globalThis.Deno.args)return!0;if((typeof window<"u"||typeof self<"u")&&typeof BroadcastChannel=="function"){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}else return!1}function gg(){return 150}var bg={create:dg,close:pg,onMessage:vg,postMessage:mg,canBeUsed:yg,type:hg,averageResponseTime:gg,microSeconds:fg};class Xl{ttl;map=new Map;_to=!1;constructor(t){this.ttl=t}has(t){const r=this.map.get(t);return typeof r>"u"?!1:r<Vo()-this.ttl?(this.map.delete(t),!1):!0}add(t){this.map.delete(t),this.map.set(t,Vo()),this._to||(this._to=!0,setTimeout(()=>{this._to=!1,wg(this)},0))}clear(){this.map.clear()}}function wg(e){const t=Vo()-e.ttl,r=e.map[Symbol.iterator]();for(;;){const n=r.next().value;if(!n)break;const a=n[0];if(n[1]<t)e.map.delete(a);else break}}function Vo(){return Date.now()}function Os(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=JSON.parse(JSON.stringify(e));return typeof t.webWorkerSupport>"u"&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=1e3*45),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&typeof e.idb.onclose=="function"&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=1e3*60),e.methods&&(t.methods=e.methods),t.node||(t.node={}),t.node.ttl||(t.node.ttl=1e3*60*2),t.node.maxParallelWrites||(t.node.maxParallelWrites=2048),typeof t.node.useFastPath>"u"&&(t.node.useFastPath=!0),t}var _g=ii,Eg="pubkey.broadcast-channel-0-",Nt="messages",ya={durability:"relaxed"},Sg="idb";function Zl(){if(typeof indexedDB<"u")return indexedDB;if(typeof window<"u"){if(typeof window.mozIndexedDB<"u")return window.mozIndexedDB;if(typeof window.webkitIndexedDB<"u")return window.webkitIndexedDB;if(typeof window.msIndexedDB<"u")return window.msIndexedDB}return!1}function Is(e){e.commit&&e.commit()}function kg(e){var t=Zl(),r=Eg+e,n=t.open(r);return n.onupgradeneeded=function(a){var s=a.target.result;s.createObjectStore(Nt,{keyPath:"id",autoIncrement:!0})},new Promise(function(a,s){n.onerror=function(c){return s(c)},n.onsuccess=function(){a(n.result)}})}function xg(e,t,r){var n=Date.now(),a={uuid:t,time:n,data:r},s=e.transaction([Nt],"readwrite",ya);return new Promise(function(c,f){s.oncomplete=function(){return c()},s.onerror=function(v){return f(v)};var d=s.objectStore(Nt);d.add(a),Is(s)})}function Og(e,t){var r=e.transaction(Nt,"readonly",ya),n=r.objectStore(Nt),a=[],s=IDBKeyRange.bound(t+1,1/0);if(n.getAll){var c=n.getAll(s);return new Promise(function(d,v){c.onerror=function(m){return v(m)},c.onsuccess=function(m){d(m.target.result)}})}function f(){try{return s=IDBKeyRange.bound(t+1,1/0),n.openCursor(s)}catch{return n.openCursor()}}return new Promise(function(d,v){var m=f();m.onerror=function(g){return v(g)},m.onsuccess=function(g){var S=g.target.result;S?S.value.id<t+1?S.continue(t+1):(a.push(S.value),S.continue()):(Is(r),d(a))}})}function Ig(e,t){if(e.closed)return Promise.resolve([]);var r=e.db.transaction(Nt,"readwrite",ya),n=r.objectStore(Nt);return Promise.all(t.map(function(a){var s=n.delete(a);return new Promise(function(c){s.onsuccess=function(){return c()}})}))}function Cg(e,t){var r=Date.now()-t,n=e.transaction(Nt,"readonly",ya),a=n.objectStore(Nt),s=[];return new Promise(function(c){a.openCursor().onsuccess=function(f){var d=f.target.result;if(d){var v=d.value;v.time<r?(s.push(v),d.continue()):(Is(n),c(s))}else c(s)}})}function Pg(e){return Cg(e.db,e.options.idb.ttl).then(function(t){return Ig(e,t.map(function(r){return r.id}))})}function Dg(e,t){return t=Os(t),kg(e).then(function(r){var n={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:ni(),eMIs:new Xl(t.idb.ttl*2),writeBlockPromise:Dt,messagesCallback:null,readQueuePromises:[],db:r};return r.onclose=function(){n.closed=!0,t.idb.onclose&&t.idb.onclose()},ef(n),n})}function ef(e){e.closed||tf(e).then(function(){return mr(e.options.idb.fallbackInterval)}).then(function(){return ef(e)})}function Rg(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}function tf(e){return e.closed||!e.messagesCallback?Dt:Og(e.db,e.lastCursorId).then(function(t){var r=t.filter(function(n){return!!n}).map(function(n){return n.id>e.lastCursorId&&(e.lastCursorId=n.id),n}).filter(function(n){return Rg(n,e)}).sort(function(n,a){return n.time-a.time});return r.forEach(function(n){e.messagesCallback&&(e.eMIs.add(n.id),e.messagesCallback(n.data))}),Dt})}function Ag(e){e.closed=!0,e.db.close()}function Tg(e,t){return e.writeBlockPromise=e.writeBlockPromise.then(function(){return xg(e.db,e.uuid,t)}).then(function(){cg(0,10)===0&&Pg(e)}),e.writeBlockPromise}function Mg(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t,tf(e)}function Ng(){return!!Zl()}function Lg(e){return e.idb.fallbackInterval*2}var Bg={create:Dg,close:Ag,onMessage:Mg,postMessage:Tg,canBeUsed:Ng,type:Sg,averageResponseTime:Lg,microSeconds:_g},$g=ii,jg="pubkey.broadcastChannel-",Kg="localstorage";function rf(){var e;if(typeof window>"u")return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch{}return e}function nf(e){return jg+e}function Fg(e,t){return new Promise(function(r){mr().then(function(){var n=nf(e.channelName),a={token:ni(),time:Date.now(),data:t,uuid:e.uuid},s=JSON.stringify(a);rf().setItem(n,s);var c=document.createEvent("Event");c.initEvent("storage",!0,!0),c.key=n,c.newValue=s,window.dispatchEvent(c),r()})})}function qg(e,t){var r=nf(e),n=function(s){s.key===r&&t(JSON.parse(s.newValue))};return window.addEventListener("storage",n),n}function Wg(e){window.removeEventListener("storage",e)}function Ug(e,t){if(t=Os(t),!af())throw new Error("BroadcastChannel: localstorage cannot be used");var r=ni(),n=new Xl(t.localstorage.removeTimeout),a={channelName:e,uuid:r,eMIs:n};return a.listener=qg(e,function(s){a.messagesCallback&&s.uuid!==r&&(!s.token||n.has(s.token)||s.data.time&&s.data.time<a.messagesCallbackTime||(n.add(s.token),a.messagesCallback(s.data)))}),a}function Hg(e){Wg(e.listener)}function zg(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t}function af(){var e=rf();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch{return!1}return!0}function Qg(){var e=120,t=navigator.userAgent.toLowerCase();return t.includes("safari")&&!t.includes("chrome")?e*2:e}var Vg={create:Ug,close:Hg,onMessage:zg,postMessage:Fg,canBeUsed:af,type:Kg,averageResponseTime:Qg,microSeconds:$g},of=ii,Gg="simulate",Cs=new Set;function Yg(e){var t={time:of(),name:e,messagesCallback:null};return Cs.add(t),t}function Jg(e){Cs.delete(e)}var sf=5;function Xg(e,t){return new Promise(function(r){return setTimeout(function(){var n=Array.from(Cs);n.forEach(function(a){a.name===e.name&&a!==e&&a.messagesCallback&&a.time<t.time&&a.messagesCallback(t)}),r()},sf)})}function Zg(e,t){e.messagesCallback=t}function eb(){return!0}function tb(){return sf}var rb={create:Yg,close:Jg,onMessage:Zg,postMessage:Xg,canBeUsed:eb,type:Gg,averageResponseTime:tb,microSeconds:of},Gu=[bg,Bg,Vg];function nb(e){var t=[].concat(e.methods,Gu).filter(Boolean);if(e.type){if(e.type==="simulate")return rb;var r=t.find(function(a){return a.type===e.type});if(r)return r;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||(t=t.filter(function(a){return a.type!=="idb"}));var n=t.find(function(a){return a.canBeUsed()});if(n)return n;throw new Error("No usable method found in "+JSON.stringify(Gu.map(function(a){return a.type})))}var uf=new Set,ib=0,ga=function(t,r){this.id=ib++,uf.add(this),this.name=t,this.options=Os(r),this.method=nb(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,ab(this)};ga._pubkey=!0;ga.prototype={postMessage:function(t){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(t));return Yu(this,"message",t)},postInternal:function(t){return Yu(this,"internal",t)},set onmessage(e){var t=this.method.microSeconds(),r={time:t,fn:e};Xu(this,"message",this._onML),e&&typeof e=="function"?(this._onML=r,Ju(this,"message",r)):this._onML=null},addEventListener:function(t,r){var n=this.method.microSeconds(),a={time:n,fn:r};Ju(this,t,a)},removeEventListener:function(t,r){var n=this._addEL[t].find(function(a){return a.fn===r});Xu(this,t,n)},close:function(){var t=this;if(!this.closed){uf.delete(this),this.closed=!0;var r=this._prepP?this._prepP:Dt;return this._onML=null,this._addEL.message=[],r.then(function(){return Promise.all(Array.from(t._uMP))}).then(function(){return Promise.all(t._befC.map(function(n){return n()}))}).then(function(){return t.method.close(t._state)})}},get type(){return this.method.type},get isClosed(){return this.closed}};function Yu(e,t,r){var n=e.method.microSeconds(),a={time:n,type:t,data:r},s=e._prepP?e._prepP:Dt;return s.then(function(){var c=e.method.postMessage(e._state,a);return e._uMP.add(c),c.catch().then(function(){return e._uMP.delete(c)}),c})}function ab(e){var t=e.method.create(e.name,e.options);sg(t)?(e._prepP=t,t.then(function(r){e._state=r})):e._state=t}function cf(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function Ju(e,t,r){e._addEL[t].push(r),ob(e)}function Xu(e,t,r){e._addEL[t]=e._addEL[t].filter(function(n){return n!==r}),sb(e)}function ob(e){if(!e._iL&&cf(e)){var t=function(a){e._addEL[a.type].forEach(function(s){a.time>=s.time&&s.fn(a.data)})},r=e.method.microSeconds();e._prepP?e._prepP.then(function(){e._iL=!0,e.method.onMessage(e._state,t,r)}):(e._iL=!0,e.method.onMessage(e._state,t,r))}}function sb(e){if(e._iL&&!cf(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}function ub(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var lf={exports:{}},Re=lf.exports={},yt,gt;function Go(){throw new Error("setTimeout has not been defined")}function Yo(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?yt=setTimeout:yt=Go}catch{yt=Go}try{typeof clearTimeout=="function"?gt=clearTimeout:gt=Yo}catch{gt=Yo}})();function ff(e){if(yt===setTimeout)return setTimeout(e,0);if((yt===Go||!yt)&&setTimeout)return yt=setTimeout,setTimeout(e,0);try{return yt(e,0)}catch{try{return yt.call(null,e,0)}catch{return yt.call(this,e,0)}}}function cb(e){if(gt===clearTimeout)return clearTimeout(e);if((gt===Yo||!gt)&&clearTimeout)return gt=clearTimeout,clearTimeout(e);try{return gt(e)}catch{try{return gt.call(null,e)}catch{return gt.call(this,e)}}}var Ct=[],Vr=!1,vr,Wi=-1;function lb(){!Vr||!vr||(Vr=!1,vr.length?Ct=vr.concat(Ct):Wi=-1,Ct.length&&hf())}function hf(){if(!Vr){var e=ff(lb);Vr=!0;for(var t=Ct.length;t;){for(vr=Ct,Ct=[];++Wi<t;)vr&&vr[Wi].run();Wi=-1,t=Ct.length}vr=null,Vr=!1,cb(e)}}Re.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];Ct.push(new df(e,t)),Ct.length===1&&!Vr&&ff(hf)};function df(e,t){this.fun=e,this.array=t}df.prototype.run=function(){this.fun.apply(null,this.array)};Re.title="browser";Re.browser=!0;Re.env={};Re.argv=[];Re.version="";Re.versions={};function Bt(){}Re.on=Bt;Re.addListener=Bt;Re.once=Bt;Re.off=Bt;Re.removeListener=Bt;Re.removeAllListeners=Bt;Re.emit=Bt;Re.prependListener=Bt;Re.prependOnceListener=Bt;Re.listeners=function(e){return[]};Re.binding=function(e){throw new Error("process.binding is not supported")};Re.cwd=function(){return"/"};Re.chdir=function(e){throw new Error("process.chdir is not supported")};Re.umask=function(){return 0};var fb=lf.exports;const xt=ub(fb);function hb(e){if(typeof WorkerGlobalScope=="function"&&self instanceof WorkerGlobalScope){var t=self.close.bind(self);self.close=function(){return e(),t()}}else{if(typeof window.addEventListener!="function")return;window.addEventListener("beforeunload",function(){e()},!0),window.addEventListener("unload",function(){e()},!0)}}function db(e){xt.on("exit",function(){return e()}),xt.on("beforeExit",function(){return e().then(function(){return xt.exit()})}),xt.on("SIGINT",function(){return e().then(function(){return xt.exit()})}),xt.on("uncaughtException",function(t){return e().then(function(){console.trace(t),xt.exit(101)})})}var pb=Object.prototype.toString.call(typeof xt<"u"?xt:0)==="[object process]",mb=pb?db:hb,In=new Set,Zu=!1;function vb(){Zu||(Zu=!0,mb(gb))}function yb(e){if(vb(),typeof e!="function")throw new Error("Listener is no function");In.add(e);var t={remove:function(){return In.delete(e)},run:function(){return In.delete(e),e()}};return t}function gb(){var e=[];return In.forEach(function(t){e.push(t()),In.delete(t)}),Promise.all(e)}function _r(e,t){var r={context:"leader",action:t,token:e.token};return e.broadcastChannel.postInternal(r)}function pf(e){e.isLeader=!0,e._hasLeader=!0;var t=yb(function(){return e.die()});e._unl.push(t);var r=function(a){a.context==="leader"&&a.action==="apply"&&_r(e,"tell"),a.context==="leader"&&a.action==="tell"&&!e._dpLC&&(e._dpLC=!0,e._dpL(),_r(e,"tell"))};return e.broadcastChannel.addEventListener("internal",r),e._lstns.push(r),_r(e,"tell")}var mf=function(t,r){var n=this;this.broadcastChannel=t,t._befC.push(function(){return n.die()}),this._options=r,this.isLeader=!1,this.isDead=!1,this.token=ni(),this._lstns=[],this._unl=[],this._dpL=function(){},this._dpLC=!1,this._wKMC={},this.lN="pubkey-bc||"+t.method.type+"||"+t.name};mf.prototype={hasLeader:function(){var t=this;return navigator.locks.query().then(function(r){var n=r.held?r.held.filter(function(a){return a.name===t.lN}):[];return!!(n&&n.length>0)})},awaitLeadership:function(){var t=this;if(!this._wLMP){this._wKMC.c=new AbortController;var r=new Promise(function(n,a){t._wKMC.res=n,t._wKMC.rej=a});this._wLMP=new Promise(function(n,a){navigator.locks.request(t.lN,{signal:t._wKMC.c.signal},function(){return t._wKMC.c=void 0,pf(t),n(),r}).catch(function(s){t._wKMC.rej&&t._wKMC.rej(s),a(s)})})}return this._wLMP},set onduplicate(e){},die:function(){var t=this;return this._lstns.forEach(function(r){return t.broadcastChannel.removeEventListener("internal",r)}),this._lstns=[],this._unl.forEach(function(r){return r.remove()}),this._unl=[],this.isLeader&&(this.isLeader=!1),this.isDead=!0,this._wKMC.res&&this._wKMC.res(),this._wKMC.c&&this._wKMC.c.abort("LeaderElectionWebLock.die() called"),_r(this,"death")}};var vf=function(t,r){var n=this;this.broadcastChannel=t,this._options=r,this.isLeader=!1,this._hasLeader=!1,this.isDead=!1,this.token=ni(),this._aplQ=Dt,this._aplQC=0,this._unl=[],this._lstns=[],this._dpL=function(){},this._dpLC=!1;var a=function(c){c.context==="leader"&&(c.action==="death"&&(n._hasLeader=!1),c.action==="tell"&&(n._hasLeader=!0))};this.broadcastChannel.addEventListener("internal",a),this._lstns.push(a)};vf.prototype={hasLeader:function(){return Promise.resolve(this._hasLeader)},applyOnce:function(t){var r=this;if(this.isLeader)return mr(0,!0);if(this.isDead)return mr(0,!1);if(this._aplQC>1)return this._aplQ;var n=function(){if(r.isLeader)return ug;var s=!1,c,f=new Promise(function(m){c=function(){s=!0,m()}}),d=function(g){g.context==="leader"&&g.token!=r.token&&(g.action==="apply"&&g.token>r.token&&c(),g.action==="tell"&&(c(),r._hasLeader=!0))};r.broadcastChannel.addEventListener("internal",d);var v=t?r._options.responseTime*4:r._options.responseTime;return _r(r,"apply").then(function(){return Promise.race([mr(v),f.then(function(){return Promise.reject(new Error)})])}).then(function(){return _r(r,"apply")}).then(function(){return Promise.race([mr(v),f.then(function(){return Promise.reject(new Error)})])}).catch(function(){}).then(function(){return r.broadcastChannel.removeEventListener("internal",d),s?!1:pf(r).then(function(){return!0})})};return this._aplQC=this._aplQC+1,this._aplQ=this._aplQ.then(function(){return n()}).then(function(){r._aplQC=r._aplQC-1}),this._aplQ.then(function(){return r.isLeader})},awaitLeadership:function(){return this._aLP||(this._aLP=bb(this)),this._aLP},set onduplicate(e){this._dpL=e},die:function(){var t=this;return this._lstns.forEach(function(r){return t.broadcastChannel.removeEventListener("internal",r)}),this._lstns=[],this._unl.forEach(function(r){return r.remove()}),this._unl=[],this.isLeader&&(this._hasLeader=!1,this.isLeader=!1),this.isDead=!0,_r(this,"death")}};function bb(e){return e.isLeader?Dt:new Promise(function(t){var r=!1;function n(){r||(r=!0,e.broadcastChannel.removeEventListener("internal",s),t(!0))}e.applyOnce().then(function(){e.isLeader&&n()});var a=function(){return mr(e._options.fallbackInterval).then(function(){if(!(e.isDead||r))if(e.isLeader)n();else return e.applyOnce(!0).then(function(){e.isLeader?n():a()})})};a();var s=function(f){f.context==="leader"&&f.action==="death"&&(e._hasLeader=!1,e.applyOnce().then(function(){e.isLeader&&n()}))};e.broadcastChannel.addEventListener("internal",s),e._lstns.push(s)})}function wb(e,t){return e||(e={}),e=JSON.parse(JSON.stringify(e)),e.fallbackInterval||(e.fallbackInterval=3e3),e.responseTime||(e.responseTime=t.method.averageResponseTime(t.options)),e}function _b(e,t){if(e._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");t=wb(t,e);var r=lg()?new mf(e,t):new vf(e,t);return e._befC.push(function(){return r.die()}),e._leaderElector=r,r}var aa=new Map;function Eb(e,t,r,n){var a=aa.get(t);return a||(a={bc:new ga(["RxDB:",e,r].join("|")),refs:new Set},aa.set(t,a)),a.refs.add(n),a.bc}function ec(e,t){var r=aa.get(e);if(r&&(r.refs.delete(t),r.refs.size===0))return aa.delete(e),r.bc.close()}function Sb(e,t,r,n){if(t.multiInstance){var a=Eb(e,t.databaseInstanceToken,r.databaseName,r),s=new ut,c=S=>{S.storageName===e&&S.databaseName===t.databaseName&&S.collectionName===t.collectionName&&S.version===t.schema.version&&s.next(S.eventBulk)};a.addEventListener("message",c);var f=r.changeStream(),d=!1,v=f.subscribe(S=>{d||a.postMessage({storageName:e,databaseName:t.databaseName,collectionName:t.collectionName,version:t.schema.version,eventBulk:S})});r.changeStream=function(){return s.asObservable().pipe(Fp(f))};var m=r.close.bind(r);r.close=async function(){return d=!0,v.unsubscribe(),a.removeEventListener("message",c),await ec(t.databaseInstanceToken,r),m()};var g=r.remove.bind(r);r.remove=async function(){return d=!0,v.unsubscribe(),a.removeEventListener("message",c),await ec(t.databaseInstanceToken,r),g()}}}async function yf(e){var t=zd(e.collection.schema.jsonSchema).map(s=>e.collection.name+"-"+s),r=await e.database.internalStore.findDocumentsById(t.map(s=>en(s,wr)),!1),n={};r.forEach(s=>n[s.key]=s);var a=t.find(s=>n[s]);return a?n[a]:void 0}function kb(e,t,r){var n=xe(r._attachments),a=ze(r),s=a._meta;delete a._meta,a._attachments=n;for(var c=t+1,f=Promise.resolve(a),d=function(){var v=c;f=f.then(m=>xb(e,v,m)),c++};c<=e.schema.version;)d();return f.then(v=>v===null?ss:(s&&(v._meta=s),v))}function xb(e,t,r){if(r===null)return ss;var n=e.migrationStrategies[t](r,e),a=Pd(n);return a}async function gf(e){if(e.collection.schema.version===0)return At;var t=await yf(e);return!!t}var Ob=200,bf=new WeakMap;function Ib(e){var t=wf(e.database),r=t.getValue().slice(0);r.push(e),t.next(r)}function wf(e){return ht(bf,e,()=>new Qt([]))}function Cb(e){var t=bf.get(e);t&&t.complete()}var Pb=(function(){function e(r,n,a=[r.name,"v",r.schema.version].join("-")){this.started=!1,this.canceled=!1,this.updateStatusHandlers=[],this.updateStatusQueue=Dd,this.collection=r,this.migrationStrategies=n,this.statusDocKey=a,this.database=r.database,this.oldCollectionMeta=yf(this),this.mustMigrate=gf(this),this.statusDocId=en(this.statusDocKey,Fi),Ib(this),this.$=ov(this.database.internalStore,this.statusDocId).pipe(be(s=>!!s),De(s=>oe(s).data),Jn(zn))}var t=e.prototype;return t.getStatus=function(){return yr(this.$)},t.startMigration=async function(n=Ob){var a=await this.mustMigrate;if(a){if(this.started)throw J("DM1");if(this.started=!0,this.database.multiInstance){this.broadcastChannel=new ga(["rx-migration-state",this.database.name,this.collection.name,this.collection.schema.version].join("|"));var s=_b(this.broadcastChannel);await s.awaitLeadership()}var c=await this.oldCollectionMeta,f=await this.database.storage.createStorageInstance({databaseName:this.database.name,collectionName:this.collection.name,databaseInstanceToken:this.database.token,multiInstance:this.database.multiInstance,options:{},schema:oe(c).data.schema,password:this.database.password,devMode:ge.isDevMode()}),d=await this.getConnectedStorageInstances(),v=await this.countAllDocuments([f].concat(d.map(g=>g.oldStorage)));await this.updateStatus(g=>(g.count.total=v,g));try{await Promise.all(d.map(async g=>{await Dy(this.collection,g.newStorage.collectionName,g.newStorage.schema),await this.migrateStorage(g.oldStorage,g.newStorage,n),await g.newStorage.close()})),await this.migrateStorage(f,this.collection.storageInstance.originalStorageInstance,n)}catch(g){await f.close(),await this.updateStatus(S=>(S.status="ERROR",S.error=Ld(g),S));return}try{await Wn(this.database.internalStore,{previous:c,document:Object.assign({},c,{_deleted:!0})},"rx-migration-remove-collection-meta")}catch(g){var m=Tn(g);if(!(m&&m.documentInDb._deleted))throw g}await this.updateStatus(g=>(g.status="DONE",g)),this.broadcastChannel&&await this.broadcastChannel.close()}},t.updateStatus=function(n){return this.updateStatusHandlers.push(n),this.updateStatusQueue=this.updateStatusQueue.then(async()=>{if(this.updateStatusHandlers.length!==0){var a=this.updateStatusHandlers;for(this.updateStatusHandlers=[];;){var s=await ti(this.database.internalStore,this.statusDocId),c=ze(s);s||(c={id:this.statusDocId,key:this.statusDocKey,context:Fi,data:{collectionName:this.collection.name,status:"RUNNING",count:{total:0,handled:0,percent:0}},_deleted:!1,_meta:tn(),_rev:ft(),_attachments:{}});var f=oe(c).data;for(var d of a)f=d(f);if(f.count.percent=Math.round(f.count.handled/f.count.total*100),c&&s&&Mn(c.data,s.data))break;try{await Wn(this.database.internalStore,{previous:s,document:oe(c)},Fi);break}catch(v){if(!Tn(v))throw v}}}}),this.updateStatusQueue},t.migrateStorage=async function(n,a,s){this.collection.onClose.push(()=>this.cancel()),this.database.onClose.push(()=>this.cancel());var c=await this.database.storage.createStorageInstance({databaseName:this.database.name,collectionName:"rx-migration-state-meta-"+n.collectionName+"-"+n.schema.version,databaseInstanceToken:this.database.token,multiInstance:this.database.multiInstance,options:{},schema:Vu(n.schema,jo(n.schema)),password:this.database.password,devMode:ge.isDevMode()}),f=ag(a,ta,this.database.token,!0),d=rg({keepMeta:!0,identifier:["rx-migration-state",n.collectionName,n.schema.version,this.collection.schema.version].join("-"),replicationHandler:{masterChangesSince(){return Promise.resolve({checkpoint:null,documents:[]})},masterWrite:async m=>{var g=await Promise.all(m.map(async w=>{var E=w.newDocumentState;if(a.schema.title===qi&&(E=w.newDocumentState.docData,w.newDocumentState.isCheckpoint==="1"))return{assumedMasterState:void 0,newDocumentState:w.newDocumentState};var O=await kb(this.collection,n.schema.version,E);if(O===null)return null;var P={assumedMasterState:void 0,newDocumentState:a.schema.title===qi?Object.assign({},w.newDocumentState,{docData:O}):O};return P}));g=g.filter(w=>!!w&&!!w.newDocumentState);var S=await f.masterWrite(g);return S},masterChangeStream$:new ut().asObservable()},forkInstance:n,metaInstance:c,pushBatchSize:s,pullBatchSize:0,conflictHandler:ta,hashFunction:this.database.hashFunction}),v=!1;if(d.events.error.subscribe(m=>v=m),d.events.processed.up.subscribe(()=>{this.updateStatus(m=>(m.count.handled=m.count.handled+1,m))}),await ng(d),await ig(d),await this.updateStatusQueue,v)throw await c.close(),v;await Promise.all([n.remove(),c.remove()]),await this.cancel()},t.cancel=async function(){this.canceled=!0,this.replicationState&&await og(this.replicationState),this.broadcastChannel&&await this.broadcastChannel.close()},t.countAllDocuments=async function(n){var a=0;return await Promise.all(n.map(async s=>{var c=ma(s.schema,Qr(s.schema,{selector:{}})),f=await s.count(c);a+=f.count})),a},t.getConnectedStorageInstances=async function(){var n=oe(await this.oldCollectionMeta),a=[];return await Promise.all(await Promise.all(n.data.connectedStorages.map(async s=>{if(s.schema.title!==qi)throw new Error("unknown migration handling for schema");var c=Vu(ze(this.collection.schema.jsonSchema),jo(s.schema));c.version=this.collection.schema.version;var[f,d]=await Promise.all([this.database.storage.createStorageInstance({databaseInstanceToken:this.database.token,databaseName:this.database.name,devMode:ge.isDevMode(),multiInstance:this.database.multiInstance,options:{},schema:s.schema,password:this.database.password,collectionName:s.collectionName}),this.database.storage.createStorageInstance({databaseInstanceToken:this.database.token,databaseName:this.database.name,devMode:ge.isDevMode(),multiInstance:this.database.multiInstance,options:{},schema:c,password:this.database.password,collectionName:s.collectionName})]);a.push({oldStorage:f,newStorage:d})}))),a},t.migratePromise=async function(n){this.startMigration(n);var a=await this.mustMigrate;if(!a)return{status:"DONE",collectionName:this.collection.name,count:{handled:0,percent:0,total:0}};var s=await Promise.race([yr(this.$.pipe(be(c=>c.status==="DONE"))),yr(this.$.pipe(be(c=>c.status==="ERROR")))]);if(s.status==="ERROR")throw J("DM4",{collection:this.collection.name,error:s.error});return s},e})(),oa=new WeakMap,Jo=new WeakMap;function Cn(e){var t=oa.get(e);if(!t){var r=e.database?e.database:e,n=e.database?e.name:"";throw J("LD8",{database:r.name,collection:n})}return t}function _f(e,t,r,n,a,s){return t.createStorageInstance({databaseInstanceToken:e,databaseName:r,collectionName:Db(n),schema:Ef,options:a,multiInstance:s,devMode:ge.isDevMode()})}function tc(e){var t=oa.get(e);if(t)return oa.delete(e),t.then(r=>r.storageInstance.close())}async function rc(e,t,r){var n=Hn(10),a=await _f(n,e,t,r,{},!1);await a.remove()}function Db(e){return"plugin-local-documents-"+e}var Ef=la({title:"RxLocalDocument",version:0,primaryKey:"id",type:"object",properties:{id:{type:"string",maxLength:128},data:{type:"object",additionalProperties:!0}},required:["id","data"]});async function nc(e,t){var r=await Cn(this),n={id:e,data:t,_deleted:!1,_meta:tn(),_rev:ft(),_attachments:{}};return Wn(r.storageInstance,{document:n},"local-document-insert").then(a=>r.docCache.getCachedRxDocument(a))}function ic(e,t){return this.getLocal(e).then(r=>{if(r)return r.incrementalModify(()=>t);var n=this.insertLocal(e,t);return n})}async function ac(e){var t=await Cn(this),r=t.docCache,n=r.getLatestDocumentDataIfExists(e);return n?Promise.resolve(r.getCachedRxDocument(n)):ti(t.storageInstance,e).then(a=>a?t.docCache.getCachedRxDocument(a):null)}function oc(e){return this.$.pipe(Xn(null),Mt(async t=>{if(t)return{changeEvent:t};var r=await this.getLocal(e);return{doc:r}}),Mt(async t=>{if(t.changeEvent){var r=t.changeEvent;if(!r.isLocal||r.documentId!==e)return{use:!1};var n=await this.getLocal(e);return{use:!0,doc:n}}else return{use:!0,doc:t.doc}}),be(t=>t.use),De(t=>t.doc))}var Rb=Rl(),Ab=(function(e){function t(r,n,a){var s;return s=e.call(this,null,n)||this,s.id=r,s.parent=a,s}return as(t,e),t})(Rb),Pn={get isLocal(){return!0},get allAttachments$(){throw J("LD1",{document:this})},get primaryPath(){return"id"},get primary(){return this.id},get $(){var e=this,t=Gr(Jo,this.parent),r=this.primary;return e.parent.eventBulks$.pipe(be(n=>!!n.isLocal),De(n=>n.events.find(a=>a.documentId===r)),be(n=>!!n),De(n=>ll(oe(n))),Xn(t.docCache.getLatestDocumentData(this.primary)),Ln((n,a)=>n._rev===a._rev),De(n=>t.docCache.getCachedRxDocument(n)),Jn(zn))},get $$(){var e=this,t=_o(e),r=t.getReactivityFactory();return r.fromObservable(e.$,e.getLatest()._data,t)},get deleted$$(){var e=this,t=_o(e),r=t.getReactivityFactory();return r.fromObservable(e.deleted$,e.getLatest().deleted,t)},getLatest(){var e=Gr(Jo,this.parent),t=e.docCache.getLatestDocumentData(this.primary);return e.docCache.getCachedRxDocument(t)},get(e){if(e="data."+e,!!this._data){if(typeof e!="string")throw st("LD2",{objPath:e});var t=Zt(this._data,e);return t=ge.deepFreezeWhenDevMode(t),t}},get$(e){if(e="data."+e,ge.isDevMode()){if(e.includes(".item."))throw J("LD3",{objPath:e});if(e===this.primaryPath)throw J("LD4")}return this.$.pipe(De(t=>t._data),De(t=>Zt(t,e)),Ln())},get$$(e){var t=_o(this),r=t.getReactivityFactory();return r.fromObservable(this.get$(e),this.getLatest().get(e),t)},async incrementalModify(e){var t=await Cn(this.parent);return t.incrementalWriteQueue.addWrite(this._data,async r=>(r.data=await e(r.data,this),r)).then(r=>t.docCache.getCachedRxDocument(r))},incrementalPatch(e){return this.incrementalModify(t=>(Object.entries(e).forEach(([r,n])=>{t[r]=n}),t))},async _saveData(e){var t=await Cn(this.parent),r=this._data;e.id=this.id;var n=[{previous:r,document:e}];return t.storageInstance.bulkWrite(n,"local-document-save-data").then(a=>{if(a.error[0])throw a.error[0];var s=ct(this.collection.schema.primaryPath,n,a)[0];e=xe(e),e._rev=s._rev})},async remove(){var e=await Cn(this.parent),t=xe(this._data);return t._deleted=!0,Wn(e.storageInstance,{previous:this._data,document:t},"local-document-remove").then(r=>e.docCache.getCachedRxDocument(r))}},sc=!1,Tb=()=>{if(!sc){sc=!0;var e=va,t=Object.getOwnPropertyNames(e);t.forEach(n=>{var a=Object.getOwnPropertyDescriptor(Pn,n);if(!a){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(Pn,n,s)}});var r=n=>()=>{throw J("LD6",{functionName:n})};["populate","update","putAttachment","putAttachmentBase64","getAttachment","allAttachments"].forEach(n=>Pn[n]=r(n))}};function Mb(e,t){Tb();var r=new Ab(e.id,e,t);return Object.setPrototypeOf(r,Pn),r.prototype=Pn,r}function _o(e){var t=e.parent;return Gy(t)?t:t.database}function uc(e){var t=e.database?e.database:e,r=e.database?e.name:"",n=(async()=>{var a=await _f(t.token,t.storage,t.name,r,t.instanceCreationOptions,t.multiInstance);a=ys(t,a,Ef);var s=new $l("id",t.eventBulks$.pipe(be(m=>{var g=!1;return(r===""&&!m.collectionName||r!==""&&m.collectionName===r)&&(g=!0),g&&m.isLocal}),De(m=>m.events)),m=>Mb(m,e)),c=new Dl(a,"id",()=>{},()=>{}),f=await t.storageToken,d=a.changeStream().subscribe(m=>{for(var g=new Array(m.events.length),S=m.events,w=e.database?e.name:void 0,E=0;E<S.length;E++){var O=S[E];g[E]={documentId:O.documentId,collectionName:w,isLocal:!0,operation:O.operation,documentData:ge.deepFreezeWhenDevMode(O.documentData),previousDocumentData:ge.deepFreezeWhenDevMode(O.previousDocumentData)}}var P={id:m.id,isLocal:!0,internal:!1,collectionName:e.database?e.name:void 0,storageToken:f,events:g,databaseToken:t.token,checkpoint:m.checkpoint,context:m.context};t.$emit(P)});e._subs.push(d);var v={database:t,parent:e,storageInstance:a,docCache:s,incrementalWriteQueue:c};return Jo.set(e,v),v})();oa.set(e,n)}var Nb={name:"local-documents",rxdb:!0,prototypes:{RxCollection:e=>{e.insertLocal=nc,e.upsertLocal=ic,e.getLocal=ac,e.getLocal$=oc},RxDatabase:e=>{e.insertLocal=nc,e.upsertLocal=ic,e.getLocal=ac,e.getLocal$=oc}},hooks:{createRxDatabase:{before:e=>{e.creator.localDocuments&&uc(e.database)}},createRxCollection:{before:e=>{e.creator.localDocuments&&uc(e.collection)}},preCloseRxDatabase:{after:e=>tc(e)},postCloseRxCollection:{after:e=>tc(e)},postRemoveRxDatabase:{after:e=>rc(e.storage,e.databaseName,"")},postRemoveRxCollection:{after:e=>rc(e.storage,e.databaseName,e.collectionName)}},overwritable:{}},Lb=new WeakMap,Bb={name:"migration-schema",rxdb:!0,init(){Uo(Nb)},hooks:{preCloseRxDatabase:{after:Cb}},prototypes:{RxDatabase:e=>{e.migrationStates=function(){return wf(this).pipe(Jn(zn))}},RxCollection:e=>{e.getMigrationState=function(){return ht(Lb,this,()=>new Pb(this.asRxCollection,this.migrationStrategies))},e.migrationNeeded=function(){return this.schema.version===0?At:gf(this.getMigrationState())}}}},$b=Bb,jb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Kb(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ui={exports:{}},Fb=Ui.exports,cc;function qb(){return cc||(cc=1,(function(e,t){(function(r,n){e.exports=n()})(Fb,function(){var r=function(i,o){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,l){u.__proto__=l}||function(u,l){for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(u[h]=l[h])})(i,o)},n=function(){return(n=Object.assign||function(i){for(var o,u=1,l=arguments.length;u<l;u++)for(var h in o=arguments[u])Object.prototype.hasOwnProperty.call(o,h)&&(i[h]=o[h]);return i}).apply(this,arguments)};function a(i,o,u){for(var l,h=0,p=o.length;h<p;h++)!l&&h in o||((l=l||Array.prototype.slice.call(o,0,h))[h]=o[h]);return i.concat(l||Array.prototype.slice.call(o))}var s=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:jb,c=Object.keys,f=Array.isArray;function d(i,o){return typeof o!="object"||c(o).forEach(function(u){i[u]=o[u]}),i}typeof Promise>"u"||s.Promise||(s.Promise=Promise);var v=Object.getPrototypeOf,m={}.hasOwnProperty;function g(i,o){return m.call(i,o)}function S(i,o){typeof o=="function"&&(o=o(v(i))),(typeof Reflect>"u"?c:Reflect.ownKeys)(o).forEach(function(u){E(i,u,o[u])})}var w=Object.defineProperty;function E(i,o,u,l){w(i,o,d(u&&g(u,"get")&&typeof u.get=="function"?{get:u.get,set:u.set,configurable:!0}:{value:u,configurable:!0,writable:!0},l))}function O(i){return{from:function(o){return i.prototype=Object.create(o.prototype),E(i.prototype,"constructor",i),{extend:S.bind(null,i.prototype)}}}}var P=Object.getOwnPropertyDescriptor,B=[].slice;function j(i,o,u){return B.call(i,o,u)}function H(i,o){return o(i)}function ee(i){if(!i)throw new Error("Assertion Failed")}function X(i){s.setImmediate?setImmediate(i):setTimeout(i,0)}function Y(i,o){if(typeof o=="string"&&g(i,o))return i[o];if(!o)return i;if(typeof o!="string"){for(var u=[],l=0,h=o.length;l<h;++l){var p=Y(i,o[l]);u.push(p)}return u}var y=o.indexOf(".");if(y!==-1){var b=i[o.substr(0,y)];return b==null?void 0:Y(b,o.substr(y+1))}}function V(i,o,u){if(i&&o!==void 0&&!("isFrozen"in Object&&Object.isFrozen(i)))if(typeof o!="string"&&"length"in o){ee(typeof u!="string"&&"length"in u);for(var l=0,h=o.length;l<h;++l)V(i,o[l],u[l])}else{var p,y,b=o.indexOf(".");b!==-1?(p=o.substr(0,b),(y=o.substr(b+1))===""?u===void 0?f(i)&&!isNaN(parseInt(p))?i.splice(p,1):delete i[p]:i[p]=u:V(b=!(b=i[p])||!g(i,p)?i[p]={}:b,y,u)):u===void 0?f(i)&&!isNaN(parseInt(o))?i.splice(o,1):delete i[o]:i[o]=u}}function re(i){var o,u={};for(o in i)g(i,o)&&(u[o]=i[o]);return u}var se=[].concat;function fe(i){return se.apply([],i)}var St="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(fe([8,16,32,64].map(function(i){return["Int","Uint","Float"].map(function(o){return o+i+"Array"})}))).filter(function(i){return s[i]}),Ee=new Set(St.map(function(i){return s[i]})),ue=null;function we(i){return ue=new WeakMap,i=(function o(u){if(!u||typeof u!="object")return u;var l=ue.get(u);if(l)return l;if(f(u)){l=[],ue.set(u,l);for(var h=0,p=u.length;h<p;++h)l.push(o(u[h]))}else if(Ee.has(u.constructor))l=u;else{var y,b=v(u);for(y in l=b===Object.prototype?{}:Object.create(b),ue.set(u,l),u)g(u,y)&&(l[y]=o(u[y]))}return l})(i),ue=null,i}var Ae={}.toString;function Oe(i){return Ae.call(i).slice(8,-1)}var Ve=typeof Symbol<"u"?Symbol.iterator:"@@iterator",_t=typeof Ve=="symbol"?function(i){var o;return i!=null&&(o=i[Ve])&&o.apply(i)}:function(){return null};function Ie(i,o){return o=i.indexOf(o),0<=o&&i.splice(o,1),0<=o}var We={};function ne(i){var o,u,l,h;if(arguments.length===1){if(f(i))return i.slice();if(this===We&&typeof i=="string")return[i];if(h=_t(i)){for(u=[];!(l=h.next()).done;)u.push(l.value);return u}if(i==null)return[i];if(typeof(o=i.length)!="number")return[i];for(u=new Array(o);o--;)u[o]=i[o];return u}for(o=arguments.length,u=new Array(o);o--;)u[o]=arguments[o];return u}var Se=typeof Symbol<"u"?function(i){return i[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},on=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],at=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(on),$e={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function he(i,o){this.name=i,this.message=o}function Me(i,o){return i+". Errors: "+Object.keys(o).map(function(u){return o[u].toString()}).filter(function(u,l,h){return h.indexOf(u)===l}).join(`
`)}function it(i,o,u,l){this.failures=o,this.failedKeys=l,this.successCount=u,this.message=Me(i,o)}function $t(i,o){this.name="BulkError",this.failures=Object.keys(o).map(function(u){return o[u]}),this.failuresByPos=o,this.message=Me(i,this.failures)}O(he).from(Error).extend({toString:function(){return this.name+": "+this.message}}),O(it).from(he),O($t).from(he);var _a=at.reduce(function(i,o){return i[o]=o+"Error",i},{}),Df=he,te=at.reduce(function(i,o){var u=o+"Error";function l(h,p){this.name=u,h?typeof h=="string"?(this.message="".concat(h).concat(p?`
 `+p:""),this.inner=p||null):typeof h=="object"&&(this.message="".concat(h.name," ").concat(h.message),this.inner=h):(this.message=$e[o]||u,this.inner=null)}return O(l).from(Df),i[o]=l,i},{});te.Syntax=SyntaxError,te.Type=TypeError,te.Range=RangeError;var Ps=on.reduce(function(i,o){return i[o+"Error"]=te[o],i},{}),ai=at.reduce(function(i,o){return["Syntax","Type","Range"].indexOf(o)===-1&&(i[o+"Error"]=te[o]),i},{});function ve(){}function nn(i){return i}function Rf(i,o){return i==null||i===nn?o:function(u){return o(i(u))}}function rr(i,o){return function(){i.apply(this,arguments),o.apply(this,arguments)}}function Af(i,o){return i===ve?o:function(){var u=i.apply(this,arguments);u!==void 0&&(arguments[0]=u);var l=this.onsuccess,h=this.onerror;this.onsuccess=null,this.onerror=null;var p=o.apply(this,arguments);return l&&(this.onsuccess=this.onsuccess?rr(l,this.onsuccess):l),h&&(this.onerror=this.onerror?rr(h,this.onerror):h),p!==void 0?p:u}}function Tf(i,o){return i===ve?o:function(){i.apply(this,arguments);var u=this.onsuccess,l=this.onerror;this.onsuccess=this.onerror=null,o.apply(this,arguments),u&&(this.onsuccess=this.onsuccess?rr(u,this.onsuccess):u),l&&(this.onerror=this.onerror?rr(l,this.onerror):l)}}function Mf(i,o){return i===ve?o:function(u){var l=i.apply(this,arguments);d(u,l);var h=this.onsuccess,p=this.onerror;return this.onsuccess=null,this.onerror=null,u=o.apply(this,arguments),h&&(this.onsuccess=this.onsuccess?rr(h,this.onsuccess):h),p&&(this.onerror=this.onerror?rr(p,this.onerror):p),l===void 0?u===void 0?void 0:u:d(l,u)}}function Nf(i,o){return i===ve?o:function(){return o.apply(this,arguments)!==!1&&i.apply(this,arguments)}}function Ea(i,o){return i===ve?o:function(){var u=i.apply(this,arguments);if(u&&typeof u.then=="function"){for(var l=this,h=arguments.length,p=new Array(h);h--;)p[h]=arguments[h];return u.then(function(){return o.apply(l,p)})}return o.apply(this,arguments)}}ai.ModifyError=it,ai.DexieError=he,ai.BulkError=$t;var pt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ds(i){pt=i}var an={},Rs=100,St=typeof Promise>"u"?[]:(function(){var i=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[i,v(i),i];var o=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[o,v(o),i]})(),on=St[0],at=St[1],St=St[2],at=at&&at.then,nr=on&&on.constructor,Sa=!!St,sn=function(i,o){un.push([i,o]),oi&&(queueMicrotask(Bf),oi=!1)},ka=!0,oi=!0,ir=[],si=[],xa=nn,jt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ve,pgp:!1,env:{},finalize:ve},Z=jt,un=[],ar=0,ui=[];function Q(i){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var o=this._PSD=Z;if(typeof i!="function"){if(i!==an)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Ia(this,this._value))}this._state=null,this._value=null,++o.ref,(function u(l,h){try{h(function(p){if(l._state===null){if(p===l)throw new TypeError("A promise cannot be resolved with itself.");var y=l._lib&&Dr();p&&typeof p.then=="function"?u(l,function(b,k){p instanceof Q?p._then(b,k):p.then(b,k)}):(l._state=!0,l._value=p,Ts(l)),y&&Rr()}},Ia.bind(null,l))}catch(p){Ia(l,p)}})(this,i)}var Oa={get:function(){var i=Z,o=hi;function u(l,h){var p=this,y=!i.global&&(i!==Z||o!==hi),b=y&&!Ft(),k=new Q(function(I,R){Ca(p,new As(Ns(l,i,y,b),Ns(h,i,y,b),I,R,i))});return this._consoleTask&&(k._consoleTask=this._consoleTask),k}return u.prototype=an,u},set:function(i){E(this,"then",i&&i.prototype===an?Oa:{get:function(){return i},set:Oa.set})}};function As(i,o,u,l,h){this.onFulfilled=typeof i=="function"?i:null,this.onRejected=typeof o=="function"?o:null,this.resolve=u,this.reject=l,this.psd=h}function Ia(i,o){var u,l;si.push(o),i._state===null&&(u=i._lib&&Dr(),o=xa(o),i._state=!1,i._value=o,l=i,ir.some(function(h){return h._value===l._value})||ir.push(l),Ts(i),u&&Rr())}function Ts(i){var o=i._listeners;i._listeners=[];for(var u=0,l=o.length;u<l;++u)Ca(i,o[u]);var h=i._PSD;--h.ref||h.finalize(),ar===0&&(++ar,sn(function(){--ar==0&&Pa()},[]))}function Ca(i,o){if(i._state!==null){var u=i._state?o.onFulfilled:o.onRejected;if(u===null)return(i._state?o.resolve:o.reject)(i._value);++o.psd.ref,++ar,sn(Lf,[u,i,o])}else i._listeners.push(o)}function Lf(i,o,u){try{var l,h=o._value;!o._state&&si.length&&(si=[]),l=pt&&o._consoleTask?o._consoleTask.run(function(){return i(h)}):i(h),o._state||si.indexOf(h)!==-1||(function(p){for(var y=ir.length;y;)if(ir[--y]._value===p._value)return ir.splice(y,1)})(o),u.resolve(l)}catch(p){u.reject(p)}finally{--ar==0&&Pa(),--u.psd.ref||u.psd.finalize()}}function Bf(){or(jt,function(){Dr()&&Rr()})}function Dr(){var i=ka;return oi=ka=!1,i}function Rr(){var i,o,u;do for(;0<un.length;)for(i=un,un=[],u=i.length,o=0;o<u;++o){var l=i[o];l[0].apply(null,l[1])}while(0<un.length);oi=ka=!0}function Pa(){var i=ir;ir=[],i.forEach(function(l){l._PSD.onunhandled.call(null,l._value,l)});for(var o=ui.slice(0),u=o.length;u;)o[--u]()}function ci(i){return new Q(an,!1,i)}function ke(i,o){var u=Z;return function(){var l=Dr(),h=Z;try{return qt(u,!0),i.apply(this,arguments)}catch(p){o&&o(p)}finally{qt(h,!1),l&&Rr()}}}S(Q.prototype,{then:Oa,_then:function(i,o){Ca(this,new As(null,null,i,o,Z))},catch:function(i){if(arguments.length===1)return this.then(null,i);var o=i,u=arguments[1];return typeof o=="function"?this.then(null,function(l){return(l instanceof o?u:ci)(l)}):this.then(null,function(l){return(l&&l.name===o?u:ci)(l)})},finally:function(i){return this.then(function(o){return Q.resolve(i()).then(function(){return o})},function(o){return Q.resolve(i()).then(function(){return ci(o)})})},timeout:function(i,o){var u=this;return i<1/0?new Q(function(l,h){var p=setTimeout(function(){return h(new te.Timeout(o))},i);u.then(l,h).finally(clearTimeout.bind(null,p))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&E(Q.prototype,Symbol.toStringTag,"Dexie.Promise"),jt.env=Ms(),S(Q,{all:function(){var i=ne.apply(null,arguments).map(di);return new Q(function(o,u){i.length===0&&o([]);var l=i.length;i.forEach(function(h,p){return Q.resolve(h).then(function(y){i[p]=y,--l||o(i)},u)})})},resolve:function(i){return i instanceof Q?i:i&&typeof i.then=="function"?new Q(function(o,u){i.then(o,u)}):new Q(an,!0,i)},reject:ci,race:function(){var i=ne.apply(null,arguments).map(di);return new Q(function(o,u){i.map(function(l){return Q.resolve(l).then(o,u)})})},PSD:{get:function(){return Z},set:function(i){return Z=i}},totalEchoes:{get:function(){return hi}},newPSD:Kt,usePSD:or,scheduler:{get:function(){return sn},set:function(i){sn=i}},rejectionMapper:{get:function(){return xa},set:function(i){xa=i}},follow:function(i,o){return new Q(function(u,l){return Kt(function(h,p){var y=Z;y.unhandleds=[],y.onunhandled=p,y.finalize=rr(function(){var b,k=this;b=function(){k.unhandleds.length===0?h():p(k.unhandleds[0])},ui.push(function I(){b(),ui.splice(ui.indexOf(I),1)}),++ar,sn(function(){--ar==0&&Pa()},[])},y.finalize),i()},o,u,l)})}}),nr&&(nr.allSettled&&E(Q,"allSettled",function(){var i=ne.apply(null,arguments).map(di);return new Q(function(o){i.length===0&&o([]);var u=i.length,l=new Array(u);i.forEach(function(h,p){return Q.resolve(h).then(function(y){return l[p]={status:"fulfilled",value:y}},function(y){return l[p]={status:"rejected",reason:y}}).then(function(){return--u||o(l)})})})}),nr.any&&typeof AggregateError<"u"&&E(Q,"any",function(){var i=ne.apply(null,arguments).map(di);return new Q(function(o,u){i.length===0&&u(new AggregateError([]));var l=i.length,h=new Array(l);i.forEach(function(p,y){return Q.resolve(p).then(function(b){return o(b)},function(b){h[y]=b,--l||u(new AggregateError(h))})})})}),nr.withResolvers&&(Q.withResolvers=nr.withResolvers));var Ne={awaits:0,echoes:0,id:0},$f=0,li=[],fi=0,hi=0,jf=0;function Kt(i,o,u,l){var h=Z,p=Object.create(h);return p.parent=h,p.ref=0,p.global=!1,p.id=++jf,jt.env,p.env=Sa?{Promise:Q,PromiseProp:{value:Q,configurable:!0,writable:!0},all:Q.all,race:Q.race,allSettled:Q.allSettled,any:Q.any,resolve:Q.resolve,reject:Q.reject}:{},o&&d(p,o),++h.ref,p.finalize=function(){--this.parent.ref||this.parent.finalize()},l=or(p,i,u,l),p.ref===0&&p.finalize(),l}function Ar(){return Ne.id||(Ne.id=++$f),++Ne.awaits,Ne.echoes+=Rs,Ne.id}function Ft(){return!!Ne.awaits&&(--Ne.awaits==0&&(Ne.id=0),Ne.echoes=Ne.awaits*Rs,!0)}function di(i){return Ne.echoes&&i&&i.constructor===nr?(Ar(),i.then(function(o){return Ft(),o},function(o){return Ft(),Ce(o)})):i}function Kf(){var i=li[li.length-1];li.pop(),qt(i,!1)}function qt(i,o){var u,l=Z;(o?!Ne.echoes||fi++&&i===Z:!fi||--fi&&i===Z)||queueMicrotask(o?(function(h){++hi,Ne.echoes&&--Ne.echoes!=0||(Ne.echoes=Ne.awaits=Ne.id=0),li.push(Z),qt(h,!0)}).bind(null,i):Kf),i!==Z&&(Z=i,l===jt&&(jt.env=Ms()),Sa&&(u=jt.env.Promise,o=i.env,(l.global||i.global)&&(Object.defineProperty(s,"Promise",o.PromiseProp),u.all=o.all,u.race=o.race,u.resolve=o.resolve,u.reject=o.reject,o.allSettled&&(u.allSettled=o.allSettled),o.any&&(u.any=o.any))))}function Ms(){var i=s.Promise;return Sa?{Promise:i,PromiseProp:Object.getOwnPropertyDescriptor(s,"Promise"),all:i.all,race:i.race,allSettled:i.allSettled,any:i.any,resolve:i.resolve,reject:i.reject}:{}}function or(i,o,u,l,h){var p=Z;try{return qt(i,!0),o(u,l,h)}finally{qt(p,!1)}}function Ns(i,o,u,l){return typeof i!="function"?i:function(){var h=Z;u&&Ar(),qt(o,!0);try{return i.apply(this,arguments)}finally{qt(h,!1),l&&queueMicrotask(Ft)}}}function Da(i){Promise===nr&&Ne.echoes===0?fi===0?i():enqueueNativeMicroTask(i):setTimeout(i,0)}(""+at).indexOf("[native code]")===-1&&(Ar=Ft=ve);var Ce=Q.reject,sr="ï¿¿",Et="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Ls="String expected.",Tr=[],pi="__dbnames",Ra="readonly",Aa="readwrite";function ur(i,o){return i?o?function(){return i.apply(this,arguments)&&o.apply(this,arguments)}:i:o}var Bs={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function mi(i){return typeof i!="string"||/\./.test(i)?function(o){return o}:function(o){return o[i]===void 0&&i in o&&delete(o=we(o))[i],o}}function $s(){throw te.Type()}function de(i,o){try{var u=js(i),l=js(o);if(u!==l)return u==="Array"?1:l==="Array"?-1:u==="binary"?1:l==="binary"?-1:u==="string"?1:l==="string"?-1:u==="Date"?1:l!=="Date"?NaN:-1;switch(u){case"number":case"Date":case"string":return o<i?1:i<o?-1:0;case"binary":return(function(h,p){for(var y=h.length,b=p.length,k=y<b?y:b,I=0;I<k;++I)if(h[I]!==p[I])return h[I]<p[I]?-1:1;return y===b?0:y<b?-1:1})(Ks(i),Ks(o));case"Array":return(function(h,p){for(var y=h.length,b=p.length,k=y<b?y:b,I=0;I<k;++I){var R=de(h[I],p[I]);if(R!==0)return R}return y===b?0:y<b?-1:1})(i,o)}}catch{}return NaN}function js(i){var o=typeof i;return o!="object"?o:ArrayBuffer.isView(i)?"binary":(i=Oe(i),i==="ArrayBuffer"?"binary":i)}function Ks(i){return i instanceof Uint8Array?i:ArrayBuffer.isView(i)?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i)}var Fs=(_e.prototype._trans=function(i,o,u){var l=this._tx||Z.trans,h=this.name,p=pt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(i==="readonly"?"read":"write"," ").concat(this.name));function y(I,R,_){if(!_.schema[h])throw new te.NotFound("Table "+h+" not part of transaction");return o(_.idbtrans,_)}var b=Dr();try{var k=l&&l.db._novip===this.db._novip?l===Z.trans?l._promise(i,y,u):Kt(function(){return l._promise(i,y,u)},{trans:l,transless:Z.transless||Z}):(function I(R,_,T,x){if(R.idbdb&&(R._state.openComplete||Z.letThrough||R._vip)){var D=R._createTransaction(_,T,R._dbSchema);try{D.create(),R._state.PR1398_maxLoop=3}catch(A){return A.name===_a.InvalidState&&R.isOpen()&&0<--R._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),R.close({disableAutoOpen:!1}),R.open().then(function(){return I(R,_,T,x)})):Ce(A)}return D._promise(_,function(A,C){return Kt(function(){return Z.trans=D,x(A,C,D)})}).then(function(A){if(_==="readwrite")try{D.idbtrans.commit()}catch{}return _==="readonly"?A:D._completion.then(function(){return A})})}if(R._state.openComplete)return Ce(new te.DatabaseClosed(R._state.dbOpenError));if(!R._state.isBeingOpened){if(!R._state.autoOpen)return Ce(new te.DatabaseClosed);R.open().catch(ve)}return R._state.dbReadyPromise.then(function(){return I(R,_,T,x)})})(this.db,i,[this.name],y);return p&&(k._consoleTask=p,k=k.catch(function(I){return console.trace(I),Ce(I)})),k}finally{b&&Rr()}},_e.prototype.get=function(i,o){var u=this;return i&&i.constructor===Object?this.where(i).first(o):i==null?Ce(new te.Type("Invalid argument to Table.get()")):this._trans("readonly",function(l){return u.core.get({trans:l,key:i}).then(function(h){return u.hook.reading.fire(h)})}).then(o)},_e.prototype.where=function(i){if(typeof i=="string")return new this.db.WhereClause(this,i);if(f(i))return new this.db.WhereClause(this,"[".concat(i.join("+"),"]"));var o=c(i);if(o.length===1)return this.where(o[0]).equals(i[o[0]]);var u=this.schema.indexes.concat(this.schema.primKey).filter(function(b){if(b.compound&&o.every(function(I){return 0<=b.keyPath.indexOf(I)})){for(var k=0;k<o.length;++k)if(o.indexOf(b.keyPath[k])===-1)return!1;return!0}return!1}).sort(function(b,k){return b.keyPath.length-k.keyPath.length})[0];if(u&&this.db._maxKey!==sr){var p=u.keyPath.slice(0,o.length);return this.where(p).equals(p.map(function(k){return i[k]}))}!u&&pt&&console.warn("The query ".concat(JSON.stringify(i)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(o.join("+"),"]"));var l=this.schema.idxByName;function h(b,k){return de(b,k)===0}var y=o.reduce(function(_,k){var I=_[0],R=_[1],_=l[k],T=i[k];return[I||_,I||!_?ur(R,_&&_.multi?function(x){return x=Y(x,k),f(x)&&x.some(function(D){return h(T,D)})}:function(x){return h(T,Y(x,k))}):R]},[null,null]),p=y[0],y=y[1];return p?this.where(p.name).equals(i[p.keyPath]).filter(y):u?this.filter(y):this.where(o).equals("")},_e.prototype.filter=function(i){return this.toCollection().and(i)},_e.prototype.count=function(i){return this.toCollection().count(i)},_e.prototype.offset=function(i){return this.toCollection().offset(i)},_e.prototype.limit=function(i){return this.toCollection().limit(i)},_e.prototype.each=function(i){return this.toCollection().each(i)},_e.prototype.toArray=function(i){return this.toCollection().toArray(i)},_e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},_e.prototype.orderBy=function(i){return new this.db.Collection(new this.db.WhereClause(this,f(i)?"[".concat(i.join("+"),"]"):i))},_e.prototype.reverse=function(){return this.toCollection().reverse()},_e.prototype.mapToClass=function(i){var o,u=this.db,l=this.name;function h(){return o!==null&&o.apply(this,arguments)||this}(this.schema.mappedClass=i).prototype instanceof $s&&((function(k,I){if(typeof I!="function"&&I!==null)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");function R(){this.constructor=k}r(k,I),k.prototype=I===null?Object.create(I):(R.prototype=I.prototype,new R)})(h,o=i),Object.defineProperty(h.prototype,"db",{get:function(){return u},enumerable:!1,configurable:!0}),h.prototype.table=function(){return l},i=h);for(var p=new Set,y=i.prototype;y;y=v(y))Object.getOwnPropertyNames(y).forEach(function(k){return p.add(k)});function b(k){if(!k)return k;var I,R=Object.create(i.prototype);for(I in k)if(!p.has(I))try{R[I]=k[I]}catch{}return R}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=b,this.hook("reading",b),i},_e.prototype.defineClass=function(){return this.mapToClass(function(i){d(this,i)})},_e.prototype.add=function(i,o){var u=this,l=this.schema.primKey,h=l.auto,p=l.keyPath,y=i;return p&&h&&(y=mi(p)(i)),this._trans("readwrite",function(b){return u.core.mutate({trans:b,type:"add",keys:o!=null?[o]:null,values:[y]})}).then(function(b){return b.numFailures?Q.reject(b.failures[0]):b.lastResult}).then(function(b){if(p)try{V(i,p,b)}catch{}return b})},_e.prototype.update=function(i,o){return typeof i!="object"||f(i)?this.where(":id").equals(i).modify(o):(i=Y(i,this.schema.primKey.keyPath),i===void 0?Ce(new te.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(i).modify(o))},_e.prototype.put=function(i,o){var u=this,l=this.schema.primKey,h=l.auto,p=l.keyPath,y=i;return p&&h&&(y=mi(p)(i)),this._trans("readwrite",function(b){return u.core.mutate({trans:b,type:"put",values:[y],keys:o!=null?[o]:null})}).then(function(b){return b.numFailures?Q.reject(b.failures[0]):b.lastResult}).then(function(b){if(p)try{V(i,p,b)}catch{}return b})},_e.prototype.delete=function(i){var o=this;return this._trans("readwrite",function(u){return o.core.mutate({trans:u,type:"delete",keys:[i]})}).then(function(u){return u.numFailures?Q.reject(u.failures[0]):void 0})},_e.prototype.clear=function(){var i=this;return this._trans("readwrite",function(o){return i.core.mutate({trans:o,type:"deleteRange",range:Bs})}).then(function(o){return o.numFailures?Q.reject(o.failures[0]):void 0})},_e.prototype.bulkGet=function(i){var o=this;return this._trans("readonly",function(u){return o.core.getMany({keys:i,trans:u}).then(function(l){return l.map(function(h){return o.hook.reading.fire(h)})})})},_e.prototype.bulkAdd=function(i,o,u){var l=this,h=Array.isArray(o)?o:void 0,p=(u=u||(h?void 0:o))?u.allKeys:void 0;return this._trans("readwrite",function(y){var I=l.schema.primKey,b=I.auto,I=I.keyPath;if(I&&h)throw new te.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(h&&h.length!==i.length)throw new te.InvalidArgument("Arguments objects and keys must have the same length");var k=i.length,I=I&&b?i.map(mi(I)):i;return l.core.mutate({trans:y,type:"add",keys:h,values:I,wantResults:p}).then(function(D){var _=D.numFailures,T=D.results,x=D.lastResult,D=D.failures;if(_===0)return p?T:x;throw new $t("".concat(l.name,".bulkAdd(): ").concat(_," of ").concat(k," operations failed"),D)})})},_e.prototype.bulkPut=function(i,o,u){var l=this,h=Array.isArray(o)?o:void 0,p=(u=u||(h?void 0:o))?u.allKeys:void 0;return this._trans("readwrite",function(y){var I=l.schema.primKey,b=I.auto,I=I.keyPath;if(I&&h)throw new te.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(h&&h.length!==i.length)throw new te.InvalidArgument("Arguments objects and keys must have the same length");var k=i.length,I=I&&b?i.map(mi(I)):i;return l.core.mutate({trans:y,type:"put",keys:h,values:I,wantResults:p}).then(function(D){var _=D.numFailures,T=D.results,x=D.lastResult,D=D.failures;if(_===0)return p?T:x;throw new $t("".concat(l.name,".bulkPut(): ").concat(_," of ").concat(k," operations failed"),D)})})},_e.prototype.bulkUpdate=function(i){var o=this,u=this.core,l=i.map(function(y){return y.key}),h=i.map(function(y){return y.changes}),p=[];return this._trans("readwrite",function(y){return u.getMany({trans:y,keys:l,cache:"clone"}).then(function(b){var k=[],I=[];i.forEach(function(_,T){var x=_.key,D=_.changes,A=b[T];if(A){for(var C=0,M=Object.keys(D);C<M.length;C++){var N=M[C],L=D[N];if(N===o.schema.primKey.keyPath){if(de(L,x)!==0)throw new te.Constraint("Cannot update primary key in bulkUpdate()")}else V(A,N,L)}p.push(T),k.push(x),I.push(A)}});var R=k.length;return u.mutate({trans:y,type:"put",keys:k,values:I,updates:{keys:l,changeSpecs:h}}).then(function(_){var T=_.numFailures,x=_.failures;if(T===0)return R;for(var D=0,A=Object.keys(x);D<A.length;D++){var C,M=A[D],N=p[Number(M)];N!=null&&(C=x[M],delete x[M],x[N]=C)}throw new $t("".concat(o.name,".bulkUpdate(): ").concat(T," of ").concat(R," operations failed"),x)})})})},_e.prototype.bulkDelete=function(i){var o=this,u=i.length;return this._trans("readwrite",function(l){return o.core.mutate({trans:l,type:"delete",keys:i})}).then(function(y){var h=y.numFailures,p=y.lastResult,y=y.failures;if(h===0)return p;throw new $t("".concat(o.name,".bulkDelete(): ").concat(h," of ").concat(u," operations failed"),y)})},_e);function _e(){}function cn(i){function o(y,b){if(b){for(var k=arguments.length,I=new Array(k-1);--k;)I[k-1]=arguments[k];return u[y].subscribe.apply(null,I),i}if(typeof y=="string")return u[y]}var u={};o.addEventType=p;for(var l=1,h=arguments.length;l<h;++l)p(arguments[l]);return o;function p(y,b,k){if(typeof y!="object"){var I;b=b||Nf;var R={subscribers:[],fire:k=k||ve,subscribe:function(_){R.subscribers.indexOf(_)===-1&&(R.subscribers.push(_),R.fire=b(R.fire,_))},unsubscribe:function(_){R.subscribers=R.subscribers.filter(function(T){return T!==_}),R.fire=R.subscribers.reduce(b,k)}};return u[y]=o[y]=R}c(I=y).forEach(function(_){var T=I[_];if(f(T))p(_,I[_][0],I[_][1]);else{if(T!=="asap")throw new te.InvalidArgument("Invalid event config");var x=p(_,nn,function(){for(var D=arguments.length,A=new Array(D);D--;)A[D]=arguments[D];x.subscribers.forEach(function(C){X(function(){C.apply(null,A)})})})}})}}function ln(i,o){return O(o).from({prototype:i}),o}function Mr(i,o){return!(i.filter||i.algorithm||i.or)&&(o?i.justLimit:!i.replayFilter)}function Ta(i,o){i.filter=ur(i.filter,o)}function Ma(i,o,u){var l=i.replayFilter;i.replayFilter=l?function(){return ur(l(),o())}:o,i.justLimit=u&&!l}function vi(i,o){if(i.isPrimKey)return o.primaryKey;var u=o.getIndexByKeyPath(i.index);if(!u)throw new te.Schema("KeyPath "+i.index+" on object store "+o.name+" is not indexed");return u}function qs(i,o,u){var l=vi(i,o.schema);return o.openCursor({trans:u,values:!i.keysOnly,reverse:i.dir==="prev",unique:!!i.unique,query:{index:l,range:i.range}})}function yi(i,o,u,l){var h=i.replayFilter?ur(i.filter,i.replayFilter()):i.filter;if(i.or){var p={},y=function(b,k,I){var R,_;h&&!h(k,I,function(T){return k.stop(T)},function(T){return k.fail(T)})||((_=""+(R=k.primaryKey))=="[object ArrayBuffer]"&&(_=""+new Uint8Array(R)),g(p,_)||(p[_]=!0,o(b,k,I)))};return Promise.all([i.or._iterate(y,u),Ws(qs(i,l,u),i.algorithm,y,!i.keysOnly&&i.valueMapper)])}return Ws(qs(i,l,u),ur(i.algorithm,h),o,!i.keysOnly&&i.valueMapper)}function Ws(i,o,u,l){var h=ke(l?function(p,y,b){return u(l(p),y,b)}:u);return i.then(function(p){if(p)return p.start(function(){var y=function(){return p.continue()};o&&!o(p,function(b){return y=b},function(b){p.stop(b),y=ve},function(b){p.fail(b),y=ve})||h(p.value,p,function(b){return y=b}),y()})})}var St=Symbol(),fn=(Us.prototype.execute=function(i){if(this.add!==void 0){var o=this.add;if(f(o))return a(a([],f(i)?i:[],!0),o).sort();if(typeof o=="number")return(Number(i)||0)+o;if(typeof o=="bigint")try{return BigInt(i)+o}catch{return BigInt(0)+o}throw new TypeError("Invalid term ".concat(o))}if(this.remove!==void 0){var u=this.remove;if(f(u))return f(i)?i.filter(function(l){return!u.includes(l)}).sort():[];if(typeof u=="number")return Number(i)-u;if(typeof u=="bigint")try{return BigInt(i)-u}catch{return BigInt(0)-u}throw new TypeError("Invalid subtrahend ".concat(u))}return o=(o=this.replacePrefix)===null||o===void 0?void 0:o[0],o&&typeof i=="string"&&i.startsWith(o)?this.replacePrefix[1]+i.substring(o.length):i},Us);function Us(i){Object.assign(this,i)}var Ff=(pe.prototype._read=function(i,o){var u=this._ctx;return u.error?u.table._trans(null,Ce.bind(null,u.error)):u.table._trans("readonly",i).then(o)},pe.prototype._write=function(i){var o=this._ctx;return o.error?o.table._trans(null,Ce.bind(null,o.error)):o.table._trans("readwrite",i,"locked")},pe.prototype._addAlgorithm=function(i){var o=this._ctx;o.algorithm=ur(o.algorithm,i)},pe.prototype._iterate=function(i,o){return yi(this._ctx,i,o,this._ctx.table.core)},pe.prototype.clone=function(i){var o=Object.create(this.constructor.prototype),u=Object.create(this._ctx);return i&&d(u,i),o._ctx=u,o},pe.prototype.raw=function(){return this._ctx.valueMapper=null,this},pe.prototype.each=function(i){var o=this._ctx;return this._read(function(u){return yi(o,i,u,o.table.core)})},pe.prototype.count=function(i){var o=this;return this._read(function(u){var l=o._ctx,h=l.table.core;if(Mr(l,!0))return h.count({trans:u,query:{index:vi(l,h.schema),range:l.range}}).then(function(y){return Math.min(y,l.limit)});var p=0;return yi(l,function(){return++p,!1},u,h).then(function(){return p})}).then(i)},pe.prototype.sortBy=function(i,o){var u=i.split(".").reverse(),l=u[0],h=u.length-1;function p(k,I){return I?p(k[u[I]],I-1):k[l]}var y=this._ctx.dir==="next"?1:-1;function b(k,I){return de(p(k,h),p(I,h))*y}return this.toArray(function(k){return k.sort(b)}).then(o)},pe.prototype.toArray=function(i){var o=this;return this._read(function(u){var l=o._ctx;if(l.dir==="next"&&Mr(l,!0)&&0<l.limit){var h=l.valueMapper,p=vi(l,l.table.core.schema);return l.table.core.query({trans:u,limit:l.limit,values:!0,query:{index:p,range:l.range}}).then(function(b){return b=b.result,h?b.map(h):b})}var y=[];return yi(l,function(b){return y.push(b)},u,l.table.core).then(function(){return y})},i)},pe.prototype.offset=function(i){var o=this._ctx;return i<=0||(o.offset+=i,Mr(o)?Ma(o,function(){var u=i;return function(l,h){return u===0||(u===1?--u:h(function(){l.advance(u),u=0}),!1)}}):Ma(o,function(){var u=i;return function(){return--u<0}})),this},pe.prototype.limit=function(i){return this._ctx.limit=Math.min(this._ctx.limit,i),Ma(this._ctx,function(){var o=i;return function(u,l,h){return--o<=0&&l(h),0<=o}},!0),this},pe.prototype.until=function(i,o){return Ta(this._ctx,function(u,l,h){return!i(u.value)||(l(h),o)}),this},pe.prototype.first=function(i){return this.limit(1).toArray(function(o){return o[0]}).then(i)},pe.prototype.last=function(i){return this.reverse().first(i)},pe.prototype.filter=function(i){var o;return Ta(this._ctx,function(u){return i(u.value)}),(o=this._ctx).isMatch=ur(o.isMatch,i),this},pe.prototype.and=function(i){return this.filter(i)},pe.prototype.or=function(i){return new this.db.WhereClause(this._ctx.table,i,this)},pe.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},pe.prototype.desc=function(){return this.reverse()},pe.prototype.eachKey=function(i){var o=this._ctx;return o.keysOnly=!o.isMatch,this.each(function(u,l){i(l.key,l)})},pe.prototype.eachUniqueKey=function(i){return this._ctx.unique="unique",this.eachKey(i)},pe.prototype.eachPrimaryKey=function(i){var o=this._ctx;return o.keysOnly=!o.isMatch,this.each(function(u,l){i(l.primaryKey,l)})},pe.prototype.keys=function(i){var o=this._ctx;o.keysOnly=!o.isMatch;var u=[];return this.each(function(l,h){u.push(h.key)}).then(function(){return u}).then(i)},pe.prototype.primaryKeys=function(i){var o=this._ctx;if(o.dir==="next"&&Mr(o,!0)&&0<o.limit)return this._read(function(l){var h=vi(o,o.table.core.schema);return o.table.core.query({trans:l,values:!1,limit:o.limit,query:{index:h,range:o.range}})}).then(function(l){return l.result}).then(i);o.keysOnly=!o.isMatch;var u=[];return this.each(function(l,h){u.push(h.primaryKey)}).then(function(){return u}).then(i)},pe.prototype.uniqueKeys=function(i){return this._ctx.unique="unique",this.keys(i)},pe.prototype.firstKey=function(i){return this.limit(1).keys(function(o){return o[0]}).then(i)},pe.prototype.lastKey=function(i){return this.reverse().firstKey(i)},pe.prototype.distinct=function(){var i=this._ctx,i=i.index&&i.table.schema.idxByName[i.index];if(!i||!i.multi)return this;var o={};return Ta(this._ctx,function(h){var l=h.primaryKey.toString(),h=g(o,l);return o[l]=!0,!h}),this},pe.prototype.modify=function(i){var o=this,u=this._ctx;return this._write(function(l){var h,p,y;y=typeof i=="function"?i:(h=c(i),p=h.length,function(C){for(var M=!1,N=0;N<p;++N){var L=h[N],$=i[L],K=Y(C,L);$ instanceof fn?(V(C,L,$.execute(K)),M=!0):K!==$&&(V(C,L,$),M=!0)}return M});var b=u.table.core,_=b.schema.primaryKey,k=_.outbound,I=_.extractKey,R=200,_=o.db._options.modifyChunkSize;_&&(R=typeof _=="object"?_[b.name]||_["*"]||200:_);function T(C,L){var N=L.failures,L=L.numFailures;D+=C-L;for(var $=0,K=c(N);$<K.length;$++){var U=K[$];x.push(N[U])}}var x=[],D=0,A=[];return o.clone().primaryKeys().then(function(C){function M(L){var $=Math.min(R,C.length-L);return b.getMany({trans:l,keys:C.slice(L,L+$),cache:"immutable"}).then(function(K){for(var U=[],F=[],q=k?[]:null,z=[],W=0;W<$;++W){var G=K[W],ae={value:we(G),primKey:C[L+W]};y.call(ae,ae.value,ae)!==!1&&(ae.value==null?z.push(C[L+W]):k||de(I(G),I(ae.value))===0?(F.push(ae.value),k&&q.push(C[L+W])):(z.push(C[L+W]),U.push(ae.value)))}return Promise.resolve(0<U.length&&b.mutate({trans:l,type:"add",values:U}).then(function(ce){for(var le in ce.failures)z.splice(parseInt(le),1);T(U.length,ce)})).then(function(){return(0<F.length||N&&typeof i=="object")&&b.mutate({trans:l,type:"put",keys:q,values:F,criteria:N,changeSpec:typeof i!="function"&&i,isAdditionalChunk:0<L}).then(function(ce){return T(F.length,ce)})}).then(function(){return(0<z.length||N&&i===Na)&&b.mutate({trans:l,type:"delete",keys:z,criteria:N,isAdditionalChunk:0<L}).then(function(ce){return T(z.length,ce)})}).then(function(){return C.length>L+$&&M(L+R)})})}var N=Mr(u)&&u.limit===1/0&&(typeof i!="function"||i===Na)&&{index:u.index,range:u.range};return M(0).then(function(){if(0<x.length)throw new it("Error modifying one or more objects",x,D,A);return C.length})})})},pe.prototype.delete=function(){var i=this._ctx,o=i.range;return Mr(i)&&(i.isPrimKey||o.type===3)?this._write(function(u){var l=i.table.core.schema.primaryKey,h=o;return i.table.core.count({trans:u,query:{index:l,range:h}}).then(function(p){return i.table.core.mutate({trans:u,type:"deleteRange",range:h}).then(function(y){var b=y.failures;if(y.lastResult,y.results,y=y.numFailures,y)throw new it("Could not delete some values",Object.keys(b).map(function(k){return b[k]}),p-y);return p-y})})}):this.modify(Na)},pe);function pe(){}var Na=function(i,o){return o.value=null};function qf(i,o){return i<o?-1:i===o?0:1}function Wf(i,o){return o<i?-1:i===o?0:1}function Ge(i,o,u){return i=i instanceof zs?new i.Collection(i):i,i._ctx.error=new(u||TypeError)(o),i}function Nr(i){return new i.Collection(i,function(){return Hs("")}).limit(0)}function gi(i,o,u,l){var h,p,y,b,k,I,R,_=u.length;if(!u.every(function(D){return typeof D=="string"}))return Ge(i,Ls);function T(D){h=D==="next"?function(C){return C.toUpperCase()}:function(C){return C.toLowerCase()},p=D==="next"?function(C){return C.toLowerCase()}:function(C){return C.toUpperCase()},y=D==="next"?qf:Wf;var A=u.map(function(C){return{lower:p(C),upper:h(C)}}).sort(function(C,M){return y(C.lower,M.lower)});b=A.map(function(C){return C.upper}),k=A.map(function(C){return C.lower}),R=(I=D)==="next"?"":l}T("next"),i=new i.Collection(i,function(){return Wt(b[0],k[_-1]+l)}),i._ondirectionchange=function(D){T(D)};var x=0;return i._addAlgorithm(function(D,A,C){var M=D.key;if(typeof M!="string")return!1;var N=p(M);if(o(N,k,x))return!0;for(var L=null,$=x;$<_;++$){var K=(function(U,F,q,z,W,G){for(var ae=Math.min(U.length,z.length),ce=-1,le=0;le<ae;++le){var Ye=F[le];if(Ye!==z[le])return W(U[le],q[le])<0?U.substr(0,le)+q[le]+q.substr(le+1):W(U[le],z[le])<0?U.substr(0,le)+z[le]+q.substr(le+1):0<=ce?U.substr(0,ce)+F[ce]+q.substr(ce+1):null;W(U[le],Ye)<0&&(ce=le)}return ae<z.length&&G==="next"?U+q.substr(U.length):ae<U.length&&G==="prev"?U.substr(0,q.length):ce<0?null:U.substr(0,ce)+z[ce]+q.substr(ce+1)})(M,N,b[$],k[$],y,I);K===null&&L===null?x=$+1:(L===null||0<y(L,K))&&(L=K)}return A(L!==null?function(){D.continue(L+R)}:C),!1}),i}function Wt(i,o,u,l){return{type:2,lower:i,upper:o,lowerOpen:u,upperOpen:l}}function Hs(i){return{type:1,lower:i,upper:i}}var zs=(Object.defineProperty(Le.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Le.prototype.between=function(i,o,u,l){u=u!==!1,l=l===!0;try{return 0<this._cmp(i,o)||this._cmp(i,o)===0&&(u||l)&&(!u||!l)?Nr(this):new this.Collection(this,function(){return Wt(i,o,!u,!l)})}catch{return Ge(this,Et)}},Le.prototype.equals=function(i){return i==null?Ge(this,Et):new this.Collection(this,function(){return Hs(i)})},Le.prototype.above=function(i){return i==null?Ge(this,Et):new this.Collection(this,function(){return Wt(i,void 0,!0)})},Le.prototype.aboveOrEqual=function(i){return i==null?Ge(this,Et):new this.Collection(this,function(){return Wt(i,void 0,!1)})},Le.prototype.below=function(i){return i==null?Ge(this,Et):new this.Collection(this,function(){return Wt(void 0,i,!1,!0)})},Le.prototype.belowOrEqual=function(i){return i==null?Ge(this,Et):new this.Collection(this,function(){return Wt(void 0,i)})},Le.prototype.startsWith=function(i){return typeof i!="string"?Ge(this,Ls):this.between(i,i+sr,!0,!0)},Le.prototype.startsWithIgnoreCase=function(i){return i===""?this.startsWith(i):gi(this,function(o,u){return o.indexOf(u[0])===0},[i],sr)},Le.prototype.equalsIgnoreCase=function(i){return gi(this,function(o,u){return o===u[0]},[i],"")},Le.prototype.anyOfIgnoreCase=function(){var i=ne.apply(We,arguments);return i.length===0?Nr(this):gi(this,function(o,u){return u.indexOf(o)!==-1},i,"")},Le.prototype.startsWithAnyOfIgnoreCase=function(){var i=ne.apply(We,arguments);return i.length===0?Nr(this):gi(this,function(o,u){return u.some(function(l){return o.indexOf(l)===0})},i,sr)},Le.prototype.anyOf=function(){var i=this,o=ne.apply(We,arguments),u=this._cmp;try{o.sort(u)}catch{return Ge(this,Et)}if(o.length===0)return Nr(this);var l=new this.Collection(this,function(){return Wt(o[0],o[o.length-1])});l._ondirectionchange=function(p){u=p==="next"?i._ascending:i._descending,o.sort(u)};var h=0;return l._addAlgorithm(function(p,y,b){for(var k=p.key;0<u(k,o[h]);)if(++h===o.length)return y(b),!1;return u(k,o[h])===0||(y(function(){p.continue(o[h])}),!1)}),l},Le.prototype.notEqual=function(i){return this.inAnyRange([[-1/0,i],[i,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Le.prototype.noneOf=function(){var i=ne.apply(We,arguments);if(i.length===0)return new this.Collection(this);try{i.sort(this._ascending)}catch{return Ge(this,Et)}var o=i.reduce(function(u,l){return u?u.concat([[u[u.length-1][1],l]]):[[-1/0,l]]},null);return o.push([i[i.length-1],this.db._maxKey]),this.inAnyRange(o,{includeLowers:!1,includeUppers:!1})},Le.prototype.inAnyRange=function(M,o){var u=this,l=this._cmp,h=this._ascending,p=this._descending,y=this._min,b=this._max;if(M.length===0)return Nr(this);if(!M.every(function(N){return N[0]!==void 0&&N[1]!==void 0&&h(N[0],N[1])<=0}))return Ge(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",te.InvalidArgument);var k=!o||o.includeLowers!==!1,I=o&&o.includeUppers===!0,R,_=h;function T(N,L){return _(N[0],L[0])}try{(R=M.reduce(function(N,L){for(var $=0,K=N.length;$<K;++$){var U=N[$];if(l(L[0],U[1])<0&&0<l(L[1],U[0])){U[0]=y(U[0],L[0]),U[1]=b(U[1],L[1]);break}}return $===K&&N.push(L),N},[])).sort(T)}catch{return Ge(this,Et)}var x=0,D=I?function(N){return 0<h(N,R[x][1])}:function(N){return 0<=h(N,R[x][1])},A=k?function(N){return 0<p(N,R[x][0])}:function(N){return 0<=p(N,R[x][0])},C=D,M=new this.Collection(this,function(){return Wt(R[0][0],R[R.length-1][1],!k,!I)});return M._ondirectionchange=function(N){_=N==="next"?(C=D,h):(C=A,p),R.sort(T)},M._addAlgorithm(function(N,L,$){for(var K,U=N.key;C(U);)if(++x===R.length)return L($),!1;return!D(K=U)&&!A(K)||(u._cmp(U,R[x][1])===0||u._cmp(U,R[x][0])===0||L(function(){_===h?N.continue(R[x][0]):N.continue(R[x][1])}),!1)}),M},Le.prototype.startsWithAnyOf=function(){var i=ne.apply(We,arguments);return i.every(function(o){return typeof o=="string"})?i.length===0?Nr(this):this.inAnyRange(i.map(function(o){return[o,o+sr]})):Ge(this,"startsWithAnyOf() only works with strings")},Le);function Le(){}function mt(i){return ke(function(o){return hn(o),i(o.target.error),!1})}function hn(i){i.stopPropagation&&i.stopPropagation(),i.preventDefault&&i.preventDefault()}var dn="storagemutated",La="x-storagemutated-1",Ut=cn(null,dn),Uf=(vt.prototype._lock=function(){return ee(!Z.global),++this._reculock,this._reculock!==1||Z.global||(Z.lockOwnerFor=this),this},vt.prototype._unlock=function(){if(ee(!Z.global),--this._reculock==0)for(Z.global||(Z.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var i=this._blockedFuncs.shift();try{or(i[1],i[0])}catch{}}return this},vt.prototype._locked=function(){return this._reculock&&Z.lockOwnerFor!==this},vt.prototype.create=function(i){var o=this;if(!this.mode)return this;var u=this.db.idbdb,l=this.db._state.dbOpenError;if(ee(!this.idbtrans),!i&&!u)switch(l&&l.name){case"DatabaseClosedError":throw new te.DatabaseClosed(l);case"MissingAPIError":throw new te.MissingAPI(l.message,l);default:throw new te.OpenFailed(l)}if(!this.active)throw new te.TransactionInactive;return ee(this._completion._state===null),(i=this.idbtrans=i||(this.db.core||u).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=ke(function(h){hn(h),o._reject(i.error)}),i.onabort=ke(function(h){hn(h),o.active&&o._reject(new te.Abort(i.error)),o.active=!1,o.on("abort").fire(h)}),i.oncomplete=ke(function(){o.active=!1,o._resolve(),"mutatedParts"in i&&Ut.storagemutated.fire(i.mutatedParts)}),this},vt.prototype._promise=function(i,o,u){var l=this;if(i==="readwrite"&&this.mode!=="readwrite")return Ce(new te.ReadOnly("Transaction is readonly"));if(!this.active)return Ce(new te.TransactionInactive);if(this._locked())return new Q(function(p,y){l._blockedFuncs.push([function(){l._promise(i,o,u).then(p,y)},Z])});if(u)return Kt(function(){var p=new Q(function(y,b){l._lock();var k=o(y,b,l);k&&k.then&&k.then(y,b)});return p.finally(function(){return l._unlock()}),p._lib=!0,p});var h=new Q(function(p,y){var b=o(p,y,l);b&&b.then&&b.then(p,y)});return h._lib=!0,h},vt.prototype._root=function(){return this.parent?this.parent._root():this},vt.prototype.waitFor=function(i){var o,u=this._root(),l=Q.resolve(i);u._waitingFor?u._waitingFor=u._waitingFor.then(function(){return l}):(u._waitingFor=l,u._waitingQueue=[],o=u.idbtrans.objectStore(u.storeNames[0]),(function p(){for(++u._spinCount;u._waitingQueue.length;)u._waitingQueue.shift()();u._waitingFor&&(o.get(-1/0).onsuccess=p)})());var h=u._waitingFor;return new Q(function(p,y){l.then(function(b){return u._waitingQueue.push(ke(p.bind(null,b)))},function(b){return u._waitingQueue.push(ke(y.bind(null,b)))}).finally(function(){u._waitingFor===h&&(u._waitingFor=null)})})},vt.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new te.Abort))},vt.prototype.table=function(i){var o=this._memoizedTables||(this._memoizedTables={});if(g(o,i))return o[i];var u=this.schema[i];if(!u)throw new te.NotFound("Table "+i+" not part of transaction");return u=new this.db.Table(i,u,this),u.core=this.db.core.table(i),o[i]=u},vt);function vt(){}function Ba(i,o,u,l,h,p,y){return{name:i,keyPath:o,unique:u,multi:l,auto:h,compound:p,src:(u&&!y?"&":"")+(l?"*":"")+(h?"++":"")+Qs(o)}}function Qs(i){return typeof i=="string"?i:i?"["+[].join.call(i,"+")+"]":""}function $a(i,o,u){return{name:i,primKey:o,indexes:u,mappedClass:null,idxByName:(l=function(h){return[h.name,h]},u.reduce(function(h,p,y){return y=l(p,y),y&&(h[y[0]]=y[1]),h},{}))};var l}var pn=function(i){try{return i.only([[]]),pn=function(){return[[]]},[[]]}catch{return pn=function(){return sr},sr}};function ja(i){return i==null?function(){}:typeof i=="string"?(o=i).split(".").length===1?function(u){return u[o]}:function(u){return Y(u,o)}:function(u){return Y(u,i)};var o}function Vs(i){return[].slice.call(i)}var Hf=0;function mn(i){return i==null?":id":typeof i=="string"?i:"[".concat(i.join("+"),"]")}function zf(i,o,k){function l(C){if(C.type===3)return null;if(C.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var x=C.lower,D=C.upper,A=C.lowerOpen,C=C.upperOpen;return x===void 0?D===void 0?null:o.upperBound(D,!!C):D===void 0?o.lowerBound(x,!!A):o.bound(x,D,!!A,!!C)}function h(T){var x,D=T.name;return{name:D,schema:T,mutate:function(A){var C=A.trans,M=A.type,N=A.keys,L=A.values,$=A.range;return new Promise(function(K,U){K=ke(K);var F=C.objectStore(D),q=F.keyPath==null,z=M==="put"||M==="add";if(!z&&M!=="delete"&&M!=="deleteRange")throw new Error("Invalid operation type: "+M);var W,G=(N||L||{length:1}).length;if(N&&L&&N.length!==L.length)throw new Error("Given keys array must have same length as given values array.");if(G===0)return K({numFailures:0,failures:{},results:[],lastResult:void 0});function ae(Ue){++Ye,hn(Ue)}var ce=[],le=[],Ye=0;if(M==="deleteRange"){if($.type===4)return K({numFailures:Ye,failures:le,results:[],lastResult:void 0});$.type===3?ce.push(W=F.clear()):ce.push(W=F.delete(l($)))}else{var q=z?q?[L,N]:[L,null]:[N,null],ie=q[0],Ke=q[1];if(z)for(var Fe=0;Fe<G;++Fe)ce.push(W=Ke&&Ke[Fe]!==void 0?F[M](ie[Fe],Ke[Fe]):F[M](ie[Fe])),W.onerror=ae;else for(Fe=0;Fe<G;++Fe)ce.push(W=F[M](ie[Fe])),W.onerror=ae}function Ri(Ue){Ue=Ue.target.result,ce.forEach(function(fr,no){return fr.error!=null&&(le[no]=fr.error)}),K({numFailures:Ye,failures:le,results:M==="delete"?N:ce.map(function(fr){return fr.result}),lastResult:Ue})}W.onerror=function(Ue){ae(Ue),Ri(Ue)},W.onsuccess=Ri})},getMany:function(A){var C=A.trans,M=A.keys;return new Promise(function(N,L){N=ke(N);for(var $,K=C.objectStore(D),U=M.length,F=new Array(U),q=0,z=0,W=function(ce){ce=ce.target,F[ce._pos]=ce.result,++z===q&&N(F)},G=mt(L),ae=0;ae<U;++ae)M[ae]!=null&&(($=K.get(M[ae]))._pos=ae,$.onsuccess=W,$.onerror=G,++q);q===0&&N(F)})},get:function(A){var C=A.trans,M=A.key;return new Promise(function(N,L){N=ke(N);var $=C.objectStore(D).get(M);$.onsuccess=function(K){return N(K.target.result)},$.onerror=mt(L)})},query:(x=I,function(A){return new Promise(function(C,M){C=ke(C);var N,L,$,q=A.trans,K=A.values,U=A.limit,W=A.query,F=U===1/0?void 0:U,z=W.index,W=W.range,q=q.objectStore(D),z=z.isPrimaryKey?q:q.index(z.name),W=l(W);if(U===0)return C({result:[]});x?((F=K?z.getAll(W,F):z.getAllKeys(W,F)).onsuccess=function(G){return C({result:G.target.result})},F.onerror=mt(M)):(N=0,L=!K&&"openKeyCursor"in z?z.openKeyCursor(W):z.openCursor(W),$=[],L.onsuccess=function(G){var ae=L.result;return ae?($.push(K?ae.value:ae.primaryKey),++N===U?C({result:$}):void ae.continue()):C({result:$})},L.onerror=mt(M))})}),openCursor:function(A){var C=A.trans,M=A.values,N=A.query,L=A.reverse,$=A.unique;return new Promise(function(K,U){K=ke(K);var z=N.index,F=N.range,q=C.objectStore(D),q=z.isPrimaryKey?q:q.index(z.name),z=L?$?"prevunique":"prev":$?"nextunique":"next",W=!M&&"openKeyCursor"in q?q.openKeyCursor(l(F),z):q.openCursor(l(F),z);W.onerror=mt(U),W.onsuccess=ke(function(G){var ae,ce,le,Ye,ie=W.result;ie?(ie.___id=++Hf,ie.done=!1,ae=ie.continue.bind(ie),ce=(ce=ie.continuePrimaryKey)&&ce.bind(ie),le=ie.advance.bind(ie),Ye=function(){throw new Error("Cursor not stopped")},ie.trans=C,ie.stop=ie.continue=ie.continuePrimaryKey=ie.advance=function(){throw new Error("Cursor not started")},ie.fail=ke(U),ie.next=function(){var Ke=this,Fe=1;return this.start(function(){return Fe--?Ke.continue():Ke.stop()}).then(function(){return Ke})},ie.start=function(Ke){function Fe(){if(W.result)try{Ke()}catch(Ue){ie.fail(Ue)}else ie.done=!0,ie.start=function(){throw new Error("Cursor behind last entry")},ie.stop()}var Ri=new Promise(function(Ue,fr){Ue=ke(Ue),W.onerror=mt(fr),ie.fail=fr,ie.stop=function(no){ie.stop=ie.continue=ie.continuePrimaryKey=ie.advance=Ye,Ue(no)}});return W.onsuccess=ke(function(Ue){W.onsuccess=Fe,Fe()}),ie.continue=ae,ie.continuePrimaryKey=ce,ie.advance=le,Fe(),Ri},K(ie)):K(null)},U)})},count:function(A){var C=A.query,M=A.trans,N=C.index,L=C.range;return new Promise(function($,K){var U=M.objectStore(D),F=N.isPrimaryKey?U:U.index(N.name),U=l(L),F=U?F.count(U):F.count();F.onsuccess=ke(function(q){return $(q.target.result)}),F.onerror=mt(K)})}}}var p,y,b,R=(y=k,b=Vs((p=i).objectStoreNames),{schema:{name:p.name,tables:b.map(function(T){return y.objectStore(T)}).map(function(T){var x=T.keyPath,C=T.autoIncrement,D=f(x),A={},C={name:T.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:x==null,compound:D,keyPath:x,autoIncrement:C,unique:!0,extractKey:ja(x)},indexes:Vs(T.indexNames).map(function(M){return T.index(M)}).map(function($){var N=$.name,L=$.unique,K=$.multiEntry,$=$.keyPath,K={name:N,compound:f($),keyPath:$,unique:L,multiEntry:K,extractKey:ja($)};return A[mn($)]=K}),getIndexByKeyPath:function(M){return A[mn(M)]}};return A[":id"]=C.primaryKey,x!=null&&(A[mn(x)]=C.primaryKey),C})},hasGetAll:0<b.length&&"getAll"in y.objectStore(b[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),k=R.schema,I=R.hasGetAll,R=k.tables.map(h),_={};return R.forEach(function(T){return _[T.name]=T}),{stack:"dbcore",transaction:i.transaction.bind(i),table:function(T){if(!_[T])throw new Error("Table '".concat(T,"' not found"));return _[T]},MIN_KEY:-1/0,MAX_KEY:pn(o),schema:k}}function Qf(i,o,u,l){var h=u.IDBKeyRange;return u.indexedDB,{dbcore:(l=zf(o,h,l),i.dbcore.reduce(function(p,y){return y=y.create,n(n({},p),y(p))},l))}}function bi(i,l){var u=l.db,l=Qf(i._middlewares,u,i._deps,l);i.core=l.dbcore,i.tables.forEach(function(h){var p=h.name;i.core.schema.tables.some(function(y){return y.name===p})&&(h.core=i.core.table(p),i[p]instanceof i.Table&&(i[p].core=h.core))})}function wi(i,o,u,l){u.forEach(function(h){var p=l[h];o.forEach(function(y){var b=(function k(I,R){return P(I,R)||(I=v(I))&&k(I,R)})(y,h);(!b||"value"in b&&b.value===void 0)&&(y===i.Transaction.prototype||y instanceof i.Transaction?E(y,h,{get:function(){return this.table(h)},set:function(k){w(this,h,{value:k,writable:!0,configurable:!0,enumerable:!0})}}):y[h]=new i.Table(h,p))})})}function Ka(i,o){o.forEach(function(u){for(var l in u)u[l]instanceof i.Table&&delete u[l]})}function Vf(i,o){return i._cfg.version-o._cfg.version}function Gf(i,o,u,l){var h=i._dbSchema;u.objectStoreNames.contains("$meta")&&!h.$meta&&(h.$meta=$a("$meta",Ys("")[0],[]),i._storeNames.push("$meta"));var p=i._createTransaction("readwrite",i._storeNames,h);p.create(u),p._completion.catch(l);var y=p._reject.bind(p),b=Z.transless||Z;Kt(function(){return Z.trans=p,Z.transless=b,o!==0?(bi(i,u),I=o,((k=p).storeNames.includes("$meta")?k.table("$meta").get("version").then(function(R){return R??I}):Q.resolve(I)).then(function(R){return T=R,x=p,D=u,A=[],R=(_=i)._versions,C=_._dbSchema=Ei(0,_.idbdb,D),(R=R.filter(function(M){return M._cfg.version>=T})).length!==0?(R.forEach(function(M){A.push(function(){var N=C,L=M._cfg.dbschema;Si(_,N,D),Si(_,L,D),C=_._dbSchema=L;var $=Fa(N,L);$.add.forEach(function(z){qa(D,z[0],z[1].primKey,z[1].indexes)}),$.change.forEach(function(z){if(z.recreate)throw new te.Upgrade("Not yet support for changing primary key");var W=D.objectStore(z.name);z.add.forEach(function(G){return _i(W,G)}),z.change.forEach(function(G){W.deleteIndex(G.name),_i(W,G)}),z.del.forEach(function(G){return W.deleteIndex(G)})});var K=M._cfg.contentUpgrade;if(K&&M._cfg.version>T){bi(_,D),x._memoizedTables={};var U=re(L);$.del.forEach(function(z){U[z]=N[z]}),Ka(_,[_.Transaction.prototype]),wi(_,[_.Transaction.prototype],c(U),U),x.schema=U;var F,q=Se(K);return q&&Ar(),$=Q.follow(function(){var z;(F=K(x))&&q&&(z=Ft.bind(null,null),F.then(z,z))}),F&&typeof F.then=="function"?Q.resolve(F):$.then(function(){return F})}}),A.push(function(N){var L,$,K=M._cfg.dbschema;L=K,$=N,[].slice.call($.db.objectStoreNames).forEach(function(U){return L[U]==null&&$.db.deleteObjectStore(U)}),Ka(_,[_.Transaction.prototype]),wi(_,[_.Transaction.prototype],_._storeNames,_._dbSchema),x.schema=_._dbSchema}),A.push(function(N){_.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(_.idbdb.version/10)===M._cfg.version?(_.idbdb.deleteObjectStore("$meta"),delete _._dbSchema.$meta,_._storeNames=_._storeNames.filter(function(L){return L!=="$meta"})):N.objectStore("$meta").put(M._cfg.version,"version"))})}),(function M(){return A.length?Q.resolve(A.shift()(x.idbtrans)).then(M):Q.resolve()})().then(function(){Gs(C,D)})):Q.resolve();var _,T,x,D,A,C}).catch(y)):(c(h).forEach(function(R){qa(u,R,h[R].primKey,h[R].indexes)}),bi(i,u),void Q.follow(function(){return i.on.populate.fire(p)}).catch(y));var k,I})}function Yf(i,o){Gs(i._dbSchema,o),o.db.version%10!=0||o.objectStoreNames.contains("$meta")||o.db.createObjectStore("$meta").add(Math.ceil(o.db.version/10-1),"version");var u=Ei(0,i.idbdb,o);Si(i,i._dbSchema,o);for(var l=0,h=Fa(u,i._dbSchema).change;l<h.length;l++){var p=(function(y){if(y.change.length||y.recreate)return console.warn("Unable to patch indexes of table ".concat(y.name," because it has changes on the type of index or primary key.")),{value:void 0};var b=o.objectStore(y.name);y.add.forEach(function(k){pt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(y.name,".").concat(k.src)),_i(b,k)})})(h[l]);if(typeof p=="object")return p.value}}function Fa(i,o){var u,l={del:[],add:[],change:[]};for(u in i)o[u]||l.del.push(u);for(u in o){var h=i[u],p=o[u];if(h){var y={name:u,def:p,recreate:!1,del:[],add:[],change:[]};if(""+(h.primKey.keyPath||"")!=""+(p.primKey.keyPath||"")||h.primKey.auto!==p.primKey.auto)y.recreate=!0,l.change.push(y);else{var b=h.idxByName,k=p.idxByName,I=void 0;for(I in b)k[I]||y.del.push(I);for(I in k){var R=b[I],_=k[I];R?R.src!==_.src&&y.change.push(_):y.add.push(_)}(0<y.del.length||0<y.add.length||0<y.change.length)&&l.change.push(y)}}else l.add.push([u,p])}return l}function qa(i,o,u,l){var h=i.db.createObjectStore(o,u.keyPath?{keyPath:u.keyPath,autoIncrement:u.auto}:{autoIncrement:u.auto});return l.forEach(function(p){return _i(h,p)}),h}function Gs(i,o){c(i).forEach(function(u){o.db.objectStoreNames.contains(u)||(pt&&console.debug("Dexie: Creating missing table",u),qa(o,u,i[u].primKey,i[u].indexes))})}function _i(i,o){i.createIndex(o.name,o.keyPath,{unique:o.unique,multiEntry:o.multi})}function Ei(i,o,u){var l={};return j(o.objectStoreNames,0).forEach(function(h){for(var p=u.objectStore(h),y=Ba(Qs(I=p.keyPath),I||"",!0,!1,!!p.autoIncrement,I&&typeof I!="string",!0),b=[],k=0;k<p.indexNames.length;++k){var R=p.index(p.indexNames[k]),I=R.keyPath,R=Ba(R.name,I,!!R.unique,!!R.multiEntry,!1,I&&typeof I!="string",!1);b.push(R)}l[h]=$a(h,y,b)}),l}function Si(i,o,u){for(var l=u.db.objectStoreNames,h=0;h<l.length;++h){var p=l[h],y=u.objectStore(p);i._hasGetAll="getAll"in y;for(var b=0;b<y.indexNames.length;++b){var k=y.indexNames[b],I=y.index(k).keyPath,R=typeof I=="string"?I:"["+j(I).join("+")+"]";!o[p]||(I=o[p].idxByName[R])&&(I.name=k,delete o[p].idxByName[R],o[p].idxByName[k]=I)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&s.WorkerGlobalScope&&s instanceof s.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(i._hasGetAll=!1)}function Ys(i){return i.split(",").map(function(o,u){var l=(o=o.trim()).replace(/([&*]|\+\+)/g,""),h=/^\[/.test(l)?l.match(/^\[(.*)\]$/)[1].split("+"):l;return Ba(l,h||null,/\&/.test(o),/\*/.test(o),/\+\+/.test(o),f(h),u===0)})}var Jf=(ki.prototype._parseStoresSpec=function(i,o){c(i).forEach(function(u){if(i[u]!==null){var l=Ys(i[u]),h=l.shift();if(h.unique=!0,h.multi)throw new te.Schema("Primary key cannot be multi-valued");l.forEach(function(p){if(p.auto)throw new te.Schema("Only primary key can be marked as autoIncrement (++)");if(!p.keyPath)throw new te.Schema("Index must have a name and cannot be an empty string")}),o[u]=$a(u,h,l)}})},ki.prototype.stores=function(u){var o=this.db;this._cfg.storesSource=this._cfg.storesSource?d(this._cfg.storesSource,u):u;var u=o._versions,l={},h={};return u.forEach(function(p){d(l,p._cfg.storesSource),h=p._cfg.dbschema={},p._parseStoresSpec(l,h)}),o._dbSchema=h,Ka(o,[o._allTables,o,o.Transaction.prototype]),wi(o,[o._allTables,o,o.Transaction.prototype,this._cfg.tables],c(h),h),o._storeNames=c(h),this},ki.prototype.upgrade=function(i){return this._cfg.contentUpgrade=Ea(this._cfg.contentUpgrade||ve,i),this},ki);function ki(){}function Wa(i,o){var u=i._dbNamesDB;return u||(u=i._dbNamesDB=new kt(pi,{addons:[],indexedDB:i,IDBKeyRange:o})).version(1).stores({dbnames:"name"}),u.table("dbnames")}function Ua(i){return i&&typeof i.databases=="function"}function Ha(i){return Kt(function(){return Z.letThrough=!0,i()})}function za(i){return!("from"in i)}var je=function(i,o){if(!this){var u=new je;return i&&"d"in i&&d(u,i),u}d(this,arguments.length?{d:1,from:i,to:1<arguments.length?o:i}:{d:0})};function vn(i,o,u){var l=de(o,u);if(!isNaN(l)){if(0<l)throw RangeError();if(za(i))return d(i,{from:o,to:u,d:1});var h=i.l,l=i.r;if(de(u,i.from)<0)return h?vn(h,o,u):i.l={from:o,to:u,d:1,l:null,r:null},Xs(i);if(0<de(o,i.to))return l?vn(l,o,u):i.r={from:o,to:u,d:1,l:null,r:null},Xs(i);de(o,i.from)<0&&(i.from=o,i.l=null,i.d=l?l.d+1:1),0<de(u,i.to)&&(i.to=u,i.r=null,i.d=i.l?i.l.d+1:1),u=!i.r,h&&!i.l&&yn(i,h),l&&u&&yn(i,l)}}function yn(i,o){za(o)||(function u(l,k){var p=k.from,y=k.to,b=k.l,k=k.r;vn(l,p,y),b&&u(l,b),k&&u(l,k)})(i,o)}function Js(i,o){var u=xi(o),l=u.next();if(l.done)return!1;for(var h=l.value,p=xi(i),y=p.next(h.from),b=y.value;!l.done&&!y.done;){if(de(b.from,h.to)<=0&&0<=de(b.to,h.from))return!0;de(h.from,b.from)<0?h=(l=u.next(b.from)).value:b=(y=p.next(h.from)).value}return!1}function xi(i){var o=za(i)?null:{s:0,n:i};return{next:function(u){for(var l=0<arguments.length;o;)switch(o.s){case 0:if(o.s=1,l)for(;o.n.l&&de(u,o.n.from)<0;)o={up:o,n:o.n.l,s:1};else for(;o.n.l;)o={up:o,n:o.n.l,s:1};case 1:if(o.s=2,!l||de(u,o.n.to)<=0)return{value:o.n,done:!1};case 2:if(o.n.r){o.s=3,o={up:o,n:o.n.r,s:0};continue}case 3:o=o.up}return{done:!0}}}}function Xs(i){var o,u,l=(((o=i.r)===null||o===void 0?void 0:o.d)||0)-(((u=i.l)===null||u===void 0?void 0:u.d)||0),h=1<l?"r":l<-1?"l":"";h&&(o=h=="r"?"l":"r",u=n({},i),l=i[h],i.from=l.from,i.to=l.to,i[h]=l[h],u[h]=l[o],(i[o]=u).d=Zs(u)),i.d=Zs(i)}function Zs(u){var o=u.r,u=u.l;return(o?u?Math.max(o.d,u.d):o.d:u?u.d:0)+1}function Oi(i,o){return c(o).forEach(function(u){i[u]?yn(i[u],o[u]):i[u]=(function l(h){var p,y,b={};for(p in h)g(h,p)&&(y=h[p],b[p]=!y||typeof y!="object"||Ee.has(y.constructor)?y:l(y));return b})(o[u])}),i}function Qa(i,o){return i.all||o.all||Object.keys(i).some(function(u){return o[u]&&Js(o[u],i[u])})}S(je.prototype,((at={add:function(i){return yn(this,i),this},addKey:function(i){return vn(this,i,i),this},addKeys:function(i){var o=this;return i.forEach(function(u){return vn(o,u,u)}),this},hasKey:function(i){var o=xi(this).next(i).value;return o&&de(o.from,i)<=0&&0<=de(o.to,i)}})[Ve]=function(){return xi(this)},at));var cr={},Va={},Ga=!1;function Ii(i){Oi(Va,i),Ga||(Ga=!0,setTimeout(function(){Ga=!1,Ya(Va,!(Va={}))},0))}function Ya(i,o){o===void 0&&(o=!1);var u=new Set;if(i.all)for(var l=0,h=Object.values(cr);l<h.length;l++)eu(y=h[l],i,u,o);else for(var p in i){var y,b=/^idb\:\/\/(.*)\/(.*)\//.exec(p);b&&(p=b[1],b=b[2],(y=cr["idb://".concat(p,"/").concat(b)])&&eu(y,i,u,o))}u.forEach(function(k){return k()})}function eu(i,o,u,l){for(var h=[],p=0,y=Object.entries(i.queries.query);p<y.length;p++){for(var b=y[p],k=b[0],I=[],R=0,_=b[1];R<_.length;R++){var T=_[R];Qa(o,T.obsSet)?T.subscribers.forEach(function(C){return u.add(C)}):l&&I.push(T)}l&&h.push([k,I])}if(l)for(var x=0,D=h;x<D.length;x++){var A=D[x],k=A[0],I=A[1];i.queries.query[k]=I}}function Xf(i){var o=i._state,u=i._deps.indexedDB;if(o.isBeingOpened||i.idbdb)return o.dbReadyPromise.then(function(){return o.dbOpenError?Ce(o.dbOpenError):i});o.isBeingOpened=!0,o.dbOpenError=null,o.openComplete=!1;var l=o.openCanceller,h=Math.round(10*i.verno),p=!1;function y(){if(o.openCanceller!==l)throw new te.DatabaseClosed("db.open() was cancelled")}function b(){return new Q(function(T,x){if(y(),!u)throw new te.MissingAPI;var D=i.name,A=o.autoSchema||!h?u.open(D):u.open(D,h);if(!A)throw new te.MissingAPI;A.onerror=mt(x),A.onblocked=ke(i._fireOnBlocked),A.onupgradeneeded=ke(function(C){var M;R=A.transaction,o.autoSchema&&!i._options.allowEmptyDB?(A.onerror=hn,R.abort(),A.result.close(),(M=u.deleteDatabase(D)).onsuccess=M.onerror=ke(function(){x(new te.NoSuchDatabase("Database ".concat(D," doesnt exist")))})):(R.onerror=mt(x),C=C.oldVersion>Math.pow(2,62)?0:C.oldVersion,_=C<1,i.idbdb=A.result,p&&Yf(i,R),Gf(i,C/10,R,x))},x),A.onsuccess=ke(function(){R=null;var C,M,N,L,$,K=i.idbdb=A.result,U=j(K.objectStoreNames);if(0<U.length)try{var F=K.transaction((L=U).length===1?L[0]:L,"readonly");if(o.autoSchema)M=K,N=F,(C=i).verno=M.version/10,N=C._dbSchema=Ei(0,M,N),C._storeNames=j(M.objectStoreNames,0),wi(C,[C._allTables],c(N),N);else if(Si(i,i._dbSchema,F),(($=Fa(Ei(0,($=i).idbdb,F),$._dbSchema)).add.length||$.change.some(function(q){return q.add.length||q.change.length}))&&!p)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),K.close(),h=K.version+1,p=!0,T(b());bi(i,F)}catch{}Tr.push(i),K.onversionchange=ke(function(q){o.vcFired=!0,i.on("versionchange").fire(q)}),K.onclose=ke(function(q){i.on("close").fire(q)}),_&&($=i._deps,F=D,K=$.indexedDB,$=$.IDBKeyRange,Ua(K)||F===pi||Wa(K,$).put({name:F}).catch(ve)),T()},x)}).catch(function(T){switch(T?.name){case"UnknownError":if(0<o.PR1398_maxLoop)return o.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),b();break;case"VersionError":if(0<h)return h=0,b()}return Q.reject(T)})}var k,I=o.dbReadyResolve,R=null,_=!1;return Q.race([l,(typeof navigator>"u"?Q.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(T){function x(){return indexedDB.databases().finally(T)}k=setInterval(x,100),x()}).finally(function(){return clearInterval(k)}):Promise.resolve()).then(b)]).then(function(){return y(),o.onReadyBeingFired=[],Q.resolve(Ha(function(){return i.on.ready.fire(i.vip)})).then(function T(){if(0<o.onReadyBeingFired.length){var x=o.onReadyBeingFired.reduce(Ea,ve);return o.onReadyBeingFired=[],Q.resolve(Ha(function(){return x(i.vip)})).then(T)}})}).finally(function(){o.openCanceller===l&&(o.onReadyBeingFired=null,o.isBeingOpened=!1)}).catch(function(T){o.dbOpenError=T;try{R&&R.abort()}catch{}return l===o.openCanceller&&i._close(),Ce(T)}).finally(function(){o.openComplete=!0,I()}).then(function(){var T;return _&&(T={},i.tables.forEach(function(x){x.schema.indexes.forEach(function(D){D.name&&(T["idb://".concat(i.name,"/").concat(x.name,"/").concat(D.name)]=new je(-1/0,[[[]]]))}),T["idb://".concat(i.name,"/").concat(x.name,"/")]=T["idb://".concat(i.name,"/").concat(x.name,"/:dels")]=new je(-1/0,[[[]]])}),Ut(dn).fire(T),Ya(T,!0)),i})}function Ja(i){function o(p){return i.next(p)}var u=h(o),l=h(function(p){return i.throw(p)});function h(p){return function(k){var b=p(k),k=b.value;return b.done?k:k&&typeof k.then=="function"?k.then(u,l):f(k)?Promise.all(k).then(u,l):u(k)}}return h(o)()}function Ci(i,o,u){for(var l=f(i)?i.slice():[i],h=0;h<u;++h)l.push(o);return l}var Zf={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(i){return n(n({},i),{table:function(o){var u=i.table(o),l=u.schema,h={},p=[];function y(_,T,x){var D=mn(_),A=h[D]=h[D]||[],C=_==null?0:typeof _=="string"?1:_.length,M=0<T,M=n(n({},x),{name:M?"".concat(D,"(virtual-from:").concat(x.name,")"):x.name,lowLevelIndex:x,isVirtual:M,keyTail:T,keyLength:C,extractKey:ja(_),unique:!M&&x.unique});return A.push(M),M.isPrimaryKey||p.push(M),1<C&&y(C===2?_[0]:_.slice(0,C-1),T+1,x),A.sort(function(N,L){return N.keyTail-L.keyTail}),M}o=y(l.primaryKey.keyPath,0,l.primaryKey),h[":id"]=[o];for(var b=0,k=l.indexes;b<k.length;b++){var I=k[b];y(I.keyPath,0,I)}function R(_){var T,x=_.query.index;return x.isVirtual?n(n({},_),{query:{index:x.lowLevelIndex,range:(T=_.query.range,x=x.keyTail,{type:T.type===1?2:T.type,lower:Ci(T.lower,T.lowerOpen?i.MAX_KEY:i.MIN_KEY,x),lowerOpen:!0,upper:Ci(T.upper,T.upperOpen?i.MIN_KEY:i.MAX_KEY,x),upperOpen:!0})}}):_}return n(n({},u),{schema:n(n({},l),{primaryKey:o,indexes:p,getIndexByKeyPath:function(_){return(_=h[mn(_)])&&_[0]}}),count:function(_){return u.count(R(_))},query:function(_){return u.query(R(_))},openCursor:function(_){var T=_.query.index,x=T.keyTail,D=T.isVirtual,A=T.keyLength;return D?u.openCursor(R(_)).then(function(M){return M&&C(M)}):u.openCursor(_);function C(M){return Object.create(M,{continue:{value:function(N){N!=null?M.continue(Ci(N,_.reverse?i.MAX_KEY:i.MIN_KEY,x)):_.unique?M.continue(M.key.slice(0,A).concat(_.reverse?i.MIN_KEY:i.MAX_KEY,x)):M.continue()}},continuePrimaryKey:{value:function(N,L){M.continuePrimaryKey(Ci(N,i.MAX_KEY,x),L)}},primaryKey:{get:function(){return M.primaryKey}},key:{get:function(){var N=M.key;return A===1?N[0]:N.slice(0,A)}},value:{get:function(){return M.value}}})}}})}})}};function Xa(i,o,u,l){return u=u||{},l=l||"",c(i).forEach(function(h){var p,y,b;g(o,h)?(p=i[h],y=o[h],typeof p=="object"&&typeof y=="object"&&p&&y?(b=Oe(p))!==Oe(y)?u[l+h]=o[h]:b==="Object"?Xa(p,y,u,l+h+"."):p!==y&&(u[l+h]=o[h]):p!==y&&(u[l+h]=o[h])):u[l+h]=void 0}),c(o).forEach(function(h){g(i,h)||(u[l+h]=o[h])}),u}function Za(i,o){return o.type==="delete"?o.keys:o.keys||o.values.map(i.extractKey)}var eh={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(i){return n(n({},i),{table:function(o){var u=i.table(o),l=u.schema.primaryKey;return n(n({},u),{mutate:function(h){var p=Z.trans,y=p.table(o).hook,b=y.deleting,k=y.creating,I=y.updating;switch(h.type){case"add":if(k.fire===ve)break;return p._promise("readwrite",function(){return R(h)},!0);case"put":if(k.fire===ve&&I.fire===ve)break;return p._promise("readwrite",function(){return R(h)},!0);case"delete":if(b.fire===ve)break;return p._promise("readwrite",function(){return R(h)},!0);case"deleteRange":if(b.fire===ve)break;return p._promise("readwrite",function(){return(function _(T,x,D){return u.query({trans:T,values:!1,query:{index:l,range:x},limit:D}).then(function(A){var C=A.result;return R({type:"delete",keys:C,trans:T}).then(function(M){return 0<M.numFailures?Promise.reject(M.failures[0]):C.length<D?{failures:[],numFailures:0,lastResult:void 0}:_(T,n(n({},x),{lower:C[C.length-1],lowerOpen:!0}),D)})})})(h.trans,h.range,1e4)},!0)}return u.mutate(h);function R(_){var T,x,D,A=Z.trans,C=_.keys||Za(l,_);if(!C)throw new Error("Keys missing");return(_=_.type==="add"||_.type==="put"?n(n({},_),{keys:C}):n({},_)).type!=="delete"&&(_.values=a([],_.values)),_.keys&&(_.keys=a([],_.keys)),T=u,D=C,((x=_).type==="add"?Promise.resolve([]):T.getMany({trans:x.trans,keys:D,cache:"immutable"})).then(function(M){var N=C.map(function(L,$){var K,U,F,q=M[$],z={onerror:null,onsuccess:null};return _.type==="delete"?b.fire.call(z,L,q,A):_.type==="add"||q===void 0?(K=k.fire.call(z,L,_.values[$],A),L==null&&K!=null&&(_.keys[$]=L=K,l.outbound||V(_.values[$],l.keyPath,L))):(K=Xa(q,_.values[$]),(U=I.fire.call(z,K,L,q,A))&&(F=_.values[$],Object.keys(U).forEach(function(W){g(F,W)?F[W]=U[W]:V(F,W,U[W])}))),z});return u.mutate(_).then(function(L){for(var $=L.failures,K=L.results,U=L.numFailures,L=L.lastResult,F=0;F<C.length;++F){var q=(K||C)[F],z=N[F];q==null?z.onerror&&z.onerror($[F]):z.onsuccess&&z.onsuccess(_.type==="put"&&M[F]?_.values[F]:q)}return{failures:$,results:K,numFailures:U,lastResult:L}}).catch(function(L){return N.forEach(function($){return $.onerror&&$.onerror(L)}),Promise.reject(L)})})}}})}})}};function tu(i,o,u){try{if(!o||o.keys.length<i.length)return null;for(var l=[],h=0,p=0;h<o.keys.length&&p<i.length;++h)de(o.keys[h],i[p])===0&&(l.push(u?we(o.values[h]):o.values[h]),++p);return l.length===i.length?l:null}catch{return null}}var th={stack:"dbcore",level:-1,create:function(i){return{table:function(o){var u=i.table(o);return n(n({},u),{getMany:function(l){if(!l.cache)return u.getMany(l);var h=tu(l.keys,l.trans._cache,l.cache==="clone");return h?Q.resolve(h):u.getMany(l).then(function(p){return l.trans._cache={keys:l.keys,values:l.cache==="clone"?we(p):p},p})},mutate:function(l){return l.type!=="add"&&(l.trans._cache=null),u.mutate(l)}})}}}};function ru(i,o){return i.trans.mode==="readonly"&&!!i.subscr&&!i.trans.explicit&&i.trans.db._options.cache!=="disabled"&&!o.schema.primaryKey.outbound}function nu(i,o){switch(i){case"query":return o.values&&!o.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var rh={stack:"dbcore",level:0,name:"Observability",create:function(i){var o=i.schema.name,u=new je(i.MIN_KEY,i.MAX_KEY);return n(n({},i),{transaction:function(l,h,p){if(Z.subscr&&h!=="readonly")throw new te.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Z.querier));return i.transaction(l,h,p)},table:function(l){var h=i.table(l),p=h.schema,y=p.primaryKey,_=p.indexes,b=y.extractKey,k=y.outbound,I=y.autoIncrement&&_.filter(function(x){return x.compound&&x.keyPath.includes(y.keyPath)}),R=n(n({},h),{mutate:function(x){function D(W){return W="idb://".concat(o,"/").concat(l,"/").concat(W),L[W]||(L[W]=new je)}var A,C,M,N=x.trans,L=x.mutatedParts||(x.mutatedParts={}),$=D(""),K=D(":dels"),U=x.type,z=x.type==="deleteRange"?[x.range]:x.type==="delete"?[x.keys]:x.values.length<50?[Za(y,x).filter(function(W){return W}),x.values]:[],F=z[0],q=z[1],z=x.trans._cache;return f(F)?($.addKeys(F),(z=U==="delete"||F.length===q.length?tu(F,z):null)||K.addKeys(F),(z||q)&&(A=D,C=z,M=q,p.indexes.forEach(function(W){var G=A(W.name||"");function ae(le){return le!=null?W.extractKey(le):null}function ce(le){return W.multiEntry&&f(le)?le.forEach(function(Ye){return G.addKey(Ye)}):G.addKey(le)}(C||M).forEach(function(le,Ke){var ie=C&&ae(C[Ke]),Ke=M&&ae(M[Ke]);de(ie,Ke)!==0&&(ie!=null&&ce(ie),Ke!=null&&ce(Ke))})}))):F?(q={from:(q=F.lower)!==null&&q!==void 0?q:i.MIN_KEY,to:(q=F.upper)!==null&&q!==void 0?q:i.MAX_KEY},K.add(q),$.add(q)):($.add(u),K.add(u),p.indexes.forEach(function(W){return D(W.name).add(u)})),h.mutate(x).then(function(W){return!F||x.type!=="add"&&x.type!=="put"||($.addKeys(W.results),I&&I.forEach(function(G){for(var ae=x.values.map(function(ie){return G.extractKey(ie)}),ce=G.keyPath.findIndex(function(ie){return ie===y.keyPath}),le=0,Ye=W.results.length;le<Ye;++le)ae[le][ce]=W.results[le];D(G.name).addKeys(ae)})),N.mutatedParts=Oi(N.mutatedParts||{},L),W})}}),_=function(D){var A=D.query,D=A.index,A=A.range;return[D,new je((D=A.lower)!==null&&D!==void 0?D:i.MIN_KEY,(A=A.upper)!==null&&A!==void 0?A:i.MAX_KEY)]},T={get:function(x){return[y,new je(x.key)]},getMany:function(x){return[y,new je().addKeys(x.keys)]},count:_,query:_,openCursor:_};return c(T).forEach(function(x){R[x]=function(D){var A=Z.subscr,C=!!A,M=ru(Z,h)&&nu(x,D)?D.obsSet={}:A;if(C){var N=function(q){return q="idb://".concat(o,"/").concat(l,"/").concat(q),M[q]||(M[q]=new je)},L=N(""),$=N(":dels"),A=T[x](D),C=A[0],A=A[1];if((x==="query"&&C.isPrimaryKey&&!D.values?$:N(C.name||"")).add(A),!C.isPrimaryKey){if(x!=="count"){var K=x==="query"&&k&&D.values&&h.query(n(n({},D),{values:!1}));return h[x].apply(this,arguments).then(function(q){if(x==="query"){if(k&&D.values)return K.then(function(ae){return ae=ae.result,L.addKeys(ae),q});var z=D.values?q.result.map(b):q.result;(D.values?L:$).addKeys(z)}else if(x==="openCursor"){var W=q,G=D.values;return W&&Object.create(W,{key:{get:function(){return $.addKey(W.primaryKey),W.key}},primaryKey:{get:function(){var ae=W.primaryKey;return $.addKey(ae),ae}},value:{get:function(){return G&&L.addKey(W.primaryKey),W.value}}})}return q})}$.add(u)}}return h[x].apply(this,arguments)}}),R}})}};function iu(i,o,u){if(u.numFailures===0)return o;if(o.type==="deleteRange")return null;var l=o.keys?o.keys.length:"values"in o&&o.values?o.values.length:1;return u.numFailures===l?null:(o=n({},o),f(o.keys)&&(o.keys=o.keys.filter(function(h,p){return!(p in u.failures)})),"values"in o&&f(o.values)&&(o.values=o.values.filter(function(h,p){return!(p in u.failures)})),o)}function eo(i,o){return u=i,((l=o).lower===void 0||(l.lowerOpen?0<de(u,l.lower):0<=de(u,l.lower)))&&(i=i,(o=o).upper===void 0||(o.upperOpen?de(i,o.upper)<0:de(i,o.upper)<=0));var u,l}function au(i,o,T,l,h,p){if(!T||T.length===0)return i;var y=o.query.index,b=y.multiEntry,k=o.query.range,I=l.schema.primaryKey.extractKey,R=y.extractKey,_=(y.lowLevelIndex||y).extractKey,T=T.reduce(function(x,D){var A=x,C=[];if(D.type==="add"||D.type==="put")for(var M=new je,N=D.values.length-1;0<=N;--N){var L,$=D.values[N],K=I($);M.hasKey(K)||(L=R($),(b&&f(L)?L.some(function(W){return eo(W,k)}):eo(L,k))&&(M.addKey(K),C.push($)))}switch(D.type){case"add":var U=new je().addKeys(o.values?x.map(function(G){return I(G)}):x),A=x.concat(o.values?C.filter(function(G){return G=I(G),!U.hasKey(G)&&(U.addKey(G),!0)}):C.map(function(G){return I(G)}).filter(function(G){return!U.hasKey(G)&&(U.addKey(G),!0)}));break;case"put":var F=new je().addKeys(D.values.map(function(G){return I(G)}));A=x.filter(function(G){return!F.hasKey(o.values?I(G):G)}).concat(o.values?C:C.map(function(G){return I(G)}));break;case"delete":var q=new je().addKeys(D.keys);A=x.filter(function(G){return!q.hasKey(o.values?I(G):G)});break;case"deleteRange":var z=D.range;A=x.filter(function(G){return!eo(I(G),z)})}return A},i);return T===i?i:(T.sort(function(x,D){return de(_(x),_(D))||de(I(x),I(D))}),o.limit&&o.limit<1/0&&(T.length>o.limit?T.length=o.limit:i.length===o.limit&&T.length<o.limit&&(h.dirty=!0)),p?Object.freeze(T):T)}function ou(i,o){return de(i.lower,o.lower)===0&&de(i.upper,o.upper)===0&&!!i.lowerOpen==!!o.lowerOpen&&!!i.upperOpen==!!o.upperOpen}function nh(i,o){return(function(u,l,h,p){if(u===void 0)return l!==void 0?-1:0;if(l===void 0)return 1;if((l=de(u,l))===0){if(h&&p)return 0;if(h)return 1;if(p)return-1}return l})(i.lower,o.lower,i.lowerOpen,o.lowerOpen)<=0&&0<=(function(u,l,h,p){if(u===void 0)return l!==void 0?1:0;if(l===void 0)return-1;if((l=de(u,l))===0){if(h&&p)return 0;if(h)return-1;if(p)return 1}return l})(i.upper,o.upper,i.upperOpen,o.upperOpen)}function ih(i,o,u,l){i.subscribers.add(u),l.addEventListener("abort",function(){var h,p;i.subscribers.delete(u),i.subscribers.size===0&&(h=i,p=o,setTimeout(function(){h.subscribers.size===0&&Ie(p,h)},3e3))})}var ah={stack:"dbcore",level:0,name:"Cache",create:function(i){var o=i.schema.name;return n(n({},i),{transaction:function(u,l,h){var p,y,b=i.transaction(u,l,h);return l==="readwrite"&&(y=(p=new AbortController).signal,h=function(k){return function(){if(p.abort(),l==="readwrite"){for(var I=new Set,R=0,_=u;R<_.length;R++){var T=_[R],x=cr["idb://".concat(o,"/").concat(T)];if(x){var D=i.table(T),A=x.optimisticOps.filter(function(G){return G.trans===b});if(b._explicit&&k&&b.mutatedParts)for(var C=0,M=Object.values(x.queries.query);C<M.length;C++)for(var N=0,L=(U=M[C]).slice();N<L.length;N++)Qa((F=L[N]).obsSet,b.mutatedParts)&&(Ie(U,F),F.subscribers.forEach(function(G){return I.add(G)}));else if(0<A.length){x.optimisticOps=x.optimisticOps.filter(function(G){return G.trans!==b});for(var $=0,K=Object.values(x.queries.query);$<K.length;$++)for(var U,F,q,z=0,W=(U=K[$]).slice();z<W.length;z++)(F=W[z]).res!=null&&b.mutatedParts&&(k&&!F.dirty?(q=Object.isFrozen(F.res),q=au(F.res,F.req,A,D,F,q),F.dirty?(Ie(U,F),F.subscribers.forEach(function(G){return I.add(G)})):q!==F.res&&(F.res=q,F.promise=Q.resolve({result:q}))):(F.dirty&&Ie(U,F),F.subscribers.forEach(function(G){return I.add(G)})))}}}I.forEach(function(G){return G()})}}},b.addEventListener("abort",h(!1),{signal:y}),b.addEventListener("error",h(!1),{signal:y}),b.addEventListener("complete",h(!0),{signal:y})),b},table:function(u){var l=i.table(u),h=l.schema.primaryKey;return n(n({},l),{mutate:function(p){var y=Z.trans;if(h.outbound||y.db._options.cache==="disabled"||y.explicit||y.idbtrans.mode!=="readwrite")return l.mutate(p);var b=cr["idb://".concat(o,"/").concat(u)];return b?(y=l.mutate(p),p.type!=="add"&&p.type!=="put"||!(50<=p.values.length||Za(h,p).some(function(k){return k==null}))?(b.optimisticOps.push(p),p.mutatedParts&&Ii(p.mutatedParts),y.then(function(k){0<k.numFailures&&(Ie(b.optimisticOps,p),(k=iu(0,p,k))&&b.optimisticOps.push(k),p.mutatedParts&&Ii(p.mutatedParts))}),y.catch(function(){Ie(b.optimisticOps,p),p.mutatedParts&&Ii(p.mutatedParts)})):y.then(function(k){var I=iu(0,n(n({},p),{values:p.values.map(function(R,_){var T;return k.failures[_]?R:(R=(T=h.keyPath)!==null&&T!==void 0&&T.includes(".")?we(R):n({},R),V(R,h.keyPath,k.results[_]),R)})}),k);b.optimisticOps.push(I),queueMicrotask(function(){return p.mutatedParts&&Ii(p.mutatedParts)})}),y):l.mutate(p)},query:function(p){if(!ru(Z,l)||!nu("query",p))return l.query(p);var y=((I=Z.trans)===null||I===void 0?void 0:I.db._options.cache)==="immutable",_=Z,b=_.requery,k=_.signal,I=(function(D,A,C,M){var N=cr["idb://".concat(D,"/").concat(A)];if(!N)return[];if(!(A=N.queries[C]))return[null,!1,N,null];var L=A[(M.query?M.query.index.name:null)||""];if(!L)return[null,!1,N,null];switch(C){case"query":var $=L.find(function(K){return K.req.limit===M.limit&&K.req.values===M.values&&ou(K.req.query.range,M.query.range)});return $?[$,!0,N,L]:[L.find(function(K){return("limit"in K.req?K.req.limit:1/0)>=M.limit&&(!M.values||K.req.values)&&nh(K.req.query.range,M.query.range)}),!1,N,L];case"count":return $=L.find(function(K){return ou(K.req.query.range,M.query.range)}),[$,!!$,N,L]}})(o,u,"query",p),R=I[0],_=I[1],T=I[2],x=I[3];return R&&_?R.obsSet=p.obsSet:(_=l.query(p).then(function(D){var A=D.result;if(R&&(R.res=A),y){for(var C=0,M=A.length;C<M;++C)Object.freeze(A[C]);Object.freeze(A)}else D.result=we(A);return D}).catch(function(D){return x&&R&&Ie(x,R),Promise.reject(D)}),R={obsSet:p.obsSet,promise:_,subscribers:new Set,type:"query",req:p,dirty:!1},x?x.push(R):(x=[R],(T=T||(cr["idb://".concat(o,"/").concat(u)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[p.query.index.name||""]=x)),ih(R,x,b,k),R.promise.then(function(D){return{result:au(D.result,p,T?.optimisticOps,l,R,y)}})}})}})}};function Pi(i,o){return new Proxy(i,{get:function(u,l,h){return l==="db"?o:Reflect.get(u,l,h)}})}var kt=(Pe.prototype.version=function(i){if(isNaN(i)||i<.1)throw new te.Type("Given version is not a positive number");if(i=Math.round(10*i)/10,this.idbdb||this._state.isBeingOpened)throw new te.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,i);var o=this._versions,u=o.filter(function(l){return l._cfg.version===i})[0];return u||(u=new this.Version(i),o.push(u),o.sort(Vf),u.stores({}),this._state.autoSchema=!1,u)},Pe.prototype._whenReady=function(i){var o=this;return this.idbdb&&(this._state.openComplete||Z.letThrough||this._vip)?i():new Q(function(u,l){if(o._state.openComplete)return l(new te.DatabaseClosed(o._state.dbOpenError));if(!o._state.isBeingOpened){if(!o._state.autoOpen)return void l(new te.DatabaseClosed);o.open().catch(ve)}o._state.dbReadyPromise.then(u,l)}).then(i)},Pe.prototype.use=function(i){var o=i.stack,u=i.create,l=i.level,h=i.name;return h&&this.unuse({stack:o,name:h}),i=this._middlewares[o]||(this._middlewares[o]=[]),i.push({stack:o,create:u,level:l??10,name:h}),i.sort(function(p,y){return p.level-y.level}),this},Pe.prototype.unuse=function(i){var o=i.stack,u=i.name,l=i.create;return o&&this._middlewares[o]&&(this._middlewares[o]=this._middlewares[o].filter(function(h){return l?h.create!==l:!!u&&h.name!==u})),this},Pe.prototype.open=function(){var i=this;return or(jt,function(){return Xf(i)})},Pe.prototype._close=function(){var i=this._state,o=Tr.indexOf(this);if(0<=o&&Tr.splice(o,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}i.isBeingOpened||(i.dbReadyPromise=new Q(function(u){i.dbReadyResolve=u}),i.openCanceller=new Q(function(u,l){i.cancelOpen=l}))},Pe.prototype.close=function(u){var o=(u===void 0?{disableAutoOpen:!0}:u).disableAutoOpen,u=this._state;o?(u.isBeingOpened&&u.cancelOpen(new te.DatabaseClosed),this._close(),u.autoOpen=!1,u.dbOpenError=new te.DatabaseClosed):(this._close(),u.autoOpen=this._options.autoOpen||u.isBeingOpened,u.openComplete=!1,u.dbOpenError=null)},Pe.prototype.delete=function(i){var o=this;i===void 0&&(i={disableAutoOpen:!0});var u=0<arguments.length&&typeof arguments[0]!="object",l=this._state;return new Q(function(h,p){function y(){o.close(i);var b=o._deps.indexedDB.deleteDatabase(o.name);b.onsuccess=ke(function(){var k,I,R;k=o._deps,I=o.name,R=k.indexedDB,k=k.IDBKeyRange,Ua(R)||I===pi||Wa(R,k).delete(I).catch(ve),h()}),b.onerror=mt(p),b.onblocked=o._fireOnBlocked}if(u)throw new te.InvalidArgument("Invalid closeOptions argument to db.delete()");l.isBeingOpened?l.dbReadyPromise.then(y):y()})},Pe.prototype.backendDB=function(){return this.idbdb},Pe.prototype.isOpen=function(){return this.idbdb!==null},Pe.prototype.hasBeenClosed=function(){var i=this._state.dbOpenError;return i&&i.name==="DatabaseClosed"},Pe.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Pe.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Pe.prototype,"tables",{get:function(){var i=this;return c(this._allTables).map(function(o){return i._allTables[o]})},enumerable:!1,configurable:!0}),Pe.prototype.transaction=function(){var i=(function(o,u,l){var h=arguments.length;if(h<2)throw new te.InvalidArgument("Too few arguments");for(var p=new Array(h-1);--h;)p[h-1]=arguments[h];return l=p.pop(),[o,fe(p),l]}).apply(this,arguments);return this._transaction.apply(this,i)},Pe.prototype._transaction=function(i,o,u){var l=this,h=Z.trans;h&&h.db===this&&i.indexOf("!")===-1||(h=null);var p,y,b=i.indexOf("?")!==-1;i=i.replace("!","").replace("?","");try{if(y=o.map(function(I){if(I=I instanceof l.Table?I.name:I,typeof I!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return I}),i=="r"||i===Ra)p=Ra;else{if(i!="rw"&&i!=Aa)throw new te.InvalidArgument("Invalid transaction mode: "+i);p=Aa}if(h){if(h.mode===Ra&&p===Aa){if(!b)throw new te.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");h=null}h&&y.forEach(function(I){if(h&&h.storeNames.indexOf(I)===-1){if(!b)throw new te.SubTransaction("Table "+I+" not included in parent transaction.");h=null}}),b&&h&&!h.active&&(h=null)}}catch(I){return h?h._promise(null,function(R,_){_(I)}):Ce(I)}var k=(function I(R,_,T,x,D){return Q.resolve().then(function(){var A=Z.transless||Z,C=R._createTransaction(_,T,R._dbSchema,x);if(C.explicit=!0,A={trans:C,transless:A},x)C.idbtrans=x.idbtrans;else try{C.create(),C.idbtrans._explicit=!0,R._state.PR1398_maxLoop=3}catch(L){return L.name===_a.InvalidState&&R.isOpen()&&0<--R._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),R.close({disableAutoOpen:!1}),R.open().then(function(){return I(R,_,T,null,D)})):Ce(L)}var M,N=Se(D);return N&&Ar(),A=Q.follow(function(){var L;(M=D.call(C,C))&&(N?(L=Ft.bind(null,null),M.then(L,L)):typeof M.next=="function"&&typeof M.throw=="function"&&(M=Ja(M)))},A),(M&&typeof M.then=="function"?Q.resolve(M).then(function(L){return C.active?L:Ce(new te.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):A.then(function(){return M})).then(function(L){return x&&C._resolve(),C._completion.then(function(){return L})}).catch(function(L){return C._reject(L),Ce(L)})})}).bind(null,this,p,y,h,u);return h?h._promise(p,k,"lock"):Z.trans?or(Z.transless,function(){return l._whenReady(k)}):this._whenReady(k)},Pe.prototype.table=function(i){if(!g(this._allTables,i))throw new te.InvalidTable("Table ".concat(i," does not exist"));return this._allTables[i]},Pe);function Pe(i,o){var u=this;this._middlewares={},this.verno=0;var l=Pe.dependencies;this._options=o=n({addons:Pe.addons,autoOpen:!0,indexedDB:l.indexedDB,IDBKeyRange:l.IDBKeyRange,cache:"cloned"},o),this._deps={indexedDB:o.indexedDB,IDBKeyRange:o.IDBKeyRange},l=o.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var h,p,y,b,k,I={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ve,dbReadyPromise:null,cancelOpen:ve,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:o.autoOpen};I.dbReadyPromise=new Q(function(_){I.dbReadyResolve=_}),I.openCanceller=new Q(function(_,T){I.cancelOpen=T}),this._state=I,this.name=i,this.on=cn(this,"populate","blocked","versionchange","close",{ready:[Ea,ve]}),this.on.ready.subscribe=H(this.on.ready.subscribe,function(_){return function(T,x){Pe.vip(function(){var D,A=u._state;A.openComplete?(A.dbOpenError||Q.resolve().then(T),x&&_(T)):A.onReadyBeingFired?(A.onReadyBeingFired.push(T),x&&_(T)):(_(T),D=u,x||_(function C(){D.on.ready.unsubscribe(T),D.on.ready.unsubscribe(C)}))})}}),this.Collection=(h=this,ln(Ff.prototype,function(M,C){this.db=h;var x=Bs,D=null;if(C)try{x=C()}catch(N){D=N}var A=M._ctx,C=A.table,M=C.hook.reading.fire;this._ctx={table:C,index:A.index,isPrimKey:!A.index||C.schema.primKey.keyPath&&A.index===C.schema.primKey.name,range:x,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:D,or:A.or,valueMapper:M!==nn?M:null}})),this.Table=(p=this,ln(Fs.prototype,function(_,T,x){this.db=p,this._tx=x,this.name=_,this.schema=T,this.hook=p._allTables[_]?p._allTables[_].hook:cn(null,{creating:[Af,ve],reading:[Rf,nn],updating:[Mf,ve],deleting:[Tf,ve]})})),this.Transaction=(y=this,ln(Uf.prototype,function(_,T,x,D,A){var C=this;this.db=y,this.mode=_,this.storeNames=T,this.schema=x,this.chromeTransactionDurability=D,this.idbtrans=null,this.on=cn(this,"complete","error","abort"),this.parent=A||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Q(function(M,N){C._resolve=M,C._reject=N}),this._completion.then(function(){C.active=!1,C.on.complete.fire()},function(M){var N=C.active;return C.active=!1,C.on.error.fire(M),C.parent?C.parent._reject(M):N&&C.idbtrans&&C.idbtrans.abort(),Ce(M)})})),this.Version=(b=this,ln(Jf.prototype,function(_){this.db=b,this._cfg={version:_,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(k=this,ln(zs.prototype,function(_,T,x){if(this.db=k,this._ctx={table:_,index:T===":id"?null:T,or:x},this._cmp=this._ascending=de,this._descending=function(D,A){return de(A,D)},this._max=function(D,A){return 0<de(D,A)?D:A},this._min=function(D,A){return de(D,A)<0?D:A},this._IDBKeyRange=k._deps.IDBKeyRange,!this._IDBKeyRange)throw new te.MissingAPI})),this.on("versionchange",function(_){0<_.newVersion?console.warn("Another connection wants to upgrade database '".concat(u.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(u.name,"'. Closing db now to resume the delete request.")),u.close({disableAutoOpen:!1})}),this.on("blocked",function(_){!_.newVersion||_.newVersion<_.oldVersion?console.warn("Dexie.delete('".concat(u.name,"') was blocked")):console.warn("Upgrade '".concat(u.name,"' blocked by other connection holding version ").concat(_.oldVersion/10))}),this._maxKey=pn(o.IDBKeyRange),this._createTransaction=function(_,T,x,D){return new u.Transaction(_,T,x,u._options.chromeTransactionDurability,D)},this._fireOnBlocked=function(_){u.on("blocked").fire(_),Tr.filter(function(T){return T.name===u.name&&T!==u&&!T._state.vcFired}).map(function(T){return T.on("versionchange").fire(_)})},this.use(th),this.use(ah),this.use(rh),this.use(Zf),this.use(eh);var R=new Proxy(this,{get:function(_,T,x){if(T==="_vip")return!0;if(T==="table")return function(A){return Pi(u.table(A),R)};var D=Reflect.get(_,T,x);return D instanceof Fs?Pi(D,R):T==="tables"?D.map(function(A){return Pi(A,R)}):T==="_createTransaction"?function(){return Pi(D.apply(this,arguments),R)}:D}});this.vip=R,l.forEach(function(_){return _(u)})}var Di,at=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",oh=(to.prototype.subscribe=function(i,o,u){return this._subscribe(i&&typeof i!="function"?i:{next:i,error:o,complete:u})},to.prototype[at]=function(){return this},to);function to(i){this._subscribe=i}try{Di={indexedDB:s.indexedDB||s.mozIndexedDB||s.webkitIndexedDB||s.msIndexedDB,IDBKeyRange:s.IDBKeyRange||s.webkitIDBKeyRange}}catch{Di={indexedDB:null,IDBKeyRange:null}}function su(i){var o,u=!1,l=new oh(function(h){var p=Se(i),y,b=!1,k={},I={},R={get closed(){return b},unsubscribe:function(){b||(b=!0,y&&y.abort(),_&&Ut.storagemutated.unsubscribe(x))}};h.start&&h.start(R);var _=!1,T=function(){return Da(D)},x=function(A){Oi(k,A),Qa(I,k)&&T()},D=function(){var A,C,M;!b&&Di.indexedDB&&(k={},A={},y&&y.abort(),y=new AbortController,M=(function(N){var L=Dr();try{p&&Ar();var $=Kt(i,N);return $=p?$.finally(Ft):$}finally{L&&Rr()}})(C={subscr:A,signal:y.signal,requery:T,querier:i,trans:null}),Promise.resolve(M).then(function(N){u=!0,o=N,b||C.signal.aborted||(k={},(function(L){for(var $ in L)if(g(L,$))return;return 1})(I=A)||_||(Ut(dn,x),_=!0),Da(function(){return!b&&h.next&&h.next(N)}))},function(N){u=!1,["DatabaseClosedError","AbortError"].includes(N?.name)||b||Da(function(){b||h.error&&h.error(N)})}))};return setTimeout(T,0),R});return l.hasValue=function(){return u},l.getValue=function(){return o},l}var lr=kt;function ro(i){var o=Ht;try{Ht=!0,Ut.storagemutated.fire(i),Ya(i,!0)}finally{Ht=o}}S(lr,n(n({},ai),{delete:function(i){return new lr(i,{addons:[]}).delete()},exists:function(i){return new lr(i,{addons:[]}).open().then(function(o){return o.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(i){try{return o=lr.dependencies,u=o.indexedDB,o=o.IDBKeyRange,(Ua(u)?Promise.resolve(u.databases()).then(function(l){return l.map(function(h){return h.name}).filter(function(h){return h!==pi})}):Wa(u,o).toCollection().primaryKeys()).then(i)}catch{return Ce(new te.MissingAPI)}var o,u},defineClass:function(){return function(i){d(this,i)}},ignoreTransaction:function(i){return Z.trans?or(Z.transless,i):i()},vip:Ha,async:function(i){return function(){try{var o=Ja(i.apply(this,arguments));return o&&typeof o.then=="function"?o:Q.resolve(o)}catch(u){return Ce(u)}}},spawn:function(i,o,u){try{var l=Ja(i.apply(u,o||[]));return l&&typeof l.then=="function"?l:Q.resolve(l)}catch(h){return Ce(h)}},currentTransaction:{get:function(){return Z.trans||null}},waitFor:function(i,o){return o=Q.resolve(typeof i=="function"?lr.ignoreTransaction(i):i).timeout(o||6e4),Z.trans?Z.trans.waitFor(o):o},Promise:Q,debug:{get:function(){return pt},set:function(i){Ds(i)}},derive:O,extend:d,props:S,override:H,Events:cn,on:Ut,liveQuery:su,extendObservabilitySet:Oi,getByKeyPath:Y,setByKeyPath:V,delByKeyPath:function(i,o){typeof o=="string"?V(i,o,void 0):"length"in o&&[].map.call(o,function(u){V(i,u,void 0)})},shallowClone:re,deepClone:we,getObjectDiff:Xa,cmp:de,asap:X,minKey:-1/0,addons:[],connections:Tr,errnames:_a,dependencies:Di,cache:cr,semVer:"4.0.10",version:"4.0.10".split(".").map(function(i){return parseInt(i)}).reduce(function(i,o,u){return i+o/Math.pow(10,2*u)})})),lr.maxKey=pn(lr.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Ut(dn,function(i){Ht||(i=new CustomEvent(La,{detail:i}),Ht=!0,dispatchEvent(i),Ht=!1)}),addEventListener(La,function(i){i=i.detail,Ht||ro(i)}));var Lr,Ht=!1,uu=function(){};return typeof BroadcastChannel<"u"&&((uu=function(){(Lr=new BroadcastChannel(La)).onmessage=function(i){return i.data&&ro(i.data)}})(),typeof Lr.unref=="function"&&Lr.unref(),Ut(dn,function(i){Ht||Lr.postMessage(i)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(i){if(!kt.disableBfCache&&i.persisted){pt&&console.debug("Dexie: handling persisted pagehide"),Lr?.close();for(var o=0,u=Tr;o<u.length;o++)u[o].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(i){!kt.disableBfCache&&i.persisted&&(pt&&console.debug("Dexie: handling persisted pageshow"),uu(),ro({all:new je(-1/0,[[]])}))})),Q.rejectionMapper=function(i,o){return!i||i instanceof he||i instanceof TypeError||i instanceof SyntaxError||!i.name||!Ps[i.name]?i:(o=new Ps[i.name](o||i.message,i),"stack"in i&&E(o,"stack",{get:function(){return this.inner.stack}}),o)},Ds(pt),n(kt,Object.freeze({__proto__:null,Dexie:kt,liveQuery:su,Entity:$s,cmp:de,PropModSymbol:St,PropModification:fn,replacePrefix:function(i,o){return new fn({replacePrefix:[i,o]})},add:function(i){return new fn({add:i})},remove:function(i){return new fn({remove:i})},default:kt,RangeSet:je,mergeRanges:yn,rangesOverlap:Js}),{default:kt}),kt})})(Ui)),Ui.exports}var Wb=qb();const Xo=Kb(Wb),lc=Symbol.for("Dexie"),sa=globalThis[lc]||(globalThis[lc]=Xo);if(Xo.semVer!==sa.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Xo.semVer} and ${sa.semVer}`);const{liveQuery:xw,mergeRanges:Ow,rangesOverlap:Iw,RangeSet:Cw,cmp:Pw,Entity:Dw,PropModSymbol:Rw,PropModification:Aw,replacePrefix:Tw,add:Mw,remove:Nw}=sa;var ua="docs",Ub="changes",fc="attachments",Sf="dexie",hc=new Map,Hi=new Map;function Hb(e,t,r,n){var a="rxdb-dexie-"+e+"--"+n.version+"--"+t,s=ht(hc,a,()=>{var c=(async()=>{var f=xe(r);f.autoOpen=!1;var d=new sa(a,f);r.onCreate&&await r.onCreate(d,a);var v={[ua]:Vb(n),[Ub]:"++sequence, id",[fc]:"id"};return d.version(1).stores(v),await d.open(),{dexieDb:d,dexieTable:d[ua],dexieAttachmentsTable:d[fc],booleanIndexes:Gb(n)}})();return hc.set(a,s),Hi.set(s,0),c});return s}async function zb(e){var t=await e,r=Hi.get(e),n=r-1;n===0?(t.dexieDb.close(),Hi.delete(e)):Hi.set(e,n)}var Zo="__";function rn(e){var t=e.split(".");if(t.length>1)return t.map(n=>rn(n)).join(".");if(e.startsWith("|")){var r=e.substring(1);return Zo+r}else return e}function kf(e){var t=e.split(".");if(t.length>1)return t.map(n=>kf(n)).join(".");if(e.startsWith(Zo)){var r=e.substring(Zo.length);return"|"+r}else return e}function Qb(e,t){if(!t)return t;var r=xe(t);return r=es(r),e.forEach(n=>{var a=Zt(t,n),s=a?"1":"0",c=rn(n);Kc(r,c,s)}),r}function xf(e,t){return t&&(t=xe(t),t=ts(t),e.forEach(r=>{var n=Zt(t,r),a=n==="1";Kc(t,r,a)}),t)}function es(e){if(!e||typeof e=="string"||typeof e=="number"||typeof e=="boolean")return e;if(Array.isArray(e))return e.map(r=>es(r));if(typeof e=="object"){var t={};return Object.entries(e).forEach(([r,n])=>{typeof n=="object"&&(n=es(n)),t[rn(r)]=n}),t}}function ts(e){if(!e||typeof e=="string"||typeof e=="number"||typeof e=="boolean")return e;if(Array.isArray(e))return e.map(r=>ts(r));if(typeof e=="object"){var t={};return Object.entries(e).forEach(([r,n])=>{(typeof n=="object"||Array.isArray(e))&&(n=ts(n)),t[kf(r)]=n}),t}}function Vb(e){var t=[],r=tt(e.primaryKey);t.push([r]),t.push(["_deleted",r]),e.indexes&&e.indexes.forEach(s=>{var c=ns(s);t.push(c)}),t.push(["_meta.lwt",r]),t.push(["_meta.lwt"]),t=t.map(s=>s.map(c=>rn(c)));var n=t.map(s=>s.length===1?s[0]:"["+s.join("+")+"]");n=n.filter((s,c,f)=>f.indexOf(s)===c);var a=n.join(", ");return a}async function dc(e,t){var r=await e,n=await r.dexieTable.bulkGet(t);return n.map(a=>xf(r.booleanIndexes,a))}function Li(e,t){return e+"||"+t}function Gb(e){var t=new Set,r=[];return e.indexes?(e.indexes.forEach(n=>{var a=ns(n);a.forEach(s=>{if(!t.has(s)){t.add(s);var c=Yr(e,s);c.type==="boolean"&&r.push(s)}})}),r.push("_deleted"),pd(r)):r}function pc(e){return e===Hr?-1/0:e}function mc(e,t,r){if(e.includes(t)){var n=r===Ur||r===!0?"1":"0";return n}else return r}function Of(e,t,r){if(!r){if(typeof window>"u")throw new Error("IDBKeyRange missing");r=window.IDBKeyRange}var n=t.startKeys.map((c,f)=>{var d=t.index[f];return mc(e,d,c)}).map(pc),a=t.endKeys.map((c,f)=>{var d=t.index[f];return mc(e,d,c)}).map(pc),s=r.bound(n,a,!t.inclusiveStart,!t.inclusiveEnd);return s}async function vc(e,t){var r=await e.internals,n=t.query,a=n.skip?n.skip:0,s=n.limit?n.limit:1/0,c=a+s,f=t.queryPlan,d=!1;f.selectorSatisfiedByIndex||(d=vs(e.schema,t.query));var v=Of(r.booleanIndexes,f,r.dexieDb._options.IDBKeyRange),m=f.index,g=[];if(await r.dexieDb.transaction("r",r.dexieTable,async w=>{var E=w.idbtrans,O=E.objectStore(ua),P,B;B="["+m.map(H=>rn(H)).join("+")+"]",P=O.index(B);var j=P.openCursor(v);await new Promise(H=>{j.onsuccess=function(ee){var X=ee.target.result;if(X){var Y=xf(r.booleanIndexes,X.value);(!d||d(Y))&&g.push(Y),f.sortSatisfiedByIndex&&g.length===c?H():X.continue()}else H()}})}),!f.sortSatisfiedByIndex){var S=Il(e.schema,t.query);g=g.sort(S)}return g=g.slice(a,c),{documents:g}}async function Yb(e,t){var r=await e.internals,n=t.queryPlan,a=n.index,s=Of(r.booleanIndexes,n,r.dexieDb._options.IDBKeyRange),c=-1;return await r.dexieDb.transaction("r",r.dexieTable,async f=>{var d=f.idbtrans,v=d.objectStore(ua),m,g;g="["+a.map(w=>rn(w)).join("+")+"]",m=v.index(g);var S=m.count(s);c=await new Promise((w,E)=>{S.onsuccess=function(){w(S.result)},S.onerror=O=>E(O)})}),c}var Jb=et(),Eo=!1,Xb=(function(){function e(r,n,a,s,c,f,d,v){this.changes$=new ut,this.instanceId=Jb++,this.storage=r,this.databaseName=n,this.collectionName=a,this.schema=s,this.internals=c,this.options=f,this.settings=d,this.devMode=v,this.primaryPath=tt(this.schema.primaryKey)}var t=e.prototype;return t.bulkWrite=async function(n,a){hr(this),!Eo&&!await qc()&&console.warn(["-------------- RxDB Open Core RxStorage -------------------------------","You are using the free Dexie.js based RxStorage implementation from RxDB https://rxdb.info/rx-storage-dexie.html?console=dexie ","While this is a great option, we want to let you know that there are faster storage solutions available in our premium plugins.","For professional users and production environments, we highly recommend considering these premium options to enhance performance and reliability."," https://rxdb.info/premium/?console=dexie ","If you already purchased premium access you can disable this log by calling the setPremiumFlag() function from rxdb-premium/plugins/shared.","---------------------------------------------------------------------"].join(`
`)),Eo=!0,n.forEach(m=>{if(!m.document._rev||m.previous&&!m.previous._rev)throw J("SNH",{args:{row:m}})});var s=await this.internals,c={error:[]};this.devMode&&(n=n.map(m=>{var g=ri(m.document);return{previous:m.previous,document:g}}));var f=n.map(m=>m.document[this.primaryPath]),d;if(await s.dexieDb.transaction("rw",s.dexieTable,s.dexieAttachmentsTable,async()=>{var m=new Map,g=await dc(this.internals,f);g.forEach(E=>{var O=E;return O&&m.set(O[this.primaryPath],O),O}),d=sv(this,this.primaryPath,m,n,a),c.error=d.errors;var S=[];d.bulkInsertDocs.forEach(E=>{S.push(E.document)}),d.bulkUpdateDocs.forEach(E=>{S.push(E.document)}),S=S.map(E=>Qb(s.booleanIndexes,E)),S.length>0&&await s.dexieTable.bulkPut(S);var w=[];d.attachmentsAdd.forEach(E=>{w.push({id:Li(E.documentId,E.attachmentId),data:E.attachmentData.data})}),d.attachmentsUpdate.forEach(E=>{w.push({id:Li(E.documentId,E.attachmentId),data:E.attachmentData.data})}),await s.dexieAttachmentsTable.bulkPut(w),await s.dexieAttachmentsTable.bulkDelete(d.attachmentsRemove.map(E=>Li(E.documentId,E.attachmentId)))}),d=oe(d),d.eventBulk.events.length>0){var v=oe(d.newestRow).document;d.eventBulk.checkpoint={id:v[this.primaryPath],lwt:v._meta.lwt},this.changes$.next(d.eventBulk)}return c},t.findDocumentsById=async function(n,a){hr(this);var s=await this.internals,c=[];return await s.dexieDb.transaction("r",s.dexieTable,async()=>{var f=await dc(this.internals,n);f.forEach(d=>{d&&(!d._deleted||a)&&c.push(d)})}),c},t.query=function(n){return hr(this),vc(this,n)},t.count=async function(n){if(n.queryPlan.selectorSatisfiedByIndex){var a=await Yb(this,n);return{count:a,mode:"fast"}}else{var s=await vc(this,n);return{count:s.documents.length,mode:"slow"}}},t.changeStream=function(){return hr(this),this.changes$.asObservable()},t.cleanup=async function(n){hr(this);var a=await this.internals;return await a.dexieDb.transaction("rw",a.dexieTable,async()=>{var s=et()-n,c=await a.dexieTable.where("_meta.lwt").below(s).toArray(),f=[];c.forEach(d=>{d._deleted==="1"&&f.push(d[this.primaryPath])}),await a.dexieTable.bulkDelete(f)}),!0},t.getAttachmentData=async function(n,a,s){hr(this);var c=await this.internals,f=Li(n,a);return await c.dexieDb.transaction("r",c.dexieAttachmentsTable,async()=>{var d=await c.dexieAttachmentsTable.get(f);if(d)return d.data;throw new Error("attachment missing documentId: "+n+" attachmentId: "+a)})},t.remove=async function(){hr(this);var n=await this.internals;return await n.dexieTable.clear(),this.close()},t.close=function(){return this.closed?this.closed:(this.closed=(async()=>{this.changes$.complete(),await zb(this.internals)})(),this.closed)},e})();async function Zb(e,t,r){var n=Hb(t.databaseName,t.collectionName,r,t.schema),a=new Xb(e,t.databaseName,t.collectionName,t.schema,n,t.options,r,t.devMode);return await Sb(Sf,t,a),Promise.resolve(a)}function hr(e){if(e.closed)throw new Error("RxStorageInstanceDexie is closed "+e.databaseName+"-"+e.collectionName)}var ew=(function(){function e(r){this.name=Sf,this.rxdbVersion=Fc,this.settings=r}var t=e.prototype;return t.createStorageInstance=function(n){if(lv(n),n.schema.indexes){var a=n.schema.indexes.flat();a.filter(s=>!s.includes(".")).forEach(s=>{if(!n.schema.required||!n.schema.required.includes(s))throw J("DXE1",{field:s,schema:n.schema})})}return Zb(this,n,this.settings)},e})();function tw(e={}){var t=new ew(e);return t}var rw=["__proto__","constructor","prototype"];function Sn(e,t){Object.keys(t).forEach(r=>{rw.includes(r)||(typeof e[r]>"u"?e[r]=t[r]:Dn(t[r])?Sn(e[r],t[r]):e[r]=t[r])})}function Dn(e){return e.toString()==="[object Object]"}var ba=(function(){function e(r,n){if(this.options={},this._conditions={},this._fields={},this._path=n,r){var a=this;r.selector&&a.find(r.selector),r.limit&&a.limit(r.limit),r.skip&&a.skip(r.skip),r.sort&&r.sort.forEach(s=>a.sort(s))}}var t=e.prototype;return t.where=function(n,a){if(!arguments.length)return this;var s=typeof arguments[0];if(s==="string")return this._path=arguments[0],arguments.length===2&&(this._conditions[this._path]=arguments[1]),this;if(s==="object"&&!Array.isArray(arguments[0]))return this.merge(arguments[0]);throw st("MQ1",{path:arguments[0]})},t.equals=function(n){this._ensurePath("equals");var a=this._path;return this._conditions[a]=n,this},t.eq=function(n){this._ensurePath("eq");var a=this._path;return this._conditions[a]=n,this},t.or=function(n){var a=this._conditions.$or||(this._conditions.$or=[]);return Array.isArray(n)||(n=[n]),a.push.apply(a,n),this},t.nor=function(n){var a=this._conditions.$nor||(this._conditions.$nor=[]);return Array.isArray(n)||(n=[n]),a.push.apply(a,n),this},t.and=function(n){var a=this._conditions.$and||(this._conditions.$and=[]);return Array.isArray(n)||(n=[n]),a.push.apply(a,n),this},t.mod=function(n,a){var s,c;arguments.length===1?(this._ensurePath("mod"),s=arguments[0],c=this._path):arguments.length===2&&!Array.isArray(arguments[1])?(this._ensurePath("mod"),s=arguments.slice(),c=this._path):arguments.length===3?(s=arguments.slice(1),c=arguments[0]):(s=arguments[1],c=arguments[0]);var f=this._conditions[c]||(this._conditions[c]={});return f.$mod=s,this},t.exists=function(n,a){var s,c;arguments.length===0?(this._ensurePath("exists"),s=this._path,c=!0):arguments.length===1?typeof arguments[0]=="boolean"?(this._ensurePath("exists"),s=this._path,c=arguments[0]):(s=arguments[0],c=!0):arguments.length===2&&(s=arguments[0],c=arguments[1]);var f=this._conditions[s]||(this._conditions[s]={});return f.$exists=c,this},t.elemMatch=function(n,a){if(arguments[0]===null)throw st("MQ2");var s,c,f;if(typeof arguments[0]=="function")this._ensurePath("elemMatch"),c=this._path,s=arguments[0];else if(Dn(arguments[0]))this._ensurePath("elemMatch"),c=this._path,f=arguments[0];else if(typeof arguments[1]=="function")c=arguments[0],s=arguments[1];else if(arguments[1]&&Dn(arguments[1]))c=arguments[0],f=arguments[1];else throw st("MQ2");s&&(f=new e,s(f),f=f._conditions);var d=this._conditions[c]||(this._conditions[c]={});return d.$elemMatch=f,this},t.sort=function(n){if(!n)return this;var a,s=typeof n;if(Array.isArray(n)){a=n.length;for(var c=0;c<n.length;++c)iw(this.options,n[c][0],n[c][1]);return this}if(arguments.length===1&&s==="string"){n=n.split(/\s+/),a=n.length;for(var f=0;f<a;++f){var d=n[f];if(d){var v=d[0]==="-"?-1:1;v===-1&&(d=d.substring(1)),yc(this.options,d,v)}}return this}if(Dn(n)){var m=Object.keys(n);return m.forEach(g=>yc(this.options,g,n[g])),this}throw st("MQ3",{args:arguments})},t.merge=function(n){if(!n)return this;if(!gc(n))throw st("MQ4",{source:n});return n instanceof e?(n._conditions&&Sn(this._conditions,n._conditions),n._fields&&(this._fields||(this._fields={}),Sn(this._fields,n._fields)),n.options&&(this.options||(this.options={}),Sn(this.options,n.options)),n._distinct&&(this._distinct=n._distinct),this):(Sn(this._conditions,n),this)},t.find=function(n){return gc(n)&&this.merge(n),this},t._ensurePath=function(n){if(!this._path)throw J("MQ5",{method:n})},t.toJSON=function(){var n={selector:this._conditions};return this.options.skip&&(n.skip=this.options.skip),this.options.limit&&(n.limit=this.options.limit),this.options.sort&&(n.sort=nw(this.options.sort)),{query:n,path:this._path}},e})();function nw(e){return Object.entries(e).map(([t,r])=>{var n=r===1?"asc":"desc",a={[t]:n};return a})}var If=["limit","skip","maxScan","batchSize","comment"];If.forEach(function(e){ba.prototype[e]=function(t){return this.options[e]=t,this}});var Cf=["gt","gte","lt","lte","ne","in","nin","all","regex","size"];Cf.forEach(function(e){ba.prototype[e]=function(){var t,r;arguments.length===1?(this._ensurePath(e),r=arguments[0],t=this._path):(r=arguments[1],t=arguments[0]);var n=this._conditions[t]===null||typeof this._conditions[t]=="object"?this._conditions[t]:this._conditions[t]={};if(e==="regex"){if(r instanceof RegExp)throw J("QU16",{field:t,query:this._conditions});typeof r=="string"?n["$"+e]=r:(n["$"+e]=r.$regex,r.$options&&(n.$options=r.$options))}else n["$"+e]=r;return this}});function yc(e,t,r){if(Array.isArray(e.sort))throw st("MQ6",{opts:e,field:t,value:r});if(r&&r.$meta){var n=e.sort||(e.sort={});n[t]={$meta:r.$meta};return}var a=String(r||1).toLowerCase();if(!/^(?:ascending|asc|descending|desc|1|-1)$/.test(a))throw Array.isArray(r)&&(r="["+r+"]"),st("MQ7",{field:t,value:r});var s=e.sort||(e.sort={}),c=r.toString().replace("asc","1").replace("ascending","1").replace("desc","-1").replace("descending","-1");s[t]=parseInt(c,10)}function iw(e,t,r){if(e.sort=e.sort||[],!Array.isArray(e.sort))throw st("MQ8",{opts:e,field:t,value:r});e.sort.push([t,r])}function gc(e){return e instanceof ba||Dn(e)}function aw(e,t){return new ba(e,t)}var bc="queryBuilderPath";function ow(e,t,r){var n=aw(ze(e.mangoQuery),e.other[bc]);n[t](r);var a=n.toJSON();return Kr(e.op,a.query,e.collection,{...e.other,[bc]:a.path})}function So(e,t){e[t]=function(r){if(ge.isDevMode()&&this.op==="findByIds")throw J("QU17",{collection:this.collection.name,query:this.mangoQuery});return ow(this,t,r)}}var sw={name:"query-builder",rxdb:!0,prototypes:{RxQuery(e){["where","equals","eq","or","nor","and","mod","exists","elemMatch","sort"].forEach(t=>{So(e,t)}),If.forEach(t=>{So(e,t)}),Cf.forEach(t=>{So(e,t)})}}};if(typeof window<"u"&&!window.__rxdb_plugins_added)try{Uo($b),Uo(sw),window.__rxdb_plugins_added=!0}catch{}const uw={title:"paperflip_document",version:2,primaryKey:"documentId",type:"object",properties:{documentId:{type:"string",maxLength:100},segments:{type:"array",items:{type:"string"}},currentSegmentIndex:{type:"number",multipleOf:1,minimum:0,maximum:1e6},currentSegmentProgress:{type:"number",multipleOf:1,minimum:0,maximum:1e7},createdAt:{type:"number",multipleOf:1,minimum:0,maximum:1e13}},required:["documentId","segments","currentSegmentIndex","createdAt"],indexes:["createdAt"]};async function cw(){let e=tw();try{const t=await Qy({name:"paperflipdb",storage:e});return await t.addCollections({documents:{schema:uw,migrationStrategies:{1:function(r){return{documentId:r.documentId,segments:r.segments||[],currentSegmentIndex:r.currentSegmentIndex||0,createdAt:r.createdAt||Date.now()}},2:function(r){return{...r,currentSegmentProgress:0}}}}}),t}catch(t){throw console.error("Failed to initialize RxDB:",t),t}}let ko=null;function wa(){return ko||(ko=cw()),ko}async function Lw(e,t,r=0){try{return(await(await wa()).documents.upsert({documentId:e,segments:t,currentSegmentIndex:r,currentSegmentProgress:0,createdAt:Date.now()})).toJSON()}catch(n){throw console.error(`Failed to upsert document ${e}:`,n),n}}async function Bw(e=10){return(await(await wa()).documents.find().sort({createdAt:"desc"}).limit(e).exec()).map(n=>n.toJSON())}async function $w(e){const r=await(await wa()).documents.findOne(e).exec();return r?r.toJSON():null}async function jw(e,t,r=0){try{const a=await(await wa()).documents.findOne(e).exec();a&&await a.patch({currentSegmentIndex:t,currentSegmentProgress:r})}catch(n){console.error(`Failed to update progress for ${e}:`,n)}}function Kw(e){const t=[],r=e.split(/\n\s*\n/).filter(a=>a.trim().length>0),n=typeof Intl<"u"&&Intl.Segmenter?new Intl.Segmenter(void 0,{granularity:"word"}):null;for(const a of r)if(a.length<=1e3)t.push(a.trim());else{let s="";if(n){for(const{segment:c}of n.segment(a))(s+c).length>1e3&&s.length>0?(t.push(s.trim()),s=c):s+=c;s.length>0&&t.push(s.trim())}else for(let c=0;c<a.length;c+=1e3)t.push(a.substring(c,c+1e3).trim())}return t.filter(a=>a.length>0)}function Fw(e){const t=[];if(typeof Intl<"u"&&Intl.Segmenter){const r=new Intl.Segmenter(void 0,{granularity:"sentence"});for(const{segment:n,index:a}of r.segment(e))n.trim().length>0&&t.push({text:n,start:a,end:a+n.length})}else{const r=/[^.!?]+[.!?]+(\s+|$)|[^.!?]+$/g;let n;for(;(n=r.exec(e))!==null;)n[0].trim().length>0&&t.push({text:n[0],start:n.index,end:n.index+n[0].length})}return t}function Pf(e){const t=e-1;return t*t*t+1}function wc(e){const t=typeof e=="string"&&e.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return t?[parseFloat(t[1]),t[2]||"px"]:[e,"px"]}function qw(e,{delay:t=0,duration:r=400,easing:n=Pf,x:a=0,y:s=0,opacity:c=0}={}){const f=getComputedStyle(e),d=+f.opacity,v=f.transform==="none"?"":f.transform,m=d*(1-c),[g,S]=wc(a),[w,E]=wc(s);return{delay:t,duration:r,easing:n,css:(O,P)=>`
			transform: ${v} translate(${(1-O)*g}${S}, ${(1-O)*w}${E});
			opacity: ${d-m*P}`}}function Ww(e,{delay:t=0,duration:r=400,easing:n=Pf,start:a=0,opacity:s=0}={}){const c=getComputedStyle(e),f=+c.opacity,d=c.transform==="none"?"":c.transform,v=1-a,m=f*(1-s);return{delay:t,duration:r,easing:n,css:(g,S)=>`
			transform: ${d} scale(${1-v*S});
			opacity: ${f-m*S}
		`}}const lw={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const fw=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0;return!1};const _c=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim();var hw=Hh("<svg><!><!></svg>");function Uw(e,t){const r=pu(t,["children","$$slots","$$events","$$legacy"]),n=pu(r,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Mh(t,!1);let a=$r(t,"name",8,void 0),s=$r(t,"color",8,"currentColor"),c=$r(t,"size",8,24),f=$r(t,"strokeWidth",8,2),d=$r(t,"absoluteStrokeWidth",8,!1),v=$r(t,"iconNode",24,()=>[]);Yh();var m=hw();du(m,(w,E,O)=>({...lw,...w,...n,width:c(),height:c(),stroke:s(),"stroke-width":E,class:O}),[()=>fw(n)?void 0:{"aria-hidden":"true"},()=>(Br(d()),Br(f()),Br(c()),Oo(()=>d()?Number(f())*24/Number(c()):f())),()=>(Br(_c),Br(a()),Br(r),Oo(()=>_c("lucide-icon","lucide",a()?`lucide-${a()}`:"",r.class)))]);var g=Nh(m);Zh(g,1,v,Jh,(w,E)=>{var O=Kh(()=>Fh(kn(E),2));let P=()=>kn(O)[0],B=()=>kn(O)[1];var j=zh(),H=jh(j);sd(H,P,!0,(ee,X)=>{du(ee,()=>({...B()}))}),hu(w,j)});var S=Lh(g);rd(S,t,"default",{}),Bh(m),hu(e,m),$h()}export{Uw as I,Ww as a,wa as b,Kw as c,jw as d,Zh as e,qw as f,Bw as g,Fw as h,Jh as i,$w as j,xt as p,Ew as r,rd as s,_w as t,Lw as u};
