const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/DiSv1p1T.js","../chunks/C24EYs5x.js","../chunks/BJ8RSJk3.js","../chunks/DJicu8LF.js","../chunks/BrC9JOSP.js","../chunks/DM3EJLr3.js","../chunks/D5PPrnWW.js","../chunks/CIHOeZZ2.js","../chunks/n83IdW0N.js","../chunks/CgiX73Oo.js"])))=>i.map(i=>d[i]);
import{c as z,a as f,e as oe,s as S,f as $}from"../chunks/DJicu8LF.js";import"../chunks/DM3EJLr3.js";import{F as j,E as ce,ac as ve,s as m,ag as ke,a as r,I as a,ah as R,J as s,K as u,u as M,G as W,H as pe,a7 as I}from"../chunks/BJ8RSJk3.js";import{i as T}from"../chunks/D5PPrnWW.js";import{i as me}from"../chunks/n83IdW0N.js";import{I as H,s as O,e as Fe,t as C,g as Ee,f as q,a as Me,b as ne,r as de,c as je,u as Ie}from"../chunks/C24EYs5x.js";import{_ as Ne}from"../chunks/PPVm8Dsz.js";import{s as Ue}from"../chunks/CIHOeZZ2.js";import{l as B,s as G,p as Q}from"../chunks/CgiX73Oo.js";import{g as ie}from"../chunks/BrC9JOSP.js";function le(x,i){const c=B(i,["children","$$slots","$$events","$$legacy"]);const b=[["path",{d:"M12 6v6l4 2"}],["circle",{cx:"12",cy:"12",r:"10"}]];H(x,G({name:"clock"},()=>c,{get iconNode(){return b},children:(h,_)=>{var o=z(),v=j(o);O(v,i,"default",{}),f(h,o)},$$slots:{default:!0}}))}function Le(x,i){const c=B(i,["children","$$slots","$$events","$$legacy"]);const b=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5"}],["path",{d:"M10 9H8"}],["path",{d:"M16 13H8"}],["path",{d:"M16 17H8"}]];H(x,G({name:"file-text"},()=>c,{get iconNode(){return b},children:(h,_)=>{var o=z(),v=j(o);O(v,i,"default",{}),f(h,o)},$$slots:{default:!0}}))}function Se(x,i){const c=B(i,["children","$$slots","$$events","$$legacy"]);const b=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"}]];H(x,G({name:"shield"},()=>c,{get iconNode(){return b},children:(h,_)=>{var o=z(),v=j(o);O(v,i,"default",{}),f(h,o)},$$slots:{default:!0}}))}function Re(x,i){const c=B(i,["children","$$slots","$$events","$$legacy"]);const b=[["path",{d:"M12 3v12"}],["path",{d:"m17 8-5-5-5 5"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}]];H(x,G({name:"upload"},()=>c,{get iconNode(){return b},children:(h,_)=>{var o=z(),v=j(o);O(v,i,"default",{}),f(h,o)},$$slots:{default:!0}}))}var Ce=$('<div class="w-20 h-20 rounded-full bg-gradient-to-br from-brand-primary to-brand-secondary flex items-center justify-center animate-pulse"><!></div> <div class="text-center"><p class="text-white text-xl font-bold">Processing...</p></div>',1),Te=$('<div class="w-20 h-20 rounded-full bg-gradient-to-br from-brand-primary to-brand-secondary flex items-center justify-center"><!></div> <div class="text-center"><p class="text-white text-xl font-bold">Open PDF</p> <p class="text-brand-text-muted text-sm mt-1">Tap to browse files</p></div> <div class="flex items-center gap-2 text-brand-primary text-xs"><!> <span>Instant • Zero Latency</span></div>',1),ze=$('<p class="mt-2 text-xs text-red-400 text-center"> </p>'),He=$('<div class="p-4 rounded-2xl bg-white/5 backdrop-blur-sm border border-white/10 hover:bg-white/10 transition-all cursor-pointer"><div class="flex items-start gap-3"><div class="w-10 h-10 rounded-xl bg-gradient-to-br from-brand-primary/20 to-brand-secondary/20 flex items-center justify-center flex-shrink-0"><!></div> <div class="flex-1 min-w-0"><p class="text-white text-sm font-medium truncate"> </p> <div class="flex items-center gap-2 mt-1"><p class="text-brand-text-muted text-xs"> </p> <span class="text-gray-600">•</span> <p class="text-brand-primary text-xs font-medium"> </p></div> <div class="mt-2 h-1 bg-white/10 rounded-full overflow-hidden"><div class="h-full bg-gradient-to-r from-brand-primary to-brand-secondary"></div></div></div></div></div>'),Oe=$('<p class="text-gray-500 text-sm text-center py-4">No recent files found.</p>'),Be=$('<div class="h-full bg-gradient-to-b from-brand-bg to-brand-surface flex flex-col text-white font-sans overflow-hidden relative"><div class="px-6 pt-12 pb-6"><div class="text-5xl font-black tracking-tight text-white">Paper<span class="text-brand-primary">Flip</span></div> <p class="text-brand-text-muted mt-2 text-sm">Transform PDFs into immersive stories</p></div> <div class="mx-6 mb-8 px-4 py-3 rounded-2xl bg-gradient-to-r from-brand-primary/10 to-brand-secondary/10 border border-brand-primary/30 backdrop-blur-sm"><div class="flex items-center gap-3"><!> <div><p class="text-white text-sm font-semibold">100% On-Device</p> <p class="text-brand-text-muted text-xs">No Cloud Uploads • Zero Tracking</p></div></div></div> <div class="mx-6 mb-8"><label class="block w-full aspect-[4/3] rounded-3xl bg-gradient-to-br from-brand-primary to-brand-secondary p-[2px] shadow-2xl shadow-brand-primary/20 cursor-pointer transition-transform hover:scale-[1.02] active:scale-[0.98]"><input type="file" accept=".pdf" class="hidden"/> <div class="w-full h-full rounded-3xl bg-gradient-to-br from-brand-surface to-brand-surface-dark flex flex-col items-center justify-center gap-4 border-2 border-dashed border-brand-primary/30 hover:border-brand-primary/60 transition-colors"><!></div></label> <!></div> <div class="flex-1 px-6 pb-6 overflow-y-auto"><h2 class="text-white text-lg font-bold mb-4">Recent</h2> <div class="space-y-3"><!> <!></div></div></div>');function Ge(x,i){ce(i,!1);let c=Q(i,"onPdfParsed",8,()=>{}),b=Q(i,"onPdfError",8,()=>{}),h=Q(i,"onLoadDocument",8,()=>{}),_=I(!1),o=I(null),v=I([]),g=I("");async function V(){try{const t=await Ee(5);m(v,t.map(e=>{const d=e.segments||[],n=e.currentSegmentIndex||0,w=e.currentSegmentProgress||0;let P=0;if(d.length>0){const F=d[n]?.length||1,k=n+w/F;P=Math.round(k/d.length*100)}return{id:e.documentId,name:e.documentId,progress:Math.min(P,100),totalPages:d.length,currentPage:n+1}}))}catch(t){console.error("Failed to load recent uploads:",t)}}ve(async()=>{try{m(g,"Loading PDF.js...");const t=await Ne(()=>import("../chunks/DiSv1p1T.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url);m(o,t);const e="/pdf.worker.min.mjs";ke(o,r(o).GlobalWorkerOptions.workerSrc=e),m(g,"Ready"),await V()}catch(t){console.error("Failed to load PDF.js",t);const e=t instanceof Error?t.message:String(t);m(g,"Error loading PDF.js: "+e)}});async function l(t){const e=t.target,d=e.files?.[0];if(!(!d||!r(o))){m(_,!0),m(g,"Processing...");try{const n=await d.arrayBuffer(),P=await r(o).getDocument(n).promise;let F="";for(let k=1;k<=P.numPages;k++){const Z=await(await P.getPage(k)).getTextContent();F+=Z.items.map(E=>"str"in E?E.str:"").join(" ")}c()({text:F,filename:d.name}),m(g,"Done")}catch(n){console.error("Error parsing or storing PDF:",n);const w=n instanceof Error?n.message:String(n);m(g,"Error: "+w),b()({error:"Failed to process PDF: "+w})}finally{m(_,!1),e.value=""}}}function y(t){h()({documentId:t})}me();var p=Be(),D=a(p),fe=a(D);R(2),s(D);var N=u(D,2),X=a(N),ge=a(X);Se(ge,{class:"w-5 h-5 text-brand-primary"}),R(2),s(X),s(N);var U=u(N,2),A=a(U),J=a(A),Y=u(J,2),ue=a(Y);{var xe=t=>{var e=Ce(),d=j(e),n=a(d);le(n,{class:"w-10 h-10 text-brand-bg"}),s(d),R(2),f(t,e)},be=t=>{var e=Te(),d=j(e),n=a(d);Re(n,{class:"w-10 h-10 text-brand-bg"}),s(d);var w=u(d,4),P=a(w);le(P,{class:"w-3 h-3"}),R(2),s(w),f(t,e)};T(ue,t=>{r(_)?t(xe):t(be,!1)})}s(Y),s(A);var he=u(A,2);{var _e=t=>{var e=ze(),d=a(e,!0);s(e),W(()=>S(d,r(g))),f(t,e)};T(he,t=>{r(g)&&r(g)!=="Ready"&&!r(_)&&r(g)!=="Done"&&t(_e)})}s(U);var ee=u(U,2),te=u(a(ee),2),re=a(te);Fe(re,3,()=>r(v),t=>t.id,(t,e,d)=>{var n=He(),w=a(n),P=a(w),F=a(P);Le(F,{class:"w-5 h-5 text-brand-primary"}),s(P);var k=u(P,2),L=a(k),Z=a(L,!0);s(L);var E=u(L,2),K=a(E),Pe=a(K);s(K);var ae=u(K,4),$e=a(ae);s(ae),s(E);var se=u(E,2),De=a(se);s(se),s(k),s(w),s(n),W(()=>{S(Z,(r(e),M(()=>r(e).name))),S(Pe,`Part ${r(e),M(()=>r(e).currentPage)??""} of ${r(e),M(()=>r(e).totalPages)??""}`),S($e,`${r(e),M(()=>r(e).progress)??""}% watched`),Ue(De,`width: ${r(e),M(()=>r(e).progress)??""}%`)}),C(1,n,()=>q,()=>({x:-20,duration:500,delay:300+r(d)*100})),oe("click",n,()=>y(r(e).id)),f(t,n)});var ye=u(re,2);{var we=t=>{var e=Oe();f(t,e)};T(ye,t=>{r(v),M(()=>r(v).length===0)&&t(we)})}s(te),s(ee),s(p),W(()=>J.disabled=r(_)||!r(o)),C(1,fe,()=>q,()=>({y:-20,duration:500})),C(1,N,()=>Me,()=>({start:.9,duration:500,delay:100})),oe("change",J,l),C(1,U,()=>q,()=>({y:20,duration:500,delay:200})),f(x,p),pe()}var Ve=$('<div class="flex items-center justify-center h-full text-white"><p class="text-xl animate-pulse">Processing PDF...</p></div>'),Ae=$('<div class="h-full aspect-[9/16] max-w-full bg-black shadow-2xl relative"><!></div>'),Je=$('<div class="h-screen w-full bg-brand-bg flex justify-center items-center"><!></div>');function at(x,i){ce(i,!1);let c=I(!1);async function b({text:l,filename:y}){m(c,!0);try{console.log("Segmenting text...");const p=je(l);console.log(`Text segmented into ${p.length} segments`),p.length===0&&console.warn("No text segments found in PDF"),console.log("Getting database..."),await ne(),console.log("Upserting document..."),await Ie(y,p),console.log("Document and segments stored/updated in RxDB with ID:",y);const D=`${de("/feed")}?id=${encodeURIComponent(y)}`;console.log("Navigating to:",D),ie(D)}catch(p){console.error("Error processing PDF:",p);const D=p instanceof Error?p.message:JSON.stringify(p);alert(`Failed to process PDF: ${D}`)}finally{m(c,!1)}}function h({error:l}){console.error("PDF Upload Error:",l),alert(`Error: ${l}`),m(c,!1)}async function _({documentId:l}){ie(`${de("/feed")}?id=${encodeURIComponent(l)}`)}ve(async()=>{await ne()}),me();var o=Je(),v=a(o);{var g=l=>{var y=Ve();f(l,y)},V=l=>{var y=Ae(),p=a(y);Ge(p,{onPdfParsed:b,onPdfError:h,onLoadDocument:_}),s(y),f(l,y)};T(v,l=>{r(c)?l(g):l(V,!1)})}s(o),f(x,o),pe()}export{at as component};
